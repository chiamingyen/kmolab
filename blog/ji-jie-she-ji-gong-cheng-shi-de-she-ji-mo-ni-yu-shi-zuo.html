<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>機械設計工程師的設計模擬與實作 - Kmolab</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




<style type="text/css">

/*some stuff for output/input prompts*/
div.cell{border:1px solid transparent;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch}div.cell.selected{border-radius:4px;border:thin #ababab solid}
div.cell.edit_mode{border-radius:4px;border:thin #008000 solid}
div.cell{width:100%;padding:5px 5px 5px 0;margin:0;outline:none}
div.prompt{min-width:11ex;padding:.4em;margin:0;font-family:monospace;text-align:right;line-height:1.21429em}
@media (max-width:480px){div.prompt{text-align:left}}div.inner_cell{display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;display:flex;flex-direction:column;align-items:stretch;-webkit-box-flex:1;-moz-box-flex:1;box-flex:1;flex:1}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;line-height:1.21429em}
div.prompt:empty{padding-top:0;padding-bottom:0}
div.input{page-break-inside:avoid;display:-webkit-box;-webkit-box-orient:horizontal;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:horizontal;-moz-box-align:stretch;display:box;box-orient:horizontal;box-align:stretch;}
div.inner_cell{width:90%;}
div.input_area{border:1px solid #cfcfcf;border-radius:4px;background:#f7f7f7;}
div.input_prompt{color:navy;border-top:1px solid transparent;}
div.output_wrapper{margin-top:5px;position:relative;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.output_scroll{height:24em;width:100%;overflow:auto;border-radius:4px;-webkit-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);-moz-box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);box-shadow:inset 0 2px 8px rgba(0, 0, 0, 0.8);}
div.output_collapsed{margin:0px;padding:0px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-box-align:stretch;display:-moz-box;-moz-box-orient:vertical;-moz-box-align:stretch;display:box;box-orient:vertical;box-align:stretch;width:100%;}
div.out_prompt_overlay{height:100%;padding:0px 0.4em;position:absolute;border-radius:4px;}
div.out_prompt_overlay:hover{-webkit-box-shadow:inset 0 0 1px #000000;-moz-box-shadow:inset 0 0 1px #000000;box-shadow:inset 0 0 1px #000000;background:rgba(240, 240, 240, 0.5);}
div.output_prompt{color:darkred;}

a.anchor-link:link{text-decoration:none;padding:0px 20px;visibility:hidden;}
h1:hover .anchor-link,h2:hover .anchor-link,h3:hover .anchor-link,h4:hover .anchor-link,h5:hover .anchor-link,h6:hover .anchor-link{visibility:visible;}
/* end stuff for output/input prompts*/


.highlight-ipynb .hll { background-color: #ffffcc }
.highlight-ipynb  { background: #f8f8f8; }
.highlight-ipynb .c { color: #408080; font-style: italic } /* Comment */
.highlight-ipynb .err { border: 1px solid #FF0000 } /* Error */
.highlight-ipynb .k { color: #008000; font-weight: bold } /* Keyword */
.highlight-ipynb .o { color: #666666 } /* Operator */
.highlight-ipynb .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight-ipynb .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight-ipynb .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight-ipynb .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight-ipynb .gd { color: #A00000 } /* Generic.Deleted */
.highlight-ipynb .ge { font-style: italic } /* Generic.Emph */
.highlight-ipynb .gr { color: #FF0000 } /* Generic.Error */
.highlight-ipynb .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight-ipynb .gi { color: #00A000 } /* Generic.Inserted */
.highlight-ipynb .go { color: #888888 } /* Generic.Output */
.highlight-ipynb .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight-ipynb .gs { font-weight: bold } /* Generic.Strong */
.highlight-ipynb .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight-ipynb .gt { color: #0044DD } /* Generic.Traceback */
.highlight-ipynb .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight-ipynb .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight-ipynb .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight-ipynb .kp { color: #008000 } /* Keyword.Pseudo */
.highlight-ipynb .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight-ipynb .kt { color: #B00040 } /* Keyword.Type */
.highlight-ipynb .m { color: #666666 } /* Literal.Number */
.highlight-ipynb .s { color: #BA2121 } /* Literal.String */
.highlight-ipynb .na { color: #7D9029 } /* Name.Attribute */
.highlight-ipynb .nb { color: #008000 } /* Name.Builtin */
.highlight-ipynb .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight-ipynb .no { color: #880000 } /* Name.Constant */
.highlight-ipynb .nd { color: #AA22FF } /* Name.Decorator */
.highlight-ipynb .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight-ipynb .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight-ipynb .nf { color: #0000FF } /* Name.Function */
.highlight-ipynb .nl { color: #A0A000 } /* Name.Label */
.highlight-ipynb .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight-ipynb .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight-ipynb .nv { color: #19177C } /* Name.Variable */
.highlight-ipynb .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight-ipynb .w { color: #bbbbbb } /* Text.Whitespace */
.highlight-ipynb .mf { color: #666666 } /* Literal.Number.Float */
.highlight-ipynb .mh { color: #666666 } /* Literal.Number.Hex */
.highlight-ipynb .mi { color: #666666 } /* Literal.Number.Integer */
.highlight-ipynb .mo { color: #666666 } /* Literal.Number.Oct */
.highlight-ipynb .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight-ipynb .sc { color: #BA2121 } /* Literal.String.Char */
.highlight-ipynb .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight-ipynb .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight-ipynb .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight-ipynb .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight-ipynb .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight-ipynb .sx { color: #008000 } /* Literal.String.Other */
.highlight-ipynb .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight-ipynb .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight-ipynb .ss { color: #19177C } /* Literal.String.Symbol */
.highlight-ipynb .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight-ipynb .vc { color: #19177C } /* Name.Variable.Class */
.highlight-ipynb .vg { color: #19177C } /* Name.Variable.Global */
.highlight-ipynb .vi { color: #19177C } /* Name.Variable.Instance */
.highlight-ipynb .il { color: #666666 } /* Literal.Number.Integer.Long */
</style>

<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
div.entry-content {
  overflow: visible;
  padding: 8px;
}
.input_area {
  padding: 0.2em;
}

a.heading-anchor {
 white-space: normal;
}

.rendered_html
code {
 font-size: .8em;
}

pre.ipynb {
  color: black;
  background: #f7f7f7;
  border: none;
  box-shadow: none;
  margin-bottom: 0;
  padding: 0;
  margin: 0px;
  font-size: 13px;
}

/* remove the prompt div from text cells */
div.text_cell .prompt {
    display: none;
}

/* remove horizontal padding from text cells, */
/* so it aligns with outer body text */
div.text_cell_render {
    padding: 0.5em 0em;
}

img.anim_icon{padding:0; border:0; vertical-align:middle; -webkit-box-shadow:none; -box-shadow:none}
</style>

<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>

<link rel="canonical" href="http://chiamingyen.github.io/kmolab/blog/ji-jie-she-ji-gong-cheng-shi-de-she-ji-mo-ni-yu-shi-zuo.html">

        <meta name="author" content="yen" />
        <meta name="keywords" content="Javascript,Python,Brython" />
        <meta name="description" content="先利用 Brython 模擬重力啟動機械時鐘所需的齒輪組, 然後在 Onshape 進行零組件設計繪圖, 最後再用 3D 印表機將零件印出並組裝測試." />

        <meta property="og:site_name" content="Kmolab" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="機械設計工程師的設計模擬與實作"/>
        <meta property="og:url" content="http://chiamingyen.github.io/kmolab/blog/ji-jie-she-ji-gong-cheng-shi-de-she-ji-mo-ni-yu-shi-zuo.html"/>
        <meta property="og:description" content="先利用 Brython 模擬重力啟動機械時鐘所需的齒輪組, 然後在 Onshape 進行零組件設計繪圖, 最後再用 3D 印表機將零件印出並組裝測試."/>
        <meta property="article:published_time" content="2016-01-19" />
            <meta property="article:section" content="Project" />
            <meta property="article:tag" content="Javascript" />
            <meta property="article:tag" content="Python" />
            <meta property="article:tag" content="Brython" />
            <meta property="article:author" content="yen" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://chiamingyen.github.io/kmolab/blog/theme/css/bootstrap.united.min.css" type="text/css"/>
    <link href="http://chiamingyen.github.io/kmolab/blog/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://chiamingyen.github.io/kmolab/blog/theme/css/pygments/fruity.css" rel="stylesheet">
    <link href="http://chiamingyen.github.io/kmolab/blog/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="http://chiamingyen.github.io/kmolab/blog/theme/css/style.css" type="text/css"/>

        <link href="http://chiamingyen.github.io/kmolab/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Kmolab ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://chiamingyen.github.io/kmolab/blog/" class="navbar-brand">
Kmolab            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                         <li><a href="http://chiamingyen.github.io/kmolab/blog/pages/about/">
                             About
                          </a></li>
                        <li >
                            <a href="http://chiamingyen.github.io/kmolab/blog/category/alumni.html">Alumni</a>
                        </li>
                        <li >
                            <a href="http://chiamingyen.github.io/kmolab/blog/category/cadlab.html">Cadlab</a>
                        </li>
                        <li >
                            <a href="http://chiamingyen.github.io/kmolab/blog/category/courses.html">Courses</a>
                        </li>
                        <li class="active">
                            <a href="http://chiamingyen.github.io/kmolab/blog/category/project.html">Project</a>
                        </li>
                        <li >
                            <a href="http://chiamingyen.github.io/kmolab/blog/category/python.html">Python</a>
                        </li>
                        <li >
                            <a href="http://chiamingyen.github.io/kmolab/blog/category/ubuntu.html">Ubuntu</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="http://chiamingyen.github.io/kmolab/blog/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="http://chiamingyen.github.io/kmolab/blog/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="http://chiamingyen.github.io/kmolab/blog/ji-jie-she-ji-gong-cheng-shi-de-she-ji-mo-ni-yu-shi-zuo.html"
                       rel="bookmark"
                       title="Permalink to 機械設計工程師的設計模擬與實作">
                        機械設計工程師的設計模擬與實作
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-01-19T10:36:58.525197+08:00"> 二 19 一月 2016</time>
    </span>
            <span class="label label-default">By</span>
            <a href="http://chiamingyen.github.io/kmolab/blog/author/yen.html"><i class="fa fa-user"></i> yen</a>



<span class="label label-default">Tags</span>
	<a href="http://chiamingyen.github.io/kmolab/blog/tag/javascript.html">Javascript</a>
        /
	<a href="http://chiamingyen.github.io/kmolab/blog/tag/python.html">Python</a>
        /
	<a href="http://chiamingyen.github.io/kmolab/blog/tag/brython.html">Brython</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>先利用 Brython 模擬重力啟動機械時鐘所需的齒輪組, 然後在 Onshape 進行零組件設計繪圖, 最後再用 3D 印表機將零件印出並組裝測試.</p>


<p>先以 Brython 畫一個時鐘:</p>
<!-- 導入 Brython 函式庫 -->

<script type="text/javascript" src="http://brython.info/src/brython_dist.js"></script>

<!-- window 導入後, 啟動 brython() -->

<script>
window.onload=function(){
brython(1);
}
</script>

<!-- 建立畫布 -->

<canvas id="plotarea" width="400" height="400" style="background-color:#333"></canvas>

<!-- 開始執行 Brython 繪圖 -->

<script type="text/python3">
# 導入 browser 模組中的 document, 並設為 doc 變數
from browser import document as doc
# 導入數學模組
import math
# 導入 datetime 模組
import datetime
# 導入 browser 中的計時器, 建立動畫用
import browser.timer

# 準備繪圖畫布
canvas = doc["plotarea"]
ctx = canvas.getContext("2d")
# 利用畫布高度計算時鐘半徑
radius = canvas.height / 2
# 座標移到畫布正中心
ctx.translate(radius, radius)
# 實際繪圓的半徑縮小 10%
radius = radius * 0.90

# 設計繪時鐘的函式
def drawClock():
    # 繪鐘表面
    drawFace(ctx, radius)
    # 繪數字
    drawNumbers(ctx, radius)
    # 繪時針分針與秒針
    drawTime(ctx, radius)

# 設計繪時鐘表面函式
def drawFace(ctx, radius):
    # 這裡先全部以白色覆蓋表面範圍
    ctx.beginPath()
    ctx.arc(0, 0, radius, 0, 2*math.pi)
    ctx.fillStyle = 'white'
    ctx.fill()
    # 利用漸層色繪製時鐘表面外框
    grad = ctx.createRadialGradient(0,0,radius*0.95, 0,0,radius*1.05)
    grad.addColorStop(0, '#333')
    grad.addColorStop(0.5, 'white')
    grad.addColorStop(1, '#333')
    ctx.strokeStyle = grad
    ctx.lineWidth = radius*0.1
    ctx.stroke()
    # 至此完成漸層色外框繪圖
    # 以下繪製正中心的 10% 半徑小黑點
    ctx.beginPath()
    ctx.arc(0, 0, radius*0.1, 0, 2*math.pi)
    ctx.fillStyle = '#333'
    ctx.fill()

# 設計繪製數字函式
def drawNumbers(ctx, radius):
    # 以半徑的比例決定字元大小, 計算符點數後, 轉為整數後, 再轉為字串
    ctx.font = str(int(radius*0.15)) + "px arial"
    ctx.textBaseline="middle"
    ctx.textAlign="center"
    for num in range(1, 13):
        ang = num * math.pi / 6
        ctx.rotate(ang)
        ctx.translate(0, -radius*0.85)
        ctx.rotate(-ang)
        ctx.fillText(str(num), 0, 0)
        ctx.rotate(ang)
        ctx.translate(0, radius*0.85)
        ctx.rotate(-ang)

def drawTime(ctx, radius):
    now = datetime.datetime.now()
    # 一小時有 60 分鐘, 有 3600 秒, 
    #一小時的角度單位為 360/12, 且度為 math.pi/180
    #所以 hour 的時數必須乘上 360/12, 再乘上 math.pi/180, 等於 math.pi/6
    hour = (now.hour%12 + now.minute/60 + now.second/3600)*math.pi/6
    drawHand(ctx, hour, radius*0.5, radius*0.07)
    #一分鐘有 60 秒, 且一分鐘的角度單位為 360/60, 且度為 math.pi/180
    #所以分鐘數必須乘上 360/60, 再乘上 math.pi/180, 等於 math.pi/30
    minute=(now.minute + now.second/60)*math.pi/30
    drawHand(ctx, minute, radius*0.8, radius*0.07)
    #秒鐘與分鐘相同, 秒鐘數必須乘上 math.pi/30
    second=(now.second*math.pi/30)
    drawHand(ctx, second, radius*0.9, radius*0.02)

def drawHand(ctx, pos, length, width):
    ctx.beginPath()
    ctx.lineWidth = width
    ctx.lineCap = "round"
    ctx.moveTo(0,0)
    ctx.rotate(pos)
    ctx.lineTo(0, -length)
    ctx.stroke()
    ctx.rotate(-pos)

# 每 1000 個 milliseconds 呼叫執行一次 drawClock 函式 (也就是每秒執行一次)
browser.timer.set_interval(drawClock, 1000)
</script>

<p>以下為利用 Brython 畫時鐘的程式碼:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">&lt;!-- 導入 Brython 函式庫 --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;http://brython.info/src/brython_dist.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="c">&lt;!-- window 導入後, 啟動 brython() --&gt;</span>
<span class="nt">&lt;script&gt;</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">onload</span><span class="o">=</span><span class="kd">function</span><span class="p">(){</span>
<span class="nx">brython</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
<span class="c">&lt;!-- 建立畫布 --&gt;</span>
<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;plotarea&quot;</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;400&quot;</span> <span class="na">style=</span><span class="s">&quot;background-color:#333&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="c">&lt;!-- 開始執行 Brython 繪圖 --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/python3&quot;</span><span class="nt">&gt;</span>
<span class="err">#</span> <span class="nx">導入</span> <span class="nx">browser</span> <span class="nx">模組中的</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">並設為</span> <span class="nx">doc</span> <span class="nx">變數</span>
<span class="nx">from</span> <span class="nx">browser</span> <span class="kr">import</span> <span class="nb">document</span> <span class="nx">as</span> <span class="nx">doc</span>
<span class="err">#</span> <span class="nx">導入數學模組</span>
<span class="kr">import</span> <span class="nx">math</span>
<span class="err">#</span> <span class="nx">導入</span> <span class="nx">datetime</span> <span class="nx">模組</span>
<span class="kr">import</span> <span class="nx">datetime</span>
<span class="err">#</span> <span class="nx">導入</span> <span class="nx">browser</span> <span class="nx">中的計時器</span><span class="p">,</span> <span class="nx">建立動畫用</span>
<span class="kr">import</span> <span class="nx">browser</span><span class="p">.</span><span class="nx">timer</span>

<span class="err">#</span> <span class="nx">準備繪圖畫布</span>
<span class="nx">canvas</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="s2">&quot;plotarea&quot;</span><span class="p">]</span>
<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">利用畫布高度計算時鐘半徑</span>
<span class="nx">radius</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>
<span class="err">#</span> <span class="nx">座標移到畫布正中心</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">radius</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">實際繪圓的半徑縮小</span> <span class="mi">10</span><span class="o">%</span>
<span class="nx">radius</span> <span class="o">=</span> <span class="nx">radius</span> <span class="o">*</span> <span class="mf">0.90</span>

<span class="err">#</span> <span class="nx">設計繪時鐘的函式</span>
<span class="nx">def</span> <span class="nx">drawClock</span><span class="p">()</span><span class="o">:</span>
    <span class="err">#</span> <span class="nx">繪鐘表面</span>
    <span class="nx">drawFace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span>
    <span class="err">#</span> <span class="nx">繪數字</span>
    <span class="nx">drawNumbers</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span>
    <span class="err">#</span> <span class="nx">繪時針分針與秒針</span>
    <span class="nx">drawTime</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">設計繪時鐘表面函式</span>
<span class="nx">def</span> <span class="nx">drawFace</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span><span class="o">:</span>
    <span class="err">#</span> <span class="nx">這裡先全部以白色覆蓋表面範圍</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">radius</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;white&#39;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>
    <span class="err">#</span> <span class="nx">利用漸層色繪製時鐘表面外框</span>
    <span class="nx">grad</span> <span class="o">=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">createRadialGradient</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">radius</span><span class="o">*</span><span class="mf">0.95</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nx">radius</span><span class="o">*</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="nx">grad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;#333&#39;</span><span class="p">)</span>
    <span class="nx">grad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;white&#39;</span><span class="p">)</span>
    <span class="nx">grad</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;#333&#39;</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">grad</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.1</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="err">#</span> <span class="nx">至此完成漸層色外框繪圖</span>
    <span class="err">#</span> <span class="nx">以下繪製正中心的</span> <span class="mi">10</span><span class="o">%</span> <span class="nx">半徑小黑點</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#333&#39;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">fill</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">設計繪製數字函式</span>
<span class="nx">def</span> <span class="nx">drawNumbers</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span><span class="o">:</span>
    <span class="err">#</span> <span class="nx">以半徑的比例決定字元大小</span><span class="p">,</span> <span class="nx">計算符點數後</span><span class="p">,</span> <span class="nx">轉為整數後</span><span class="p">,</span> <span class="nx">再轉為字串</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="nx">str</span><span class="p">(</span><span class="kr">int</span><span class="p">(</span><span class="nx">radius</span><span class="o">*</span><span class="mf">0.15</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;px arial&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">textBaseline</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">textAlign</span><span class="o">=</span><span class="s2">&quot;center&quot;</span>
    <span class="k">for</span> <span class="nx">num</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">ang</span> <span class="o">=</span> <span class="nx">num</span> <span class="o">*</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span> <span class="o">/</span> <span class="mi">6</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">ang</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">radius</span><span class="o">*</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="nx">str</span><span class="p">(</span><span class="nx">num</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">ang</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.85</span><span class="p">)</span>
        <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>

<span class="nx">def</span> <span class="nx">drawTime</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">radius</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">now</span> <span class="o">=</span> <span class="nx">datetime</span><span class="p">.</span><span class="nx">datetime</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span>
    <span class="err">#</span> <span class="nx">一小時有</span> <span class="mi">60</span> <span class="nx">分鐘</span><span class="p">,</span> <span class="nx">有</span> <span class="mi">3600</span> <span class="nx">秒</span><span class="p">,</span> 
    <span class="err">#</span><span class="nx">一小時的角度單位為</span> <span class="mi">360</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="nx">且度為</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="err">#</span><span class="nx">所以</span> <span class="nx">hour</span> <span class="nx">的時數必須乘上</span> <span class="mi">360</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="nx">再乘上</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="nx">等於</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">6</span>
    <span class="nx">hour</span> <span class="o">=</span> <span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">hour</span><span class="o">%</span><span class="mi">12</span> <span class="o">+</span> <span class="nx">now</span><span class="p">.</span><span class="nx">minute</span><span class="o">/</span><span class="mi">60</span> <span class="o">+</span> <span class="nx">now</span><span class="p">.</span><span class="nx">second</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">6</span>
    <span class="nx">drawHand</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">hour</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.5</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.07</span><span class="p">)</span>
    <span class="err">#</span><span class="nx">一分鐘有</span> <span class="mi">60</span> <span class="nx">秒</span><span class="p">,</span> <span class="nx">且一分鐘的角度單位為</span> <span class="mi">360</span><span class="o">/</span><span class="mi">60</span><span class="p">,</span> <span class="nx">且度為</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">180</span>
    <span class="err">#</span><span class="nx">所以分鐘數必須乘上</span> <span class="mi">360</span><span class="o">/</span><span class="mi">60</span><span class="p">,</span> <span class="nx">再乘上</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">,</span> <span class="nx">等於</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">30</span>
    <span class="nx">minute</span><span class="o">=</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">minute</span> <span class="o">+</span> <span class="nx">now</span><span class="p">.</span><span class="nx">second</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">30</span>
    <span class="nx">drawHand</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">minute</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.8</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.07</span><span class="p">)</span>
    <span class="err">#</span><span class="nx">秒鐘與分鐘相同</span><span class="p">,</span> <span class="nx">秒鐘數必須乘上</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">30</span>
    <span class="nx">second</span><span class="o">=</span><span class="p">(</span><span class="nx">now</span><span class="p">.</span><span class="nx">second</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">30</span><span class="p">)</span>
    <span class="nx">drawHand</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">second</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.9</span><span class="p">,</span> <span class="nx">radius</span><span class="o">*</span><span class="mf">0.02</span><span class="p">)</span>

<span class="nx">def</span> <span class="nx">drawHand</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">pos</span><span class="p">,</span> <span class="nx">length</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">width</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineCap</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">pos</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="nx">length</span><span class="p">)</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="o">-</span><span class="nx">pos</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">每</span> <span class="mi">1000</span> <span class="nx">個</span> <span class="nx">milliseconds</span> <span class="nx">呼叫執行一次</span> <span class="nx">drawClock</span> <span class="nx">函式</span> <span class="p">(</span><span class="nx">也就是每秒執行一次</span><span class="p">)</span>
<span class="nx">browser</span><span class="p">.</span><span class="nx">timer</span><span class="p">.</span><span class="nx">set_interval</span><span class="p">(</span><span class="nx">drawClock</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</td></tr></table>

<p><br /></p>
<p>在 Jupyter 利用 SVG 繪製正齒輪輪廓:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c"># source: https://gist.github.com/gever/8643175</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">SVG</span>
<span class="kn">import</span> <span class="nn">svgwrite</span>

<span class="c"># gear parameters</span>
<span class="n">outer_d</span> <span class="o">=</span> <span class="mf">500.0</span>
<span class="n">tooth_ht</span> <span class="o">=</span> <span class="mf">40.0</span>   <span class="c"># addendum + dedendum (aka, top land radius - root circle)</span>
<span class="n">tooth_ct</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">face_pct</span> <span class="o">=</span> <span class="mf">0.2</span>    <span class="c"># how much narrower the face pitch is than the circular thickness</span>
<span class="n">axle_d</span> <span class="o">=</span> <span class="mi">50</span>

<span class="c"># derived parameters</span>
<span class="n">inner_d</span> <span class="o">=</span> <span class="n">outer_d</span> <span class="o">-</span> <span class="n">tooth_ht</span>

<span class="c"># colors important to the laser cutter</span>
<span class="n">LC_CUT</span> <span class="o">=</span> <span class="n">svgwrite</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">LC_SCORE</span> <span class="o">=</span> <span class="n">svgwrite</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
<span class="n">LC_ETCH</span> <span class="o">=</span> <span class="n">svgwrite</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">LC_NONE</span> <span class="o">=</span> <span class="n">svgwrite</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

<span class="c"># derived constants</span>
<span class="n">outer_circ</span> <span class="o">=</span> <span class="n">outer_d</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">outer_r</span> <span class="o">=</span> <span class="n">outer_d</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="n">inner_r</span> <span class="o">=</span> <span class="n">outer_r</span> <span class="o">-</span> <span class="n">tooth_ht</span>
<span class="n">addendum</span> <span class="o">=</span> <span class="n">tooth_ht</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="n">addendum_r</span> <span class="o">=</span> <span class="n">outer_r</span> <span class="o">-</span> <span class="n">addendum</span>
<span class="n">circular_pitch</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="n">tooth_ct</span>
<span class="n">circular_thickness</span> <span class="o">=</span> <span class="n">circular_pitch</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="n">theta_face</span> <span class="o">=</span> <span class="n">circular_thickness</span> <span class="o">*</span> <span class="n">face_pct</span> <span class="c"># bevel pitch delta in radians</span>

<span class="c"># clear out the contents of the old file, get ready to make a new one</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s">&#39;gear_</span><span class="si">%d</span><span class="s">.svg&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tooth_ct</span><span class="p">)</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span> <span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span> <span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">filename</span> <span class="p">)</span>

<span class="c"># start the drawing</span>
<span class="n">dwg</span> <span class="o">=</span> <span class="n">svgwrite</span><span class="o">.</span><span class="n">Drawing</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">profile</span><span class="o">=</span><span class="s">&#39;tiny&#39;</span><span class="p">)</span>
<span class="n">group</span> <span class="o">=</span> <span class="n">dwg</span><span class="o">.</span><span class="n">g</span><span class="p">()</span>

<span class="c"># generate points that describe the gear profile</span>
<span class="n">pts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tooth_ct</span><span class="p">):</span>
    <span class="n">theta_1</span> <span class="o">=</span> <span class="n">circular_pitch</span> <span class="o">*</span> <span class="n">t</span> <span class="c"># begining of tooth and gap</span>
    <span class="n">theta_ct</span> <span class="o">=</span> <span class="n">theta_1</span> <span class="o">+</span> <span class="n">circular_thickness</span> <span class="c"># circular thickness (of tooth)</span>
    <span class="n">theta_2</span> <span class="o">=</span> <span class="n">circular_pitch</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="c"># begining of next tooth</span>

    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_1</span><span class="p">)</span> <span class="o">*</span> <span class="n">addendum_r</span><span class="p">,</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_1</span><span class="p">)</span> <span class="o">*</span> <span class="n">addendum_r</span> <span class="p">)</span> <span class="p">)</span> <span class="c"># begining of face leading up to top land</span>
    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_1</span> <span class="o">+</span> <span class="n">theta_face</span><span class="p">)</span> <span class="o">*</span> <span class="n">outer_r</span><span class="p">,</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_1</span> <span class="o">+</span> <span class="n">theta_face</span><span class="p">)</span> <span class="o">*</span> <span class="n">outer_r</span><span class="p">)</span> <span class="p">)</span>   <span class="c"># begining of top land</span>
    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_ct</span> <span class="o">-</span> <span class="n">theta_face</span><span class="p">)</span> <span class="o">*</span> <span class="n">outer_r</span><span class="p">,</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_ct</span> <span class="o">-</span> <span class="n">theta_face</span><span class="p">)</span> <span class="o">*</span> <span class="n">outer_r</span><span class="p">)</span> <span class="p">)</span> <span class="c"># end of top land    </span>
    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_ct</span><span class="p">)</span> <span class="o">*</span> <span class="n">addendum_r</span><span class="p">,</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_ct</span><span class="p">)</span> <span class="o">*</span> <span class="n">addendum_r</span> <span class="p">)</span> <span class="p">)</span> <span class="c"># end of face coming down from top land</span>
    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_ct</span><span class="p">)</span> <span class="o">*</span> <span class="n">inner_r</span><span class="p">,</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_ct</span><span class="p">)</span> <span class="o">*</span> <span class="n">inner_r</span><span class="p">)</span> <span class="p">)</span> <span class="c"># begining of bottom land</span>
    <span class="n">pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">inner_r</span><span class="p">,</span>
                 <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_2</span><span class="p">)</span> <span class="o">*</span> <span class="n">inner_r</span><span class="p">)</span> <span class="p">)</span>   <span class="c"># end of bottom land</span>

    <span class="c"># mark the first tooth</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">circle</span> <span class="o">=</span> <span class="n">dwg</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span> <span class="n">center</span><span class="o">=</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="n">tooth_ht</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="n">LC_SCORE</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">LC_NONE</span> <span class="p">)</span>
        <span class="n">group</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">circle</span> <span class="p">)</span>

<span class="n">group</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">dwg</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span> <span class="n">pts</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="n">LC_CUT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">LC_NONE</span> <span class="p">)</span> <span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span> <span class="n">outer_d</span><span class="p">,</span> <span class="n">outer_d</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="p">)</span>

<span class="c"># make a hole for the axle</span>
<span class="c"># TODO: calculate the number of steps in axle polygon based on circumference of axle</span>
<span class="n">a_pts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="mi">50</span> <span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="p">((</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">a_pts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">axle_d</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">axle_d</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="p">)</span>
<span class="n">group</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">dwg</span><span class="o">.</span><span class="n">polygon</span><span class="p">(</span> <span class="n">a_pts</span><span class="p">,</span> <span class="n">stroke</span><span class="o">=</span><span class="n">LC_CUT</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">LC_NONE</span> <span class="p">)</span> <span class="p">)</span>

<span class="n">dwg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">group</span> <span class="p">)</span>

<span class="c"># dwg.add(dwg.text(&#39;Test&#39;, insert=(0, 0.2), fill=&#39;red&#39;))</span>
<span class="c"># dwg.save()</span>

<span class="c"># show it</span>
<span class="n">SVG</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">dwg</span><span class="o">.</span><span class="n">tostring</span><span class="p">())</span>
</pre></div>
</td></tr></table>

<p><br />
利用 Brython 繪製漸開線正齒輪輪廓圖:</p>
<!-- 建立正齒輪畫布 -->

<canvas id="gear1" width="400" height="400" style="background-color:#FFF"></canvas>

<!-- 開始執行 Brython 繪圖 -->

<script type="text/python3">
# 導入 browser 模組中的 document, 並設為 doc 變數
from browser import document as doc
import math
# deg 為角度轉為徑度的轉換因子
deg = math.pi/180.
# 定義 Spur 類別
class Spur(object):
    def __init__(self, ctx):
        self.ctx = ctx

    def create_line(self, x1, y1, x2, y2, width=3, fill="red"):
        self.ctx.beginPath()
        self.ctx.lineWidth = width
        self.ctx.moveTo(x1, y1)
        self.ctx.lineTo(x2, y2)
        self.ctx.strokeStyle = fill
        self.ctx.stroke()
    #
    # 定義一個繪正齒輪的繪圖函式
    # midx 為齒輪圓心 x 座標
    # midy 為齒輪圓心 y 座標
    # rp 為節圓半徑, n 為齒數
    # pa 為壓力角 (deg)
    # rot 為旋轉角 (deg)
    # 已經針對 n 大於等於 52 齒時的繪圖錯誤修正, 因為 base circle 與齒根圓大小必須進行判斷
    def Gear(self, midx, midy, rp, n=20, pa=20, color="black"):
        # 齒輪漸開線分成 15 線段繪製
        imax = 15
        # 在輸入的畫布上繪製直線, 由圓心到節圓 y 軸頂點畫一直線
        self.create_line(midx, midy, midx, midy-rp)
        # 畫出 rp 圓, 畫圓函式尚未定義
        #create_oval(midx-rp, midy-rp, midx+rp, midy+rp, width=2)
        # a 為模數 (代表公制中齒的大小), 模數為節圓直徑(稱為節徑)除以齒數
        # 模數也就是齒冠大小
        a=2*rp/n
        # d 為齒根大小, 為模數的 1.157 或 1.25倍, 這裡採 1.25 倍
        d=2.5*rp/n
        # ra 為齒輪的外圍半徑
        ra=rp+a
        # 畫出 ra 圓, 畫圓函式尚未定義
        #create_oval(midx-ra, midy-ra, midx+ra, midy+ra, width=1)
        # rb 則為齒輪的基圓半徑
        # 基圓為漸開線長齒之基準圓
        rb=rp*math.cos(pa*deg)
        # 畫出 rb 圓 (基圓), 畫圓函式尚未定義
        #create_oval(midx-rb, midy-rb, midx+rb, midy+rb, width=1)
        # rd 為齒根圓半徑
        rd=rp-d
        # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
        # 畫出 rd 圓 (齒根圓), 畫圓函式尚未定義
        #create_oval(midx-rd, midy-rd, midx+rd, midy+rd, width=1)
        # dr 則為基圓到齒頂圓半徑分成 imax 段後的每段半徑增量大小
        # 將圓弧分成 imax 段來繪製漸開線
        # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
        if rd>rb:
            dr = (ra-rd)/imax
        else:
            dr=(ra-rb)/imax
        # tan(pa*deg)-pa*deg 為漸開線函數
        sigma=math.pi/(2*n)+math.tan(pa*deg)-pa*deg
        for j in range(n):
            ang=-2.*j*math.pi/n+sigma
            ang2=2.*j*math.pi/n+sigma
            lxd=midx+rd*math.sin(ang2-2.*math.pi/n)
            lyd=midy-rd*math.cos(ang2-2.*math.pi/n)
            for i in range(imax+1):
                # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
                if rd>rb:
                    r=rd+i*dr
                else:
                    r=rb+i*dr
                theta=math.sqrt((r*r)/(rb*rb)-1.)
                alpha=theta-math.atan(theta)
                xpt=r*math.sin(alpha-ang)
                ypt=r*math.cos(alpha-ang)
                xd=rd*math.sin(-ang)
                yd=rd*math.cos(-ang)
                # i=0 時, 繪線起點由齒根圓上的點, 作為起點
                if(i==0):
                    last_x = midx+xd
                    last_y = midy-yd
                # 由左側齒根圓作為起點, 除第一點 (xd,yd) 齒根圓上的起點外, 其餘的 (xpt,ypt)則為漸開線上的分段點
                self.create_line((midx+xpt),(midy-ypt),(last_x),(last_y),fill=color)
                # 最後一點, 則為齒頂圓
                if(i==imax):
                    lfx=midx+xpt
                    lfy=midy-ypt
                last_x = midx+xpt
                last_y = midy-ypt
            # the line from last end of dedendum point to the recent
            # end of dedendum point
            # lxd 為齒根圓上的左側 x 座標, lyd 則為 y 座標
            # 下列為齒根圓上用來近似圓弧的直線
            self.create_line((lxd),(lyd),(midx+xd),(midy-yd),fill=color)
            for i in range(imax+1):
                # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
                if rd>rb:
                    r=rd+i*dr
                else:
                    r=rb+i*dr
                theta=math.sqrt((r*r)/(rb*rb)-1.)
                alpha=theta-math.atan(theta)
                xpt=r*math.sin(ang2-alpha)
                ypt=r*math.cos(ang2-alpha)
                xd=rd*math.sin(ang2)
                yd=rd*math.cos(ang2)
                # i=0 時, 繪線起點由齒根圓上的點, 作為起點
                if(i==0):
                    last_x = midx+xd
                    last_y = midy-yd
                # 由右側齒根圓作為起點, 除第一點 (xd,yd) 齒根圓上的起點外, 其餘的 (xpt,ypt)則為漸開線上的分段點
                self.create_line((midx+xpt),(midy-ypt),(last_x),(last_y),fill=color)
                # 最後一點, 則為齒頂圓
                if(i==imax):
                    rfx=midx+xpt
                    rfy=midy-ypt
                last_x = midx+xpt
                last_y = midy-ypt
            # lfx 為齒頂圓上的左側 x 座標, lfy 則為 y 座標
            # 下列為齒頂圓上用來近似圓弧的直線
            self.create_line(lfx,lfy,rfx,rfy,fill=color)

# 準備在 id="gear1" 的 canvas 中繪圖
canvas = doc["gear1"]
ctx = canvas.getContext("2d")
x = (canvas.width)/2
y = (canvas.height)/2
r = 0.8*(canvas.width/2)
# 齒數
n = 53
# 壓力角
pa = 20
Spur(ctx).Gear(x, y, r, n, pa, "blue")
</script>

<p>以下為單一正齒輪輪廓繪圖程式碼:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">&lt;!-- 建立正齒輪畫布 --&gt;</span>
<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;gear1&quot;</span> <span class="na">width=</span><span class="s">&quot;400&quot;</span> <span class="na">height=</span><span class="s">&quot;400&quot;</span> <span class="na">style=</span><span class="s">&quot;background-color:#FFF&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="c">&lt;!-- 開始執行 Brython 繪圖 --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/python3&quot;</span><span class="nt">&gt;</span>
<span class="err">#</span> <span class="nx">導入</span> <span class="nx">browser</span> <span class="nx">模組中的</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">並設為</span> <span class="nx">doc</span> <span class="nx">變數</span>
<span class="nx">from</span> <span class="nx">browser</span> <span class="kr">import</span> <span class="nb">document</span> <span class="nx">as</span> <span class="nx">doc</span>
<span class="kr">import</span> <span class="nx">math</span>
<span class="err">#</span> <span class="nx">deg</span> <span class="nx">為角度轉為徑度的轉換因子</span>
<span class="nx">deg</span> <span class="o">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">.</span>
<span class="err">#</span> <span class="nx">定義</span> <span class="nx">Spur</span> <span class="nx">類別</span>
<span class="kr">class</span> <span class="nx">Spur</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span>

    <span class="nx">def</span> <span class="nx">create_line</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nx">fill</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">width</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">fill</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="err">#</span>
    <span class="err">#</span> <span class="nx">定義一個繪正齒輪的繪圖函式</span>
    <span class="err">#</span> <span class="nx">midx</span> <span class="nx">為齒輪圓心</span> <span class="nx">x</span> <span class="nx">座標</span>
    <span class="err">#</span> <span class="nx">midy</span> <span class="nx">為齒輪圓心</span> <span class="nx">y</span> <span class="nx">座標</span>
    <span class="err">#</span> <span class="nx">rp</span> <span class="nx">為節圓半徑</span><span class="p">,</span> <span class="nx">n</span> <span class="nx">為齒數</span>
    <span class="err">#</span> <span class="nx">pa</span> <span class="nx">為壓力角</span> <span class="p">(</span><span class="nx">deg</span><span class="p">)</span>
    <span class="err">#</span> <span class="nx">rot</span> <span class="nx">為旋轉角</span> <span class="p">(</span><span class="nx">deg</span><span class="p">)</span>
    <span class="err">#</span> <span class="nx">已經針對</span> <span class="nx">n</span> <span class="nx">大於等於</span> <span class="mi">52</span> <span class="nx">齒時的繪圖錯誤修正</span><span class="p">,</span> <span class="nx">因為</span> <span class="nx">base</span> <span class="nx">circle</span> <span class="nx">與齒根圓大小必須進行判斷</span>
    <span class="nx">def</span> <span class="nx">Gear</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">midx</span><span class="p">,</span> <span class="nx">midy</span><span class="p">,</span> <span class="nx">rp</span><span class="p">,</span> <span class="nx">n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nx">pa</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nx">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="nx">齒輪漸開線分成</span> <span class="mi">15</span> <span class="nx">線段繪製</span>
        <span class="nx">imax</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="err">#</span> <span class="nx">在輸入的畫布上繪製直線</span><span class="p">,</span> <span class="nx">由圓心到節圓</span> <span class="nx">y</span> <span class="nx">軸頂點畫一直線</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">(</span><span class="nx">midx</span><span class="p">,</span> <span class="nx">midy</span><span class="p">,</span> <span class="nx">midx</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rp</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">rp</span> <span class="nx">圓</span><span class="p">,</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">a</span> <span class="nx">為模數</span> <span class="p">(</span><span class="nx">代表公制中齒的大小</span><span class="p">),</span> <span class="nx">模數為節圓直徑</span><span class="p">(</span><span class="nx">稱為節徑</span><span class="p">)</span><span class="nx">除以齒數</span>
        <span class="err">#</span> <span class="nx">模數也就是齒冠大小</span>
        <span class="nx">a</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nx">rp</span><span class="o">/</span><span class="nx">n</span>
        <span class="err">#</span> <span class="nx">d</span> <span class="nx">為齒根大小</span><span class="p">,</span> <span class="nx">為模數的</span> <span class="mf">1.157</span> <span class="nx">或</span> <span class="mf">1.25</span><span class="nx">倍</span><span class="p">,</span> <span class="nx">這裡採</span> <span class="mf">1.25</span> <span class="nx">倍</span>
        <span class="nx">d</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="nx">rp</span><span class="o">/</span><span class="nx">n</span>
        <span class="err">#</span> <span class="nx">ra</span> <span class="nx">為齒輪的外圍半徑</span>
        <span class="nx">ra</span><span class="o">=</span><span class="nx">rp</span><span class="o">+</span><span class="nx">a</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">ra</span> <span class="nx">圓</span><span class="p">,</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">rb</span> <span class="nx">則為齒輪的基圓半徑</span>
        <span class="err">#</span> <span class="nx">基圓為漸開線長齒之基準圓</span>
        <span class="nx">rb</span><span class="o">=</span><span class="nx">rp</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">rb</span> <span class="nx">圓</span> <span class="p">(</span><span class="nx">基圓</span><span class="p">),</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">rd</span> <span class="nx">為齒根圓半徑</span>
        <span class="nx">rd</span><span class="o">=</span><span class="nx">rp</span><span class="o">-</span><span class="nx">d</span>
        <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">rd</span> <span class="nx">圓</span> <span class="p">(</span><span class="nx">齒根圓</span><span class="p">),</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">dr</span> <span class="nx">則為基圓到齒頂圓半徑分成</span> <span class="nx">imax</span> <span class="nx">段後的每段半徑增量大小</span>
        <span class="err">#</span> <span class="nx">將圓弧分成</span> <span class="nx">imax</span> <span class="nx">段來繪製漸開線</span>
        <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
        <span class="k">if</span> <span class="nx">rd</span><span class="o">&gt;</span><span class="nx">rb</span><span class="o">:</span>
            <span class="nx">dr</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ra</span><span class="o">-</span><span class="nx">rd</span><span class="p">)</span><span class="o">/</span><span class="nx">imax</span>
        <span class="k">else</span><span class="o">:</span>
            <span class="nx">dr</span><span class="o">=</span><span class="p">(</span><span class="nx">ra</span><span class="o">-</span><span class="nx">rb</span><span class="p">)</span><span class="o">/</span><span class="nx">imax</span>
        <span class="err">#</span> <span class="nx">tan</span><span class="p">(</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span><span class="p">)</span><span class="o">-</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span> <span class="nx">為漸開線函數</span>
        <span class="nx">sigma</span><span class="o">=</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">math</span><span class="p">.</span><span class="nx">tan</span><span class="p">(</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span><span class="p">)</span><span class="o">-</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">:</span>
            <span class="nx">ang</span><span class="o">=-</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">j</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="o">+</span><span class="nx">sigma</span>
            <span class="nx">ang2</span><span class="o">=</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">j</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="o">+</span><span class="nx">sigma</span>
            <span class="nx">lxd</span><span class="o">=</span><span class="nx">midx</span><span class="o">+</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="p">)</span>
            <span class="nx">lyd</span><span class="o">=</span><span class="nx">midy</span><span class="o">-</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">imax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span>
                <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
                <span class="k">if</span> <span class="nx">rd</span><span class="o">&gt;</span><span class="nx">rb</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rd</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="k">else</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rb</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="nx">theta</span><span class="o">=</span><span class="nx">math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">r</span><span class="o">*</span><span class="nx">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">rb</span><span class="o">*</span><span class="nx">rb</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">.)</span>
                <span class="nx">alpha</span><span class="o">=</span><span class="nx">theta</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
                <span class="nx">xpt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">alpha</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="nx">ypt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">alpha</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="nx">xd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="nx">yd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">繪線起點由齒根圓上的點</span><span class="p">,</span> <span class="nx">作為起點</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xd</span>
                    <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">yd</span>
                <span class="err">#</span> <span class="nx">由左側齒根圓作為起點</span><span class="p">,</span> <span class="nx">除第一點</span> <span class="p">(</span><span class="nx">xd</span><span class="p">,</span><span class="nx">yd</span><span class="p">)</span> <span class="nx">齒根圓上的起點外</span><span class="p">,</span> <span class="nx">其餘的</span> <span class="p">(</span><span class="nx">xpt</span><span class="p">,</span><span class="nx">ypt</span><span class="p">)</span><span class="nx">則為漸開線上的分段點</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">((</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span><span class="p">),(</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span><span class="p">),(</span><span class="nx">last_x</span><span class="p">),(</span><span class="nx">last_y</span><span class="p">),</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">最後一點</span><span class="p">,</span> <span class="nx">則為齒頂圓</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="nx">imax</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">lfx</span><span class="o">=</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                    <span class="nx">lfy</span><span class="o">=</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
                <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
            <span class="err">#</span> <span class="nx">the</span> <span class="nx">line</span> <span class="nx">from</span> <span class="nx">last</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">dedendum</span> <span class="nx">point</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">recent</span>
            <span class="err">#</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">dedendum</span> <span class="nx">point</span>
            <span class="err">#</span> <span class="nx">lxd</span> <span class="nx">為齒根圓上的左側</span> <span class="nx">x</span> <span class="nx">座標</span><span class="p">,</span> <span class="nx">lyd</span> <span class="nx">則為</span> <span class="nx">y</span> <span class="nx">座標</span>
            <span class="err">#</span> <span class="nx">下列為齒根圓上用來近似圓弧的直線</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">((</span><span class="nx">lxd</span><span class="p">),(</span><span class="nx">lyd</span><span class="p">),(</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xd</span><span class="p">),(</span><span class="nx">midy</span><span class="o">-</span><span class="nx">yd</span><span class="p">),</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">imax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span>
                <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
                <span class="k">if</span> <span class="nx">rd</span><span class="o">&gt;</span><span class="nx">rb</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rd</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="k">else</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rb</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="nx">theta</span><span class="o">=</span><span class="nx">math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">r</span><span class="o">*</span><span class="nx">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">rb</span><span class="o">*</span><span class="nx">rb</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">.)</span>
                <span class="nx">alpha</span><span class="o">=</span><span class="nx">theta</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
                <span class="nx">xpt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="nx">alpha</span><span class="p">)</span>
                <span class="nx">ypt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="nx">alpha</span><span class="p">)</span>
                <span class="nx">xd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">ang2</span><span class="p">)</span>
                <span class="nx">yd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">ang2</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">繪線起點由齒根圓上的點</span><span class="p">,</span> <span class="nx">作為起點</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xd</span>
                    <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">yd</span>
                <span class="err">#</span> <span class="nx">由右側齒根圓作為起點</span><span class="p">,</span> <span class="nx">除第一點</span> <span class="p">(</span><span class="nx">xd</span><span class="p">,</span><span class="nx">yd</span><span class="p">)</span> <span class="nx">齒根圓上的起點外</span><span class="p">,</span> <span class="nx">其餘的</span> <span class="p">(</span><span class="nx">xpt</span><span class="p">,</span><span class="nx">ypt</span><span class="p">)</span><span class="nx">則為漸開線上的分段點</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">((</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span><span class="p">),(</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span><span class="p">),(</span><span class="nx">last_x</span><span class="p">),(</span><span class="nx">last_y</span><span class="p">),</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">最後一點</span><span class="p">,</span> <span class="nx">則為齒頂圓</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="nx">imax</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">rfx</span><span class="o">=</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                    <span class="nx">rfy</span><span class="o">=</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
                <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
            <span class="err">#</span> <span class="nx">lfx</span> <span class="nx">為齒頂圓上的左側</span> <span class="nx">x</span> <span class="nx">座標</span><span class="p">,</span> <span class="nx">lfy</span> <span class="nx">則為</span> <span class="nx">y</span> <span class="nx">座標</span>
            <span class="err">#</span> <span class="nx">下列為齒頂圓上用來近似圓弧的直線</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">(</span><span class="nx">lfx</span><span class="p">,</span><span class="nx">lfy</span><span class="p">,</span><span class="nx">rfx</span><span class="p">,</span><span class="nx">rfy</span><span class="p">,</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">準備在</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;gear1&quot;</span> <span class="nx">的</span> <span class="nx">canvas</span> <span class="nx">中繪圖</span>
<span class="nx">canvas</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="s2">&quot;gear1&quot;</span><span class="p">]</span>
<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>
<span class="nx">x</span> <span class="o">=</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<span class="nx">r</span> <span class="o">=</span> <span class="mf">0.8</span><span class="o">*</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">齒數</span>
<span class="nx">n</span> <span class="o">=</span> <span class="mi">53</span>
<span class="err">#</span> <span class="nx">壓力角</span>
<span class="nx">pa</span> <span class="o">=</span> <span class="mi">20</span>
<span class="nx">Spur</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Gear</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">pa</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</td></tr></table>

<p><br />
以下則繪製三個齒輪囓合圖:</p>
<!-- 建立正齒輪畫布 -->

<canvas id="gear2" width="800" height="400" style="background-color:#FFF"></canvas>

<!-- 開始執行 Brython 繪圖 -->

<script type="text/python3">
# 導入 browser 模組中的 document, 並設為 doc 變數
from browser import document as doc
import math
# deg 為角度轉為徑度的轉換因子
deg = math.pi/180.
# 定義 Spur 類別
class Spur(object):
    def __init__(self, ctx):
        self.ctx = ctx

    def create_line(self, x1, y1, x2, y2, width=3, fill="red"):
        self.ctx.beginPath()
        self.ctx.lineWidth = width
        self.ctx.moveTo(x1, y1)
        self.ctx.lineTo(x2, y2)
        self.ctx.strokeStyle = fill
        self.ctx.stroke()
    #
    # 定義一個繪正齒輪的繪圖函式
    # midx 為齒輪圓心 x 座標
    # midy 為齒輪圓心 y 座標
    # rp 為節圓半徑, n 為齒數
    # pa 為壓力角 (deg)
    # rot 為旋轉角 (deg)
    # 已經針對 n 大於等於 52 齒時的繪圖錯誤修正, 因為 base circle 與齒根圓大小必須進行判斷
    def Gear(self, midx, midy, rp, n=20, pa=20, color="black"):
        # 齒輪漸開線分成 15 線段繪製
        imax = 15
        # 在輸入的畫布上繪製直線, 由圓心到節圓 y 軸頂點畫一直線
        self.create_line(midx, midy, midx, midy-rp)
        # 畫出 rp 圓, 畫圓函式尚未定義
        #create_oval(midx-rp, midy-rp, midx+rp, midy+rp, width=2)
        # a 為模數 (代表公制中齒的大小), 模數為節圓直徑(稱為節徑)除以齒數
        # 模數也就是齒冠大小
        a=2*rp/n
        # d 為齒根大小, 為模數的 1.157 或 1.25倍, 這裡採 1.25 倍
        d=2.5*rp/n
        # ra 為齒輪的外圍半徑
        ra=rp+a
        # 畫出 ra 圓, 畫圓函式尚未定義
        #create_oval(midx-ra, midy-ra, midx+ra, midy+ra, width=1)
        # rb 則為齒輪的基圓半徑
        # 基圓為漸開線長齒之基準圓
        rb=rp*math.cos(pa*deg)
        # 畫出 rb 圓 (基圓), 畫圓函式尚未定義
        #create_oval(midx-rb, midy-rb, midx+rb, midy+rb, width=1)
        # rd 為齒根圓半徑
        rd=rp-d
        # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
        # 畫出 rd 圓 (齒根圓), 畫圓函式尚未定義
        #create_oval(midx-rd, midy-rd, midx+rd, midy+rd, width=1)
        # dr 則為基圓到齒頂圓半徑分成 imax 段後的每段半徑增量大小
        # 將圓弧分成 imax 段來繪製漸開線
        # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
        if rd>rb:
            dr = (ra-rd)/imax
        else:
            dr=(ra-rb)/imax
        # tan(pa*deg)-pa*deg 為漸開線函數
        sigma=math.pi/(2*n)+math.tan(pa*deg)-pa*deg
        for j in range(n):
            ang=-2.*j*math.pi/n+sigma
            ang2=2.*j*math.pi/n+sigma
            lxd=midx+rd*math.sin(ang2-2.*math.pi/n)
            lyd=midy-rd*math.cos(ang2-2.*math.pi/n)
            for i in range(imax+1):
                # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
                if rd>rb:
                    r=rd+i*dr
                else:
                    r=rb+i*dr
                theta=math.sqrt((r*r)/(rb*rb)-1.)
                alpha=theta-math.atan(theta)
                xpt=r*math.sin(alpha-ang)
                ypt=r*math.cos(alpha-ang)
                xd=rd*math.sin(-ang)
                yd=rd*math.cos(-ang)
                # i=0 時, 繪線起點由齒根圓上的點, 作為起點
                if(i==0):
                    last_x = midx+xd
                    last_y = midy-yd
                # 由左側齒根圓作為起點, 除第一點 (xd,yd) 齒根圓上的起點外, 其餘的 (xpt,ypt)則為漸開線上的分段點
                self.create_line((midx+xpt),(midy-ypt),(last_x),(last_y),fill=color)
                # 最後一點, 則為齒頂圓
                if(i==imax):
                    lfx=midx+xpt
                    lfy=midy-ypt
                last_x = midx+xpt
                last_y = midy-ypt
            # the line from last end of dedendum point to the recent
            # end of dedendum point
            # lxd 為齒根圓上的左側 x 座標, lyd 則為 y 座標
            # 下列為齒根圓上用來近似圓弧的直線
            self.create_line((lxd),(lyd),(midx+xd),(midy-yd),fill=color)
            for i in range(imax+1):
                # 當 rd 大於 rb 時, 漸開線並非畫至 rb, 而是 rd
                if rd>rb:
                    r=rd+i*dr
                else:
                    r=rb+i*dr
                theta=math.sqrt((r*r)/(rb*rb)-1.)
                alpha=theta-math.atan(theta)
                xpt=r*math.sin(ang2-alpha)
                ypt=r*math.cos(ang2-alpha)
                xd=rd*math.sin(ang2)
                yd=rd*math.cos(ang2)
                # i=0 時, 繪線起點由齒根圓上的點, 作為起點
                if(i==0):
                    last_x = midx+xd
                    last_y = midy-yd
                # 由右側齒根圓作為起點, 除第一點 (xd,yd) 齒根圓上的起點外, 其餘的 (xpt,ypt)則為漸開線上的分段點
                self.create_line((midx+xpt),(midy-ypt),(last_x),(last_y),fill=color)
                # 最後一點, 則為齒頂圓
                if(i==imax):
                    rfx=midx+xpt
                    rfy=midy-ypt
                last_x = midx+xpt
                last_y = midy-ypt
            # lfx 為齒頂圓上的左側 x 座標, lfy 則為 y 座標
            # 下列為齒頂圓上用來近似圓弧的直線
            self.create_line(lfx,lfy,rfx,rfy,fill=color)

# 準備在 id="gear2" 的 canvas 中繪圖
canvas = doc["gear2"]
ctx = canvas.getContext("2d")

# 模數決定齒的尺寸大小, 囓合齒輪組必須有相同的模數與壓力角
# 壓力角 pa 單位為角度
pa = 20
# 第1齒輪齒數
n_g1 = 17
# 第2齒輪齒數
n_g2 = 11
# 第3齒輪齒數
n_g3 = 13
# m 為模數, 根據畫布的寬度, 計算適合的模數大小
m = (0.8*canvas.width)/(n_g1+n_g2+n_g3)
# 根據模數 m, 計算各齒輪的節圓半徑
rp_g1 = m*n_g1/2
rp_g2 = m*n_g2/2
rp_g3 = m*n_g3/2
#單一正齒輪繪圖呼叫格式 Spur(ctx).Gear(x, y, r, n, pa, "blue")
# 開始繪製囓合齒輪輪廓
# 繪圖第1齒輪的圓心座標, 因為希望繪圖佔去 canvas.width 的 80%, 所以兩邊各預留 10% 距離
x_g1 = canvas.width*0.1+rp_g1
# y 方向繪圖區域上方預留 canvas.height 的 20%
y_g1 = canvas.height*0.2+rp_g1
# 第2齒輪的圓心座標, 假設排列成水平, 表示各齒輪圓心 y 座標相同
x_g2 = x_g1 + rp_g1 + rp_g2
y_g2 = y_g1
# 第3齒輪的圓心座標
x_g3 = x_g1 + rp_g1 + 2*rp_g2 + rp_g3
y_g3 = y_g1

# 將第1齒輪順時鐘轉 90 度, 也就是 math.pi/2
# 使用 ctx.save() 與 ctx.restore() 以確保各齒輪以相對座標進行旋轉繪圖
ctx.save()
# translate to the origin of second gear
ctx.translate(x_g1, y_g1)
# rotate to engage
ctx.rotate(math.pi/2)
# put it back
ctx.translate(-x_g1, -y_g1)
# 繪製第一個齒輪輪廓
Spur(ctx).Gear(x_g1, y_g1, rp_g1, n_g1, pa, "blue")
ctx.restore()

# 將第2齒輪逆時鐘轉 90 度之後, 再多轉一齒, 以便與第1齒輪進行囓合
ctx.save()
# translate to the origin of second gear
ctx.translate(x_g2, y_g2)
# rotate to engage
ctx.rotate(-math.pi/2-math.pi/n_g2)
# put it back
ctx.translate(-x_g2, -y_g2)
Spur(ctx).Gear(x_g2, y_g2, rp_g2, n_g2, pa, "black")
ctx.restore()

# 將第3齒輪逆時鐘轉 90 度之後, 再往回轉第2齒輪定位帶動轉角, 然後再逆時鐘多轉一齒, 以便與第2齒輪進行囓合
ctx.save()
# translate to the origin of second gear
ctx.translate(x_g3, y_g3)
# rotate to engage
# math.pi+math.pi/n_g2 為第2齒輪從順時鐘轉 90 度之後, 必須配合目前的標記線所作的齒輪 2 轉動角度, 要轉換到齒輪3 的轉動角度
# 必須乘上兩齒輪齒數的比例, 若齒輪2 大, 則齒輪3 會轉動較快
# 第1個 -math.pi/2 為將原先垂直的第3齒輪定位線逆時鐘旋轉 90 度
# -math.pi/n_g3 則是第3齒與第2齒定位線重合後, 必須再逆時鐘多轉一齒的轉角, 以便進行囓合
# (math.pi+math.pi/n_g2)*n_g2/n_g3 則是第2齒原定位線為順時鐘轉動 90 度, 
# 但是第2齒輪為了與第1齒輪囓合, 已經距離定位線, 多轉了 180 度, 再加上第2齒輪的一齒角度, 因為要帶動第3齒輪定位, 
# 這個修正角度必須要再配合第2齒與第3齒的轉速比加以轉換成第3齒輪的轉角, 因此乘上 n_g2/n_g3
ctx.rotate(-math.pi/2-math.pi/n_g3+(math.pi+math.pi/n_g2)*n_g2/n_g3)
# put it back
ctx.translate(-x_g3, -y_g3)
Spur(ctx).Gear(x_g3, y_g3, rp_g3, n_g3, pa, "red")
ctx.restore()
</script>

<p>以下為3個齒輪囓合繪圖程式碼:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202</pre></div></td><td class="code"><div class="codehilite"><pre><span class="c">&lt;!-- 建立正齒輪畫布 --&gt;</span>
<span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;gear2&quot;</span> <span class="na">width=</span><span class="s">&quot;800&quot;</span> <span class="na">height=</span><span class="s">&quot;400&quot;</span> <span class="na">style=</span><span class="s">&quot;background-color:#FFF&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
<span class="c">&lt;!-- 開始執行 Brython 繪圖 --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/python3&quot;</span><span class="nt">&gt;</span>
<span class="err">#</span> <span class="nx">導入</span> <span class="nx">browser</span> <span class="nx">模組中的</span> <span class="nb">document</span><span class="p">,</span> <span class="nx">並設為</span> <span class="nx">doc</span> <span class="nx">變數</span>
<span class="nx">from</span> <span class="nx">browser</span> <span class="kr">import</span> <span class="nb">document</span> <span class="nx">as</span> <span class="nx">doc</span>
<span class="kr">import</span> <span class="nx">math</span>
<span class="err">#</span> <span class="nx">deg</span> <span class="nx">為角度轉為徑度的轉換因子</span>
<span class="nx">deg</span> <span class="o">=</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">.</span>
<span class="err">#</span> <span class="nx">定義</span> <span class="nx">Spur</span> <span class="nx">類別</span>
<span class="kr">class</span> <span class="nx">Spur</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span><span class="o">:</span>
    <span class="nx">def</span> <span class="nx">__init__</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">ctx</span>

    <span class="nx">def</span> <span class="nx">create_line</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">,</span> <span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="nx">fill</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span><span class="o">:</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">()</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineWidth</span> <span class="o">=</span> <span class="nx">width</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">,</span> <span class="nx">y1</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x2</span><span class="p">,</span> <span class="nx">y2</span><span class="p">)</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="nx">fill</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">ctx</span><span class="p">.</span><span class="nx">stroke</span><span class="p">()</span>
    <span class="err">#</span>
    <span class="err">#</span> <span class="nx">定義一個繪正齒輪的繪圖函式</span>
    <span class="err">#</span> <span class="nx">midx</span> <span class="nx">為齒輪圓心</span> <span class="nx">x</span> <span class="nx">座標</span>
    <span class="err">#</span> <span class="nx">midy</span> <span class="nx">為齒輪圓心</span> <span class="nx">y</span> <span class="nx">座標</span>
    <span class="err">#</span> <span class="nx">rp</span> <span class="nx">為節圓半徑</span><span class="p">,</span> <span class="nx">n</span> <span class="nx">為齒數</span>
    <span class="err">#</span> <span class="nx">pa</span> <span class="nx">為壓力角</span> <span class="p">(</span><span class="nx">deg</span><span class="p">)</span>
    <span class="err">#</span> <span class="nx">rot</span> <span class="nx">為旋轉角</span> <span class="p">(</span><span class="nx">deg</span><span class="p">)</span>
    <span class="err">#</span> <span class="nx">已經針對</span> <span class="nx">n</span> <span class="nx">大於等於</span> <span class="mi">52</span> <span class="nx">齒時的繪圖錯誤修正</span><span class="p">,</span> <span class="nx">因為</span> <span class="nx">base</span> <span class="nx">circle</span> <span class="nx">與齒根圓大小必須進行判斷</span>
    <span class="nx">def</span> <span class="nx">Gear</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">midx</span><span class="p">,</span> <span class="nx">midy</span><span class="p">,</span> <span class="nx">rp</span><span class="p">,</span> <span class="nx">n</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nx">pa</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="nx">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span><span class="o">:</span>
        <span class="err">#</span> <span class="nx">齒輪漸開線分成</span> <span class="mi">15</span> <span class="nx">線段繪製</span>
        <span class="nx">imax</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="err">#</span> <span class="nx">在輸入的畫布上繪製直線</span><span class="p">,</span> <span class="nx">由圓心到節圓</span> <span class="nx">y</span> <span class="nx">軸頂點畫一直線</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">(</span><span class="nx">midx</span><span class="p">,</span> <span class="nx">midy</span><span class="p">,</span> <span class="nx">midx</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rp</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">rp</span> <span class="nx">圓</span><span class="p">,</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">rp</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">a</span> <span class="nx">為模數</span> <span class="p">(</span><span class="nx">代表公制中齒的大小</span><span class="p">),</span> <span class="nx">模數為節圓直徑</span><span class="p">(</span><span class="nx">稱為節徑</span><span class="p">)</span><span class="nx">除以齒數</span>
        <span class="err">#</span> <span class="nx">模數也就是齒冠大小</span>
        <span class="nx">a</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="nx">rp</span><span class="o">/</span><span class="nx">n</span>
        <span class="err">#</span> <span class="nx">d</span> <span class="nx">為齒根大小</span><span class="p">,</span> <span class="nx">為模數的</span> <span class="mf">1.157</span> <span class="nx">或</span> <span class="mf">1.25</span><span class="nx">倍</span><span class="p">,</span> <span class="nx">這裡採</span> <span class="mf">1.25</span> <span class="nx">倍</span>
        <span class="nx">d</span><span class="o">=</span><span class="mf">2.5</span><span class="o">*</span><span class="nx">rp</span><span class="o">/</span><span class="nx">n</span>
        <span class="err">#</span> <span class="nx">ra</span> <span class="nx">為齒輪的外圍半徑</span>
        <span class="nx">ra</span><span class="o">=</span><span class="nx">rp</span><span class="o">+</span><span class="nx">a</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">ra</span> <span class="nx">圓</span><span class="p">,</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">ra</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">rb</span> <span class="nx">則為齒輪的基圓半徑</span>
        <span class="err">#</span> <span class="nx">基圓為漸開線長齒之基準圓</span>
        <span class="nx">rb</span><span class="o">=</span><span class="nx">rp</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">rb</span> <span class="nx">圓</span> <span class="p">(</span><span class="nx">基圓</span><span class="p">),</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">rb</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">rd</span> <span class="nx">為齒根圓半徑</span>
        <span class="nx">rd</span><span class="o">=</span><span class="nx">rp</span><span class="o">-</span><span class="nx">d</span>
        <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
        <span class="err">#</span> <span class="nx">畫出</span> <span class="nx">rd</span> <span class="nx">圓</span> <span class="p">(</span><span class="nx">齒根圓</span><span class="p">),</span> <span class="nx">畫圓函式尚未定義</span>
        <span class="err">#</span><span class="nx">create_oval</span><span class="p">(</span><span class="nx">midx</span><span class="o">-</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">midy</span><span class="o">+</span><span class="nx">rd</span><span class="p">,</span> <span class="nx">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="err">#</span> <span class="nx">dr</span> <span class="nx">則為基圓到齒頂圓半徑分成</span> <span class="nx">imax</span> <span class="nx">段後的每段半徑增量大小</span>
        <span class="err">#</span> <span class="nx">將圓弧分成</span> <span class="nx">imax</span> <span class="nx">段來繪製漸開線</span>
        <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
        <span class="k">if</span> <span class="nx">rd</span><span class="o">&gt;</span><span class="nx">rb</span><span class="o">:</span>
            <span class="nx">dr</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ra</span><span class="o">-</span><span class="nx">rd</span><span class="p">)</span><span class="o">/</span><span class="nx">imax</span>
        <span class="k">else</span><span class="o">:</span>
            <span class="nx">dr</span><span class="o">=</span><span class="p">(</span><span class="nx">ra</span><span class="o">-</span><span class="nx">rb</span><span class="p">)</span><span class="o">/</span><span class="nx">imax</span>
        <span class="err">#</span> <span class="nx">tan</span><span class="p">(</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span><span class="p">)</span><span class="o">-</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span> <span class="nx">為漸開線函數</span>
        <span class="nx">sigma</span><span class="o">=</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">math</span><span class="p">.</span><span class="nx">tan</span><span class="p">(</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span><span class="p">)</span><span class="o">-</span><span class="nx">pa</span><span class="o">*</span><span class="nx">deg</span>
        <span class="k">for</span> <span class="nx">j</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span><span class="o">:</span>
            <span class="nx">ang</span><span class="o">=-</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">j</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="o">+</span><span class="nx">sigma</span>
            <span class="nx">ang2</span><span class="o">=</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">j</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="o">+</span><span class="nx">sigma</span>
            <span class="nx">lxd</span><span class="o">=</span><span class="nx">midx</span><span class="o">+</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="p">)</span>
            <span class="nx">lyd</span><span class="o">=</span><span class="nx">midy</span><span class="o">-</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">imax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span>
                <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
                <span class="k">if</span> <span class="nx">rd</span><span class="o">&gt;</span><span class="nx">rb</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rd</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="k">else</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rb</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="nx">theta</span><span class="o">=</span><span class="nx">math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">r</span><span class="o">*</span><span class="nx">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">rb</span><span class="o">*</span><span class="nx">rb</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">.)</span>
                <span class="nx">alpha</span><span class="o">=</span><span class="nx">theta</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
                <span class="nx">xpt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">alpha</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="nx">ypt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">alpha</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="nx">xd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span><span class="nx">重力啟動機械時鐘所需的齒輪組</span><span class="p">,</span> <span class="nx">然後在</span> <span class="nx">Onshape</span> <span class="nx">進行零組件設計繪圖</span><span class="p">,</span> <span class="nx">最後再用</span> <span class="mi">3</span><span class="nx">D</span> <span class="nx">印表機將零件印出並組裝測試</span><span class="p">.</span>

                <span class="nx">yd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="o">-</span><span class="nx">ang</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">繪線起點由齒根圓上的點</span><span class="p">,</span> <span class="nx">作為起點</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xd</span>
                    <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">yd</span>
                <span class="err">#</span> <span class="nx">由左側齒根圓作為起點</span><span class="p">,</span> <span class="nx">除第一點</span> <span class="p">(</span><span class="nx">xd</span><span class="p">,</span><span class="nx">yd</span><span class="p">)</span> <span class="nx">齒根圓上的起點外</span><span class="p">,</span> <span class="nx">其餘的</span> <span class="p">(</span><span class="nx">xpt</span><span class="p">,</span><span class="nx">ypt</span><span class="p">)</span><span class="nx">則為漸開線上的分段點</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">((</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span><span class="p">),(</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span><span class="p">),(</span><span class="nx">last_x</span><span class="p">),(</span><span class="nx">last_y</span><span class="p">),</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">最後一點</span><span class="p">,</span> <span class="nx">則為齒頂圓</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="nx">imax</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">lfx</span><span class="o">=</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                    <span class="nx">lfy</span><span class="o">=</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
                <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
            <span class="err">#</span> <span class="nx">the</span> <span class="nx">line</span> <span class="nx">from</span> <span class="nx">last</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">dedendum</span> <span class="nx">point</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">recent</span>
            <span class="err">#</span> <span class="nx">end</span> <span class="nx">of</span> <span class="nx">dedendum</span> <span class="nx">point</span>
            <span class="err">#</span> <span class="nx">lxd</span> <span class="nx">為齒根圓上的左側</span> <span class="nx">x</span> <span class="nx">座標</span><span class="p">,</span> <span class="nx">lyd</span> <span class="nx">則為</span> <span class="nx">y</span> <span class="nx">座標</span>
            <span class="err">#</span> <span class="nx">下列為齒根圓上用來近似圓弧的直線</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">((</span><span class="nx">lxd</span><span class="p">),(</span><span class="nx">lyd</span><span class="p">),(</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xd</span><span class="p">),(</span><span class="nx">midy</span><span class="o">-</span><span class="nx">yd</span><span class="p">),</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>
            <span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="nx">imax</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span>
                <span class="err">#</span> <span class="nx">當</span> <span class="nx">rd</span> <span class="nx">大於</span> <span class="nx">rb</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">漸開線並非畫至</span> <span class="nx">rb</span><span class="p">,</span> <span class="nx">而是</span> <span class="nx">rd</span>
                <span class="k">if</span> <span class="nx">rd</span><span class="o">&gt;</span><span class="nx">rb</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rd</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="k">else</span><span class="o">:</span>
                    <span class="nx">r</span><span class="o">=</span><span class="nx">rb</span><span class="o">+</span><span class="nx">i</span><span class="o">*</span><span class="nx">dr</span>
                <span class="nx">theta</span><span class="o">=</span><span class="nx">math</span><span class="p">.</span><span class="nx">sqrt</span><span class="p">((</span><span class="nx">r</span><span class="o">*</span><span class="nx">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">rb</span><span class="o">*</span><span class="nx">rb</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">.)</span>
                <span class="nx">alpha</span><span class="o">=</span><span class="nx">theta</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">atan</span><span class="p">(</span><span class="nx">theta</span><span class="p">)</span>
                <span class="nx">xpt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="nx">alpha</span><span class="p">)</span>
                <span class="nx">ypt</span><span class="o">=</span><span class="nx">r</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">ang2</span><span class="o">-</span><span class="nx">alpha</span><span class="p">)</span>
                <span class="nx">xd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">ang2</span><span class="p">)</span>
                <span class="nx">yd</span><span class="o">=</span><span class="nx">rd</span><span class="o">*</span><span class="nx">math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">ang2</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span> <span class="nx">時</span><span class="p">,</span> <span class="nx">繪線起點由齒根圓上的點</span><span class="p">,</span> <span class="nx">作為起點</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xd</span>
                    <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">yd</span>
                <span class="err">#</span> <span class="nx">由右側齒根圓作為起點</span><span class="p">,</span> <span class="nx">除第一點</span> <span class="p">(</span><span class="nx">xd</span><span class="p">,</span><span class="nx">yd</span><span class="p">)</span> <span class="nx">齒根圓上的起點外</span><span class="p">,</span> <span class="nx">其餘的</span> <span class="p">(</span><span class="nx">xpt</span><span class="p">,</span><span class="nx">ypt</span><span class="p">)</span><span class="nx">則為漸開線上的分段點</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">((</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span><span class="p">),(</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span><span class="p">),(</span><span class="nx">last_x</span><span class="p">),(</span><span class="nx">last_y</span><span class="p">),</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>
                <span class="err">#</span> <span class="nx">最後一點</span><span class="p">,</span> <span class="nx">則為齒頂圓</span>
                <span class="k">if</span><span class="p">(</span><span class="nx">i</span><span class="o">==</span><span class="nx">imax</span><span class="p">)</span><span class="o">:</span>
                    <span class="nx">rfx</span><span class="o">=</span><span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                    <span class="nx">rfy</span><span class="o">=</span><span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
                <span class="nx">last_x</span> <span class="o">=</span> <span class="nx">midx</span><span class="o">+</span><span class="nx">xpt</span>
                <span class="nx">last_y</span> <span class="o">=</span> <span class="nx">midy</span><span class="o">-</span><span class="nx">ypt</span>
            <span class="err">#</span> <span class="nx">lfx</span> <span class="nx">為齒頂圓上的左側</span> <span class="nx">x</span> <span class="nx">座標</span><span class="p">,</span> <span class="nx">lfy</span> <span class="nx">則為</span> <span class="nx">y</span> <span class="nx">座標</span>
            <span class="err">#</span> <span class="nx">下列為齒頂圓上用來近似圓弧的直線</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">create_line</span><span class="p">(</span><span class="nx">lfx</span><span class="p">,</span><span class="nx">lfy</span><span class="p">,</span><span class="nx">rfx</span><span class="p">,</span><span class="nx">rfy</span><span class="p">,</span><span class="nx">fill</span><span class="o">=</span><span class="nx">color</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">準備在</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;gear2&quot;</span> <span class="nx">的</span> <span class="nx">canvas</span> <span class="nx">中繪圖</span>
<span class="nx">canvas</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">[</span><span class="s2">&quot;gear2&quot;</span><span class="p">]</span>
<span class="nx">ctx</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">)</span>

<span class="err">#</span> <span class="nx">模數決定齒的尺寸大小</span><span class="p">,</span> <span class="nx">囓合齒輪組必須有相同的模重力啟動機械時鐘所需的齒輪組</span><span class="p">,</span> <span class="nx">然後在</span> <span class="nx">Onshape</span> <span class="nx">進行零組件設計繪圖</span><span class="p">,</span> <span class="nx">最後再用</span> <span class="mi">3</span><span class="nx">D</span> <span class="nx">印表機將零件印出並組裝測試</span><span class="p">.</span>
<span class="nx">數與壓力角</span>
<span class="err">#</span> <span class="nx">壓力角</span> <span class="nx">pa</span> <span class="nx">單位為角度</span>
<span class="nx">pa</span> <span class="o">=</span> <span class="mi">20</span>
<span class="err">#</span> <span class="nx">第1齒輪齒數</span>
<span class="nx">n_g1</span> <span class="o">=</span> <span class="mi">17</span>
<span class="err">#</span> <span class="nx">第2齒輪齒數</span>
<span class="nx">n_g2</span> <span class="o">=</span> <span class="mi">11</span>
<span class="err">#</span> <span class="nx">第3齒輪齒數</span>
<span class="nx">n_g3</span> <span class="o">=</span> <span class="mi">13</span>
<span class="err">#</span> <span class="nx">m</span> <span class="nx">為模數</span><span class="p">,</span> <span class="nx">根據畫布的寬度</span><span class="p">,</span> <span class="nx">計算適合的模數大小</span>
<span class="nx">m</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="o">*</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nx">n_g1</span><span class="o">+</span><span class="nx">n_g2</span><span class="o">+</span><span class="nx">n_g3</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">根據模數</span> <span class="nx">m</span><span class="p">,</span> <span class="nx">計算各齒輪的節圓半徑</span>
<span class="nx">rp_g1</span> <span class="o">=</span> <span class="nx">m</span><span class="o">*</span><span class="nx">n_g1</span><span class="o">/</span><span class="mi">2</span>
<span class="nx">rp_g2</span> <span class="o">=</span> <span class="nx">m</span><span class="o">*</span><span class="nx">n_g2</span><span class="o">/</span><span class="mi">2</span>
<span class="nx">rp_g3</span> <span class="o">=</span> <span class="nx">m</span><span class="o">*</span><span class="nx">n_g3</span><span class="o">/</span><span class="mi">2</span>
<span class="err">#</span><span class="nx">單一正齒輪繪圖呼叫格式</span> <span class="nx">Spur</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Gear</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">n</span><span class="p">,</span> <span class="nx">pa</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">開始繪製囓合齒輪輪廓</span>
<span class="err">#</span> <span class="nx">繪圖第1齒輪的圓心座標</span><span class="p">,</span> <span class="nx">因為希望繪圖佔去</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="nx">的</span> <span class="mi">80</span><span class="o">%</span><span class="p">,</span> <span class="nx">所以兩邊各預留</span> <span class="mi">10</span><span class="o">%</span> <span class="nx">距離</span>
<span class="nx">x_g1</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span><span class="o">*</span><span class="mf">0.1</span><span class="o">+</span><span class="nx">rp_g1</span>
<span class="err">#</span> <span class="nx">y</span> <span class="nx">方向繪圖區域上方預留</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="nx">的</span> <span class="mi">20</span><span class="o">%</span>
<span class="nx">y_g1</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span><span class="o">*</span><span class="mf">0.2</span><span class="o">+</span><span class="nx">rp_g1</span>
<span class="err">#</span> <span class="nx">第2齒輪的圓心座標</span><span class="p">,</span> <span class="nx">假設排列成水平</span><span class="p">,</span> <span class="nx">表示各齒輪圓心</span> <span class="nx">y</span> <span class="nx">座標相同</span>
<span class="nx">x_g2</span> <span class="o">=</span> <span class="nx">x_g1</span> <span class="o">+</span> <span class="nx">rp_g1</span> <span class="o">+</span> <span class="nx">rp_g2</span>
<span class="nx">y_g2</span> <span class="o">=</span> <span class="nx">y_g1</span>
<span class="err">#</span> <span class="nx">第3齒輪的圓心座標</span>
<span class="nx">x_g3</span> <span class="o">=</span> <span class="nx">x_g1</span> <span class="o">+</span> <span class="nx">rp_g1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="nx">rp_g2</span> <span class="o">+</span> <span class="nx">rp_g3</span>
<span class="nx">y_g3</span> <span class="o">=</span> <span class="nx">y_g1</span>

<span class="err">#</span> <span class="nx">將第1齒輪順時鐘轉</span> <span class="mi">90</span> <span class="nx">度</span><span class="p">,</span> <span class="nx">也就是</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">2</span>
<span class="err">#</span> <span class="nx">使用</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span> <span class="nx">與</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span> <span class="nx">以確保各齒輪以相對座標進行旋轉繪圖</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
<span class="err">#</span> <span class="nx">translate</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">origin</span> <span class="nx">of</span> <span class="nx">second</span> <span class="nx">gear</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">x_g1</span><span class="p">,</span> <span class="nx">y_g1</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">rotate</span> <span class="nx">to</span> <span class="nx">engage</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">put</span> <span class="nx">it</span> <span class="nx">back</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="o">-</span><span class="nx">x_g1</span><span class="p">,</span> <span class="o">-</span><span class="nx">y_g1</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">繪製第一個齒輪輪廓</span>
<span class="nx">Spur</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Gear</span><span class="p">(</span><span class="nx">x_g1</span><span class="p">,</span> <span class="nx">y_g1</span><span class="p">,</span> <span class="nx">rp_g1</span><span class="p">,</span> <span class="nx">n_g1</span><span class="p">,</span> <span class="nx">pa</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">)</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">將第2齒輪逆時鐘轉</span> <span class="mi">90</span> <span class="nx">度之後</span><span class="p">,</span> <span class="nx">再多轉一齒</span><span class="p">,</span> <span class="nx">以便與第1齒輪進行囓合</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
<span class="err">#</span> <span class="nx">translate</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">origin</span> <span class="nx">of</span> <span class="nx">second</span> <span class="nx">gear</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">x_g2</span><span class="p">,</span> <span class="nx">y_g2</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">rotate</span> <span class="nx">to</span> <span class="nx">engage</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n_g2</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">put</span> <span class="nx">it</span> <span class="nx">back</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="o">-</span><span class="nx">x_g2</span><span class="p">,</span> <span class="o">-</span><span class="nx">y_g2</span><span class="p">)</span>
<span class="nx">Spur</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Gear</span><span class="p">(</span><span class="nx">x_g2</span><span class="p">,</span> <span class="nx">y_g2</span><span class="p">,</span> <span class="nx">rp_g2</span><span class="p">,</span> <span class="nx">n_g2</span><span class="p">,</span> <span class="nx">pa</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>

<span class="err">#</span> <span class="nx">將第3齒輪逆時鐘轉</span> <span class="mi">90</span> <span class="nx">度之後</span><span class="p">,</span> <span class="nx">再往回轉第2齒輪定位帶動轉角</span><span class="p">,</span> <span class="nx">然後再逆時鐘多轉一齒</span><span class="p">,</span> <span class="nx">以便與第2齒輪進行囓合</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">save</span><span class="p">()</span>
<span class="err">#</span> <span class="nx">translate</span> <span class="nx">to</span> <span class="nx">the</span> <span class="nx">origin</span> <span class="nx">of</span> <span class="nx">second</span> <span class="nx">gear</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">x_g3</span><span class="p">,</span> <span class="nx">y_g3</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">rotate</span> <span class="nx">to</span> <span class="nx">engage</span>
<span class="err">#</span> <span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">+</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n_g2</span> <span class="nx">為第2齒輪從順時鐘轉</span> <span class="mi">90</span> <span class="nx">度之後</span><span class="p">,</span> <span class="nx">必須配合目前的標記線所作的齒輪</span> <span class="mi">2</span> <span class="nx">轉動角度</span><span class="p">,</span> <span class="nx">要轉換到齒輪3</span> <span class="nx">的轉動角度</span>
<span class="err">#</span> <span class="nx">必須乘上兩齒輪齒數的比例</span><span class="p">,</span> <span class="nx">若齒輪2</span> <span class="nx">大</span><span class="p">,</span> <span class="nx">則齒輪3</span> <span class="nx">會轉動較快</span>
<span class="err">#</span> <span class="nx">第1個</span> <span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">2</span> <span class="nx">為將原先垂直的第3齒輪定位線逆時鐘旋轉</span> <span class="mi">90</span> <span class="nx">度</span>
<span class="err">#</span> <span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n_g3</span> <span class="nx">則是第3齒與第2齒定位線重合後</span><span class="p">,</span> <span class="nx">必須再逆時鐘多轉一齒的轉角</span><span class="p">,</span> <span class="nx">以便進行囓合</span>
<span class="err">#</span> <span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">+</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n_g2</span><span class="p">)</span><span class="o">*</span><span class="nx">n_g2</span><span class="o">/</span><span class="nx">n_g3</span> <span class="nx">則是第2齒原定位線為順時鐘轉動</span> <span class="mi">90</span> <span class="nx">度</span><span class="p">,</span> 
<span class="err">#</span> <span class="nx">但是第2齒輪為了與第1齒輪囓合</span><span class="p">,</span> <span class="nx">已經距離定位線</span><span class="p">,</span> <span class="nx">多轉了</span> <span class="mi">180</span> <span class="nx">度</span><span class="p">,</span> <span class="nx">再加上第2齒輪的一齒角度</span><span class="p">,</span> <span class="nx">因為要帶動第3齒輪定位</span><span class="p">,</span> 
<span class="err">#</span> <span class="nx">這個修正角度必須要再配合第2齒與第3齒的轉速比加以轉換成第3齒輪的轉角</span><span class="p">,</span> <span class="nx">因此乘上</span> <span class="nx">n_g2</span><span class="o">/</span><span class="nx">n_g3</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n_g3</span><span class="o">+</span><span class="p">(</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">+</span><span class="nx">math</span><span class="p">.</span><span class="nx">pi</span><span class="o">/</span><span class="nx">n_g2</span><span class="p">)</span><span class="o">*</span><span class="nx">n_g2</span><span class="o">/</span><span class="nx">n_g3</span><span class="p">)</span>
<span class="err">#</span> <span class="nx">put</span> <span class="nx">it</span> <span class="nx">back</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="o">-</span><span class="nx">x_g3</span><span class="p">,</span> <span class="o">-</span><span class="nx">y_g3</span><span class="p">)</span>
<span class="nx">Spur</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nx">Gear</span><span class="p">(</span><span class="nx">x_g3</span><span class="p">,</span> <span class="nx">y_g3</span><span class="p">,</span> <span class="nx">rp_g3</span><span class="p">,</span> <span class="nx">n_g3</span><span class="p">,</span> <span class="nx">pa</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="nx">ctx</span><span class="p">.</span><span class="nx">restore</span><span class="p">()</span>
<span class="nt">&lt;/script&gt;</span>
</pre></div>
</td></tr></table>

<p><br /></p>
<p>參考資料:</p>
<ol>
<li>3D printed mechanical clock: <a href="http://www.thingiverse.com/thing:328569">http://www.thingiverse.com/thing:328569</a></li>
<li>Mechanical engineering: <a href="http://diyhpl.us/~bryan/papers2/wikipedia-mechanical-engineering.pdf">http://diyhpl.us/~bryan/papers2/wikipedia-mechanical-engineering.pdf</a></li>
<li>Pendulum marble clock: <a href="http://www.youtube.com/watch?v=UHBHCsrqYMw">http://www.youtube.com/watch?v=UHBHCsrqYMw</a></li>
<li>Walking animal: <a href="http://www.thingiverse.com/thing:1212665">http://www.thingiverse.com/thing:1212665</a></li>
<li>Perseverance: <a href="http://www.thingiverse.com/thing:348489">http://www.thingiverse.com/thing:348489</a></li>
<li>Robotic arm:<a href="http://www.thingiverse.com/thing:1015238">http://www.thingiverse.com/thing:1015238</a></li>
<li>Toyota cylinder engine: <a href="http://www.thingiverse.com/thing:644933">http://www.thingiverse.com/thing:644933</a></li>
<li>Gear generator: <a href="http://geargenerator.com/">http://geargenerator.com/</a></li>
<li>Optimal robot trajectory: <a href="https://gist.github.com/pierre-haessig/9808480">https://gist.github.com/pierre-haessig/9808480</a></li>
<li>Simple GP for aircraft optimization: <a href="https://gist.github.com/bqpd/6845968">https://gist.github.com/bqpd/6845968</a></li>
</ol>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'kmolab'; // required: replace example with your forum shortname

                    var disqus_identifier = 'ji-jie-she-ji-gong-cheng-shi-de-she-ji-mo-ni-yu-shi-zuo';
                var disqus_url = 'http://chiamingyen.github.io/kmolab/blog/ji-jie-she-ji-gong-cheng-shi-de-she-ji-mo-ni-yu-shi-zuo.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/2016-spring-collaborative-product-design-course.html">
                            2016 Spring Collaborative Product Design Course
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/about-lektor-content-management-system.html">
                            About Lektor Content Management System
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/create-an-online-ethercalc-site.html">
                            Create an online Ethercalc site
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/2016-cd-course.html">
                            2016 CD course
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/2015-fall-cadp-w16.html">
                            2015 Fall CADP W16
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://chiamingyen.github.io/kmolab/blog/categories.html"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/category/alumni.html">
                            <i class="fa fa-folder-open fa-lg"></i> Alumni
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/category/cadlab.html">
                            <i class="fa fa-folder-open fa-lg"></i> CADlab
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/category/courses.html">
                            <i class="fa fa-folder-open fa-lg"></i> Courses
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/category/project.html">
                            <i class="fa fa-folder-open fa-lg"></i> Project
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/category/python.html">
                            <i class="fa fa-folder-open fa-lg"></i> Python
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://chiamingyen.github.io/kmolab/blog/category/ubuntu.html">
                            <i class="fa fa-folder-open fa-lg"></i> Ubuntu
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://chiamingyen.github.io/kmolab/blog/tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                </ul>
            </li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/DandyDev/pelican-bootstrap3/" target="_blank">
                pelican-bootstrap3
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/getpelican/pelican-plugins" target="_blank">
                pelican-plugins
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/Tipue/Tipue-Search" target="_blank">
                Tipue search
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 kmol
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://chiamingyen.github.io/kmolab/blog/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://chiamingyen.github.io/kmolab/blog/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://chiamingyen.github.io/kmolab/blog/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'kmolab'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>