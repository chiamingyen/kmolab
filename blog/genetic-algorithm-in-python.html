<!DOCTYPE html>
<html lang="en"
>
<head>
    <title>Genetic Algorithm in Python - Kmolab (虎尾科大MDE)</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="https://chiamingyen.github.io/kmolab/blog/genetic-algorithm-in-python.html">

        <meta name="author" content="kmol" />
        <meta name="keywords" content="GA,基因演算" />
        <meta name="description" content="利用 Python 實現基因演算" />

        <meta property="og:site_name" content="Kmolab (虎尾科大MDE)" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Genetic Algorithm in Python"/>
        <meta property="og:url" content="https://chiamingyen.github.io/kmolab/blog/genetic-algorithm-in-python.html"/>
        <meta property="og:description" content="利用 Python 實現基因演算"/>
        <meta property="article:published_time" content="2016-01-25" />
            <meta property="article:section" content="Python" />
            <meta property="article:tag" content="GA" />
            <meta property="article:tag" content="基因演算" />
            <meta property="article:author" content="kmol" />


    <!-- Bootstrap -->
        <link rel="stylesheet" href="https://chiamingyen.github.io/kmolab/blog/theme/css/bootstrap.united.min.css" type="text/css"/>
    <link href="https://chiamingyen.github.io/kmolab/blog/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="https://chiamingyen.github.io/kmolab/blog/theme/css/pygments/monokai.css" rel="stylesheet">
    <link href="https://chiamingyen.github.io/kmolab/blog/theme/tipuesearch/tipuesearch.css" rel="stylesheet">
    <link rel="stylesheet" href="https://chiamingyen.github.io/kmolab/blog/theme/css/style.css" type="text/css"/>

        <link href="https://chiamingyen.github.io/kmolab/blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="Kmolab (虎尾科大MDE) ATOM Feed"/>

<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/shBrushCSharp.js"></script>
<script type='text/javascript'>
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/css/shCore.css";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://chiamingyen.github.io/kmolab_data/files/syntaxhighlighter/css/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();
</script>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://chiamingyen.github.io/kmolab/blog/" class="navbar-brand">
Kmolab (虎尾科大MDE)            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="https://chiamingyen.github.io/kmolab/blog/category/alumni.html">Alumni</a>
                        </li>
                        <li >
                            <a href="https://chiamingyen.github.io/kmolab/blog/category/cadlab.html">Cadlab</a>
                        </li>
                        <li >
                            <a href="https://chiamingyen.github.io/kmolab/blog/category/courses.html">Courses</a>
                        </li>
                        <li >
                            <a href="https://chiamingyen.github.io/kmolab/blog/category/project.html">Project</a>
                        </li>
                        <li class="active">
                            <a href="https://chiamingyen.github.io/kmolab/blog/category/python.html">Python</a>
                        </li>
                        <li >
                            <a href="https://chiamingyen.github.io/kmolab/blog/category/ubuntu.html">Ubuntu</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><span>
                <form class="navbar-search" action="https://chiamingyen.github.io/kmolab/blog/search.html">
                  <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input" required>
                </form></span>
              </li>
              <li><a href="https://chiamingyen.github.io/kmolab/blog/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">

    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="https://chiamingyen.github.io/kmolab/blog/genetic-algorithm-in-python.html"
                       rel="bookmark"
                       title="Permalink to Genetic Algorithm in Python">
                        Genetic Algorithm in Python
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2016-01-25T13:00:00+08:00"> Mon 25 January 2016</time>
    </span>
            <span class="label label-default">By</span>
            <a href="https://chiamingyen.github.io/kmolab/blog/author/kmol.html"><i class="fa fa-user"></i> kmol</a>



<span class="label label-default">Tags</span>
	<a href="https://chiamingyen.github.io/kmolab/blog/tag/ga.html">GA</a>
        /
	<a href="https://chiamingyen.github.io/kmolab/blog/tag/ji-yin-yan-suan.html">基因演算</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <p>利用 Python 實現基因演算</p>


<p>利用"Genetic Algorithm in python jupyter" 查詢, 得到如下的相關連結:</p>
<ol>
<li><a href="https://github.com/DEAP/deap">https://github.com/DEAP/deap</a>, <a href="https://pypi.python.org/pypi/deap">Deap 1.0.2</a></li>
<li><a href="http://jupyter.cs.brynmawr.edu/hub/dblank/public/CS110%20Intro%20to%20Computing/2015/Lectures/Genetic%20Algorithm.ipynb">Genetic Algorithm notebook</a></li>
<li><a href="http://gitxiv.com/posts/4wYYffue4WfnhKZoB/book-kalman-and-bayesian-filters-in-python">Kalman and Bayesian Filters in Python</a></li>
<li><a href="https://lmarti.github.io/evolutionary-computation-course/AEC.02%20-%20Elements%20of%20Evolutionary%20Algorithms.slides.html#/">Elements of Evoluationary Algorithms</a>, related <a href="https://github.com/lmarti/evolutionary-computation-course">Course</a>, <a href="http://lmarti.github.io/evolutionary-computation-course/">Evolutionary Computation with IPython</a></li>
<li><a href="https://github.com/jakevdp/JSAnimation">https://github.com/jakevdp/JSAnimation</a></li>
<li><a href="https://github.com/garethflowers/vscode-portable">https://github.com/garethflowers/vscode-portable</a></li>
<li><a href="https://github.com/dmahugh/crawlerino">https://github.com/dmahugh/crawlerino</a></li>
<li><a href="http://paraschopra.com/sourcecode/GP/">http://paraschopra.com/sourcecode/GP/</a></li>
<li><a href="https://github.com/cpmech/CIVL4250py/tree/master/2015">https://github.com/cpmech/CIVL4250py/tree/master/2015</a></li>
<li><a href="https://github.com/remiomosowon/pyeasyga">https://github.com/remiomosowon/pyeasyga</a></li>
<li><a href="https://github.com/yati-sagade/Genetic-Algorithm-Demo">https://github.com/yati-sagade/Genetic-Algorithm-Demo</a></li>
</ol>
<p>開始: <a href="http://lethain.com/genetic-algorithms-cool-name-damn-simple/">http://lethain.com/genetic-algorithms-cool-name-damn-simple/</a>, trying to create a list of N numbers that equal X when summed together.</p>
<p>Each suggested solution for a genetic algorithm is referred to as an individual. In our current problem, each list of N numbers is an individual.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span>
<span class="k">def</span> <span class="nf">individual</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
    <span class="s1">&#39;Create a member of the population.&#39;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="p">]</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">individual(5,0,100)</span>
<span class="sd">[79, 0, 20, 47, 40]</span>
<span class="sd">individual(5,0,100)</span>
<span class="sd">[64, 1, 25, 84, 87]</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>


<p><br />
The collection of all individuals is referred to as our population.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">population</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a number of individuals (i.e. a population).</span>

<span class="sd">    count: the number of individuals in the population</span>
<span class="sd">    length: the number of values per individual</span>
<span class="sd">    min: the min possible value in an individual&#39;s list of values</span>
<span class="sd">     max: the max possible value in an individual&#39;s list of values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">individual</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="p">]</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">population(3,5,0,100)</span>
<span class="sd">[[51, 55, 73, 0, 80], [3, 47, 18, 65, 55], [17, 64, 77, 43, 48]]</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>


<p><br />
Next we need a way to judge the how effective each solution is; to judge the fitness of each individual. Predictably enough, we call this the fitness function. For our problem, we want the fitness to be a function of the distance between the sum of an individuals numbers and the target number X.</p>
<p>We can implement the fitness function as follows:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>
<span class="k">def</span> <span class="nf">fitness</span><span class="p">(</span><span class="n">individual</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the fitness of an individual. Lower is better.</span>

<span class="sd">    individual: the individual to evaluate</span>
<span class="sd">    target: the sum of numbers that individuals are aiming for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">individual</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">-</span><span class="nb">sum</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">x = individual(5,0,100)</span>
<span class="sd">fitness(x, 200)</span>
<span class="sd">165</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>


<p><br />
Personally, I'd prefer to have a high fitness score correlate to a fit individual rather than the current implementation where a perfectly fit individual has a fitness of 0, and the higher the worse. Ah well, regardless, keep that detail in mind while following this code.http://paraschopra.com/sourcecode/GP/index.php</p>
<p>It's also helpful to create a function that will determine a population's average fitness.</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">grade</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s1">&#39;Find average fitness for a population.&#39;</span>
    <span class="n">summed</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">(</span><span class="n">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">summed</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">x = population(3,5,0,100)</span>
<span class="sd">target = 200</span>
<span class="sd">grade(x, target)</span>
<span class="sd">116</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>


<p><br />
Now we just need a way evolve our population; to advance the population from one generation to the next.</p>
<p>Evolution
This is the secret sauce of genetic algorithms, where secret means fairly obvious, and sauce means sauce. Consider a population of elk which are ruthlessly hunted by a pack of wolves. With each generation the weakest are eaten by the wolves, and then the strongest elk reproduce and have children. Abstract those ideas a bit, and we can implement the evolution mechanism.</p>
<ol>
<li>For each generation we'll take a portion of the best performing individuals as judged by our fitness function. These high-performers will be the parents of the next generation.</li>
</ol>
<p>We'll also randomly select some lesser performing individuals to be parents, because we want to promote genetic diversity. Abandoning the metaphor, one of the dangers of optimization algorithms is getting stuck at a local maximum and consequently being unable to find the real maximum. By including some individuals who are not performing as well, we decrease our likelihood of getting stuck.</p>
<ol>
<li>Breed together parents to repopulate the population to its desired size (if you take the top 20 individuals in a population of 100, then you'd need to create 80 new children via breeding). In our case, breeding is pretty basic: take the first N/2 digits from the father and the last N/2 digits from the mother.</li>
</ol>
<div class="highlight"><pre><span></span><span class="n">father</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">mother</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">]</span>
<span class="n">child</span> <span class="o">=</span> <span class="n">father</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">mother</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
<span class="k">print</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">[1,2,3,40,50,60]</span>
<span class="sd">&#39;&#39;&#39;</span>
</pre></div>


<p><br /></p>
<p>It's okay to have one parent breed multiple times, but one parent should never be both the father and mother of a child.</p>
<ol>
<li>
<p>Merge together the parents and children to constitute the next generation's population.</p>
</li>
<li>
<p>Finally we mutate a small random portion of the population. What this means is to have a probability of randomly modifying each individual.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span><span class="p">,</span> <span class="n">randint</span>
<span class="n">chance_to_mutate</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">population</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">chance_to_mutate</span> <span class="o">&gt;</span> <span class="n">random</span><span class="p">():</span>
        <span class="n">place_to_modify</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="n">i</span><span class="p">[</span><span class="n">place_to_modify</span><span class="p">]</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</pre></div>


<p><br />
This--just like taking individuals who are not performing particularly well--is to encourage genetic diversity, i.e. avoid getting stuck at local maxima.</p>
<p>Putting it all together, the code to evolve a generation can be implemented like this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_select</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="n">graded</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">]</span>
    <span class="n">graded</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graded</span><span class="p">)]</span>
    <span class="n">retain_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graded</span><span class="p">)</span><span class="o">*</span><span class="n">retain</span><span class="p">)</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="n">graded</span><span class="p">[:</span><span class="n">retain_length</span><span class="p">]</span>

    <span class="c1"># randomly add other individuals to promote genetic diversity</span>
    <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">graded</span><span class="p">[</span><span class="n">retain_length</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">random_select</span> <span class="o">&gt;</span> <span class="n">random</span><span class="p">():</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>

    <span class="c1"># mutate some individuals</span>
    <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mutate</span> <span class="o">&gt;</span> <span class="n">random</span><span class="p">():</span>
            <span class="n">pos_to_mutate</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># this mutation is not ideal, because it</span>
            <span class="c1"># restricts the range of possible values,</span>
            <span class="c1"># but the function is unaware of the min/max</span>
            <span class="c1"># values used to create the individuals,</span>
            <span class="n">individual</span><span class="p">[</span><span class="n">pos_to_mutate</span><span class="p">]</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">individual</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">individual</span><span class="p">))</span>

    <span class="c1"># crossover parents to create children</span>
    <span class="n">parents_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
    <span class="n">desired_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">-</span> <span class="n">parents_length</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">desired_length</span><span class="p">:</span>
        <span class="n">male</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parents_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">female</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parents_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">male</span> <span class="o">!=</span> <span class="n">female</span><span class="p">:</span>
            <span class="n">male</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">male</span><span class="p">]</span>
            <span class="n">female</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">female</span><span class="p">]</span>
            <span class="n">half</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">male</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">male</span><span class="p">[:</span><span class="n">half</span><span class="p">]</span> <span class="o">+</span> <span class="n">female</span><span class="p">[</span><span class="n">half</span><span class="p">:]</span>
            <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

    <span class="n">parents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parents</span>
</pre></div>


<p><br />
Now we've written all the pieces of a genetic algorithm, and we just have to try it out and see if it works.</p>
<p>Testing It Out</p>
<p>Here is a simple way to use the code we've written:</p>
<div class="highlight"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="mi">371</span>
<span class="n">p_count</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">i_length</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">i_min</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">i_max</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">population</span><span class="p">(</span><span class="n">p_count</span><span class="p">,</span> <span class="n">i_length</span><span class="p">,</span> <span class="n">i_min</span><span class="p">,</span> <span class="n">i_max</span><span class="p">)</span>
<span class="n">fitness_history</span> <span class="o">=</span> <span class="p">[</span><span class="n">grade</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">target</span><span class="p">),]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">evolve</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
    <span class="n">fitness_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">grade</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">target</span><span class="p">))</span>
<span class="k">for</span> <span class="n">datum</span> <span class="ow">in</span> <span class="n">fitness_history</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
</pre></div>


<p><br />
Running that code, you'll get to watch as generations' fitness gradually (but non-deterministically) approach zero. The output of one of my runs looked like this:</p>
<p>With 20% survival (plus an additional 5% of other individuals) and 1% mutation, it only took nine generations to reach a perfect solution. Then the algorithm joyfully runs in circles for as long as you'll let the mutations continue But this is a good feeling right? If it only took us half an hour to solve a problem of this magnitude, imagine what we could do with a day. A genetic algorithm for optimizing your Apache2 configuration file for number of children processes? Easy as pie.</p>
<p>There are a nearly endless variety of techniques for and variations of genetic algorithms, but all of them rest on this straight forward foundation. We'll look more at those sometime in the future, but for now you know enough to go out and throw together something interesting.</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd"># Example usage</span>
<span class="sd">from genetic import *</span>
<span class="sd">target = 371</span>
<span class="sd">p_count = 100</span>
<span class="sd">i_length = 6</span>
<span class="sd">i_min = 0</span>
<span class="sd">i_max = 100</span>
<span class="sd">p = population(p_count, i_length, i_min, i_max)</span>
<span class="sd">fitness_history = [grade(p, target),]</span>
<span class="sd">for i in range(100):</span>
<span class="sd">    p = evolve(p, target)</span>
<span class="sd">    fitness_history.append(grade(p, target))</span>

<span class="sd">for datum in fitness_history:</span>
<span class="sd">   print(datum)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">randint</span><span class="p">,</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>

<span class="k">def</span> <span class="nf">individual</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
    <span class="s1">&#39;Create a member of the population.&#39;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">randint</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> <span class="p">]</span>

<span class="k">def</span> <span class="nf">population</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a number of individuals (i.e. a population).</span>

<span class="sd">    count: the number of individuals in the population</span>
<span class="sd">    length: the number of values per individual</span>
<span class="sd">    min: the minimum possible value in an individual&#39;s list of values</span>
<span class="sd">    max: the maximum possible value in an individual&#39;s list of values</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">individual</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">count</span><span class="p">)</span> <span class="p">]</span>

<span class="k">def</span> <span class="nf">fitness</span><span class="p">(</span><span class="n">individual</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine the fitness of an individual. Higher is better.</span>

<span class="sd">    individual: the individual to evaluate</span>
<span class="sd">    target: the target number individuals are aiming for</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">sum</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">individual</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">target</span><span class="o">-</span><span class="nb">sum</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">grade</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="s1">&#39;Find average fitness for a population.&#39;</span>
    <span class="n">summed</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">(</span><span class="n">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">summed</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">evolve</span><span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_select</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">mutate</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
    <span class="n">graded</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">target</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">]</span>
    <span class="n">graded</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">graded</span><span class="p">)]</span>
    <span class="n">retain_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">graded</span><span class="p">)</span><span class="o">*</span><span class="n">retain</span><span class="p">)</span>
    <span class="n">parents</span> <span class="o">=</span> <span class="n">graded</span><span class="p">[:</span><span class="n">retain_length</span><span class="p">]</span>
    <span class="c1"># randomly add other individuals to</span>
    <span class="c1"># promote genetic diversity</span>
    <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">graded</span><span class="p">[</span><span class="n">retain_length</span><span class="p">:]:</span>
        <span class="k">if</span> <span class="n">random_select</span> <span class="o">&gt;</span> <span class="n">random</span><span class="p">():</span>
            <span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
    <span class="c1"># mutate some individuals</span>
    <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">mutate</span> <span class="o">&gt;</span> <span class="n">random</span><span class="p">():</span>
            <span class="n">pos_to_mutate</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="c1"># this mutation is not ideal, because it</span>
            <span class="c1"># restricts the range of possible values,</span>
            <span class="c1"># but the function is unaware of the min/max</span>
            <span class="c1"># values used to create the individuals,</span>
            <span class="n">individual</span><span class="p">[</span><span class="n">pos_to_mutate</span><span class="p">]</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="n">individual</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">individual</span><span class="p">))</span>
    <span class="c1"># crossover parents to create children</span>
    <span class="n">parents_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">)</span>
    <span class="n">desired_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="o">-</span> <span class="n">parents_length</span>
    <span class="n">children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">children</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">desired_length</span><span class="p">:</span>
        <span class="n">male</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parents_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">female</span> <span class="o">=</span> <span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">parents_length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">male</span> <span class="o">!=</span> <span class="n">female</span><span class="p">:</span>
            <span class="n">male</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">male</span><span class="p">]</span>
            <span class="n">female</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="n">female</span><span class="p">]</span>
            <span class="n">half</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">male</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">male</span><span class="p">[:</span><span class="n">half</span><span class="p">]</span> <span class="o">+</span> <span class="n">female</span><span class="p">[</span><span class="n">half</span><span class="p">:]</span>
            <span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="n">parents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">children</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">parents</span>
</pre></div>


<p><br /></p>
<h1>在 Ubuntu 安裝 numpy 與 scipy for python3, 但 scipy 無法運作</h1>
<h1>sudo apt-get install python3-numpy python3-scipy</h1>
<h1>必須先安裝下列程式庫</h1>
<h1>install python development packages and g++</h1>
<h1>apt-get install -y python3-dev g++</h1>
<h1>install dependencies for scipy</h1>
<h1>apt-get install -y libblas-dev liblapack-dev gfortran</h1>
<h1>然後再 sudo -H pip3 install scipy</h1>
<p>以下則為 binary coded Genetic Algorithm in Python3:</p>
<div class="highlight"><pre><span></span><span class="c1">#encoding=utf8</span>
<span class="c1"># genetic.py</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="c1"># for Intersect</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">MAXIMIZE</span><span class="p">,</span> <span class="n">MINIMIZE</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">22</span>
<span class="k">class</span> <span class="nc">Individual</span><span class="p">:</span>
    <span class="c1"># 染色體先設為 None</span>
    <span class="n">chromosome</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># 得分也先設為 None</span>
    <span class="n">score</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="c1"># Here the size of var depends on var_number print</span>
    <span class="c1"># var 變數的元素個數取決於 var_number 的個數 (即變數個數)</span>
    <span class="n">var</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># 表示適應值變數個數有兩個</span>
    <span class="n">var_number</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c1">#先將 var 數列中元素都設為 0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">var_number</span><span class="p">):</span>
        <span class="n">var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># 等位基因表示各基因可選的內容, 這裡表示不是 0 就是 1</span>
    <span class="n">alleles</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># 2**10 = 32*32 = 1024, 表示若用十個 binary 位數來表示整數, 可以表示從 0 到 1023 的數值大小</span>
    <span class="c1"># 若也用另外 十個 binary 位數來表示小數值, 則也是 0 到 1023 的數值表示能力, </span>
    <span class="c1"># 而再加一個表示正負的代表 binary 位數, 每一個變數需要 21 個 binary numbers </span>
    <span class="c1"># 以下為參數可負數時的編碼考量</span>
    <span class="c1">#前10為小數,後10為整數,第21則為正負號</span>
    <span class="c1">#0~9表示小數,10~19表示整數,而指標第20則表示第一數的正號或負號,若為0則表示正,若為1表示負號.</span>
    <span class="c1">#21~30表示第二數的小數部分,31~40則表示第二數的整數部分,第41指標則表示第二數的正號或負號</span>
    <span class="c1">#42~51表示第三數的小數部分,52~61則表示第二數的整數部分,第62指標則表示第三數的正號或負號</span>
    <span class="c1"># -1023 ~ 1023</span>
    <span class="c1">#length = 21*var_number,若接受負數參數,則必須同步修改 20-&gt;21</span>
    <span class="c1"># 因為這裡只接受正的變數值, 所以每一個變數需要 20 個 binary 位數</span>
    <span class="n">length</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">var_number</span>
    <span class="n">seperator</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">optimization</span> <span class="o">=</span> <span class="n">MINIMIZE</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chromosome</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span> <span class="o">=</span> <span class="n">chromosome</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makechromosome</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c1"># set during evaluation</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    bitwise operators (binary left shift): The left operands value is moved left by the number of bits specified by the right operand.</span>
<span class="sd">    x &lt;&lt; y</span>
<span class="sd">    Returns x with the bits shifted to the left by y places (and new bits on the right-hand-side are zeros). This is the same as multiplying x by 2**y.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># 根據染色體各位元的值轉為 10 進位值</span>
    <span class="k">def</span> <span class="nf">_getvar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chromosome</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># x 起始值設為 0</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_number</span><span class="p">):</span>
            <span class="c1"># 先根據前 20 個位元值, 透過 binary left shift 轉為 10 進位之後, 再轉為對應小數</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="mi">10</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="p">))</span>
            <span class="c1"># 因為前 20 個 binary 數, 負責 10 進位數的小數點後 3 個位數, 只要轉為 10 進位值之後, 若大於 999, 則僅取 999,</span>
            <span class="c1"># 再除以 1000, 可以得到 .999 表示 .999 為最大的小數表示數, 不要因為大於 1000 後若除以 1000 將進位到整數, 會與整數有交互影響</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="mi">999</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">=</span> <span class="mi">999</span>
            <span class="n">x</span> <span class="o">/=</span> <span class="mf">1000.</span>
            <span class="c1"># 整數部份 0 ~ 1023 的表示範圍則沒有問題, 利用 bitwise 轉換後, 直接取整數值</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="mi">20</span><span class="p">):</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="mi">20</span><span class="o">+</span><span class="mi">10</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span>

    <span class="sd">&#39;&#39;&#39; for -1023 ~ 1023,當設計變數可以接受負值時使用,每一變數使用21個 bit strings</span>
<span class="sd">    #for design variable -1023 ~1023</span>
<span class="sd">        for i in range(self.var_number):</span>
<span class="sd">            x = 0</span>
<span class="sd">            for j in range(i*21, i*21+10):</span>
<span class="sd">                x += self.chromosome[j]&lt;&lt;(j-(i*21))</span>
<span class="sd">            if (x&gt;999):</span>
<span class="sd">                x = 999</span>
<span class="sd">            x /= 1000.</span>
<span class="sd">            for j in range(i*(21)+10, i*(21)+20):</span>
<span class="sd">                x += self.chromosome[j]&lt;&lt;(j-(i*21+10))</span>
<span class="sd">            # 各變數範圍第 21 位數若為 1, 則表示該數為負數</span>
<span class="sd">            if(self.chromosome[i*(21)+20] == 1):</span>
<span class="sd">                self.var[i] = -x</span>
<span class="sd">            else:</span>
<span class="sd">                self.var[i] = x</span>
<span class="sd">            # 讓 x 再設回原值 0 表示內定各變數為正數</span>
<span class="sd">            x = 0</span>
<span class="sd">        return self.var</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># 建立染色體</span>
    <span class="k">def</span> <span class="nf">_makechromosome</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;makes a chromosome from randomly selected alleles.&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alleles</span><span class="p">)</span> <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="p">)]</span>

    <span class="c1"># 計算適應值</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s2">&quot;this method MUST be overridden to evaluate individual fitness score.&quot;</span>
        <span class="k">pass</span>

    <span class="c1"># 交配方法</span>
    <span class="k">def</span> <span class="nf">crossover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s2">&quot;override this method to use your preferred crossover method.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_twopoint</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="c1"># 突變方法</span>
    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gene</span><span class="p">):</span>
        <span class="s2">&quot;override this method to use your preferred mutation method.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pick</span><span class="p">(</span><span class="n">gene</span><span class="p">)</span>

    <span class="c1"># sample mutation method</span>
    <span class="k">def</span> <span class="nf">_pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gene</span><span class="p">):</span>
        <span class="s2">&quot;chooses a random allele to replace this gene&#39;s allele.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alleles</span><span class="p">)</span>

    <span class="c1"># sample crossover method</span>
    <span class="k">def</span> <span class="nf">_twopoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="s2">&quot;creates offspring via two-point crossover between mates.&quot;</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pickpivots</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">mate</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">):</span>
            <span class="n">chromosome</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[:]</span> <span class="c1"># 交配時,以p0的基因為基礎(複製整個 p0 的染色體內容</span>
            <span class="n">chromosome</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">]</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">left</span><span class="p">:</span><span class="n">right</span><span class="p">]</span> <span class="c1"># 接續上一個 p0 的染色體內容,將索引 left 至 right 的內容,替換成 p1 的基因</span>
            <span class="n">child</span> <span class="o">=</span> <span class="n">p0</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">chromosome</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_repair</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">child</span>
        <span class="k">return</span> <span class="n">mate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">),</span> <span class="n">mate</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="c1"># some crossover helpers ...</span>
    <span class="k">def</span> <span class="nf">_repair</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent1</span><span class="p">,</span> <span class="n">parent2</span><span class="p">):</span>
        <span class="s2">&quot;override this method, if necessary, to fix duplicated genes.&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_pickpivots</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
    <span class="c1">#</span>
    <span class="c1"># other methods</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;returns string representation of self&quot;</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        return &#39;&lt;%s chromosome=&quot;%s&quot; score=%s var=%s&gt;&#39; % \</span>
<span class="sd">               (self.__class__.__name__,</span>
<span class="sd">                self.seperator.join(map(str,self.chromosome)), self.score,self._getvar(self.chromosome))</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;</span><span class="si">%s</span><span class="s1"> score=</span><span class="si">%s</span><span class="s1"> var=</span><span class="si">%s</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> \
               <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_getvar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">))</span>
    <span class="c1"># since the __cmp__ special function is gone  use the __lt__ in stead</span>
    <span class="c1"># use the expression (a &gt; b) - (a &lt; b) as the equivalent for cmp(a, b)</span>
    <span class="c1">#def __cmp__(self, other):</span>
    <span class="c1"># these are for python 3</span>
    <span class="k">def</span> <span class="fm">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimization</span> <span class="o">==</span> <span class="n">MINIMIZE</span><span class="p">:</span>
            <span class="c1">#return cmp(self.score, other.score)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">score</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># MAXIMIZE</span>
            <span class="c1">#return cmp(other.score, self.score)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">score</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__cmp__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span> 
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">twin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[:])</span>
        <span class="n">twin</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span>
        <span class="k">return</span> <span class="n">twin</span>
<span class="k">class</span> <span class="nc">Environment</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">population</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">maxgenerations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">crossover_rate</span><span class="o">=</span><span class="mf">0.90</span><span class="p">,</span> <span class="n">mutation_rate</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">optimum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span> <span class="o">=</span> <span class="n">optimum</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">population</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_makepopulation</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">:</span>
            <span class="n">individual</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossover_rate</span> <span class="o">=</span> <span class="n">crossover_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_rate</span> <span class="o">=</span> <span class="n">mutation_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxgenerations</span> <span class="o">=</span> <span class="n">maxgenerations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_makepopulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="p">()</span> <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_goal</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_goal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxgenerations</span> <span class="ow">or</span> \
               <span class="bp">self</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">score</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">optimum</span>

    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this sort is not working with python 3.0, modification is needed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_crossover</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generation</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">)</span>
        <span class="c1"># 設定為只附加所選定範圍的值,這裡只取大於或等於 0 的 score 值</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;=</span><span class="mi">5</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">score</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_crossover</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">next_population</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">best</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">next_population</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">mate1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">crossover_rate</span><span class="p">:</span>
                <span class="n">mate2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select</span><span class="p">()</span>
                <span class="n">offspring</span> <span class="o">=</span> <span class="n">mate1</span><span class="o">.</span><span class="n">crossover</span><span class="p">(</span><span class="n">mate2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">offspring</span> <span class="o">=</span> <span class="p">[</span><span class="n">mate1</span><span class="o">.</span><span class="n">copy</span><span class="p">()]</span>
            <span class="k">for</span> <span class="n">individual</span> <span class="ow">in</span> <span class="n">offspring</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mutate</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
                <span class="n">individual</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optimum</span><span class="p">)</span>
                <span class="n">next_population</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">individual</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">population</span> <span class="o">=</span> <span class="n">next_population</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;override this to use your preferred selection method&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tournament</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">individual</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">gene</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">individual</span><span class="o">.</span><span class="n">length</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_rate</span><span class="p">:</span>
                <span class="n">individual</span><span class="o">.</span><span class="n">mutate</span><span class="p">(</span><span class="n">gene</span><span class="p">)</span>
    <span class="c1">#</span>
    <span class="c1"># sample selection method</span>
    <span class="c1">#</span>
    <span class="k">def</span> <span class="nf">_tournament</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">choosebest</span><span class="o">=</span><span class="mf">0.90</span><span class="p">):</span>
        <span class="n">competitors</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">)]</span>
        <span class="n">competitors</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">choosebest</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">competitors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">competitors</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

    <span class="k">def</span> <span class="nf">best</span><span class="p">():</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="s2">&quot;individual with best fitness score in population.&quot;</span>
        <span class="k">def</span> <span class="nf">fget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">population</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="n">best</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="o">**</span><span class="n">best</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">report</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        print (&quot;=&quot;*70)</span>
<span class="sd">        print (&quot;generation: &quot;, self.generation)</span>
<span class="sd">        print (&quot;best:       &quot;, self.best)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="o">*</span><span class="mi">70</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="p">(</span><span class="s2">&quot;generation: &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">generation</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">es</span> <span class="p">(</span><span class="s2">&quot;best:       &quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">best</span><span class="p">)</span>

<span class="c1"># 以上為 genetic.py 目前將兩者結合在一起</span>
<span class="c1">#encoding=utf8</span>
<span class="c1"># volume.py - useage example</span>
<span class="c1">#</span>
<span class="c1"># the fittest individual will have a chromosome consisting of 40 &#39;1&#39;s</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#import genetic</span>
<span class="k">class</span> <span class="nc">Volume</span><span class="p">(</span><span class="n">Individual</span><span class="p">):</span>
    <span class="n">optimization</span> <span class="o">=</span> <span class="n">MAXIMIZE</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">SURFACE</span> <span class="o">=</span> <span class="mi">80</span>
        <span class="c1"># self.score is the fitness value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getvar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">)</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z</span><span class="o">=</span><span class="p">(</span><span class="n">SURFACE</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">))</span>
        <span class="n">fitness_value</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">z</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">fitness_value</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gene</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="c1"># bit flip</span>

<span class="k">class</span> <span class="nc">Intersect</span><span class="p">(</span><span class="n">Individual</span><span class="p">):</span>
    <span class="n">optimization</span> <span class="o">=</span> <span class="n">MINIMIZE</span>
    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">optimum</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># self.score is the fitness value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_getvar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">deg</span> <span class="o">=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">180</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">deg</span>
        <span class="n">xtarget</span> <span class="o">=</span> <span class="mf">0.75</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">ytarget</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">t</span><span class="o">*</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">225</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">529</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span> <span class="o">-</span> <span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">225</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">529</span><span class="p">)</span><span class="o">/</span><span class="mi">92</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">123</span><span class="o">/</span><span class="mi">92</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
        <span class="c1"># 適應值</span>
        <span class="n">fitness_value</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xtarget</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">ytarget</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="c1"># 指定 t 的範圍, 小於 1 大於 0, 否則給予處罰</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fitness_value</span> <span class="o">+=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fitness_value</span> <span class="o">+=</span> <span class="mi">1000</span>
        <span class="c1"># 指定 theta 的範圍, 小於 2pi 大於 0, 否則給予處罰</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">:</span>
            <span class="n">fitness_value</span> <span class="o">+=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="n">theta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fitness_value</span> <span class="o">+=</span> <span class="mi">1000</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">=</span> <span class="n">fitness_value</span>

    <span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gene</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">chromosome</span><span class="p">[</span><span class="n">gene</span><span class="p">]</span> <span class="c1"># bit flip</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1">#env = Environment(Volume, size=500, maxgenerations=100)</span>
    <span class="n">env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span><span class="n">Intersect</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">maxgenerations</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>


<p><br />
~~~python</p>
            </div>
            <!-- /.entry-content -->
    <hr/>
    <section class="comments" id="comments">
        <h2>Comments</h2>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'kmolab'; // required: replace example with your forum shortname

                    var disqus_identifier = 'genetic-algorithm-in-python';
                var disqus_url = 'https://chiamingyen.github.io/kmolab/blog/genetic-algorithm-in-python.html';

            var disqus_config = function () {
                this.language = "en";
            };

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function () {
                var dsq = document.createElement('script');
                dsq.type = 'text/javascript';
                dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
            Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </section>
        </article>
    </section>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>

<section class="well well-sm">
    <ul class="list-group list-group-flush">

            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/ji-suan-ji-cheng-shi-san.html">
                            計算機程式 (三)
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/git-shi-yong-dao-yin.html">
                            Git 使用導引
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/ji-suan-ji-cheng-shi-er.html">
                            計算機程式 (二)
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/dian-nao-fu-zhu-she-ji-shi-xi-er.html">
                            電腦輔助設計實習 (二)
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/dian-nao-cao-zuo-liu-cheng-lu-ying-gong-ju.html">
                            電腦操作流程錄影工具
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="https://chiamingyen.github.io/kmolab/blog/categories.html"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/category/alumni.html">
                            <i class="fa fa-folder-open fa-lg"></i> Alumni
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/category/cadlab.html">
                            <i class="fa fa-folder-open fa-lg"></i> cadlab
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/category/courses.html">
                            <i class="fa fa-folder-open fa-lg"></i> Courses
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/category/project.html">
                            <i class="fa fa-folder-open fa-lg"></i> Project
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/category/python.html">
                            <i class="fa fa-folder-open fa-lg"></i> Python
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="https://chiamingyen.github.io/kmolab/blog/category/ubuntu.html">
                            <i class="fa fa-folder-open fa-lg"></i> Ubuntu
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="https://chiamingyen.github.io/kmolab/blog/tags.html"><h4><i class="fa fa-tags fa-lg"></i><span class="icon-label">Tags</span></h4></a>
                <ul class="list-group list-inline tagcloud" id="tags">
                </ul>
            </li>
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://getpelican.com/" target="_blank">
                Pelican
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/DandyDev/pelican-bootstrap3/" target="_blank">
                pelican-bootstrap3
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/getpelican/pelican-plugins" target="_blank">
                pelican-plugins
            </a>
        </li>
        <li class="list-group-item">
            <a href="https://github.com/Tipue/Tipue-Search" target="_blank">
                Tipue search
            </a>
        </li>
      </ul>
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2016 kmol
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="https://chiamingyen.github.io/kmolab/blog/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://chiamingyen.github.io/kmolab/blog/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="https://chiamingyen.github.io/kmolab/blog/theme/js/respond.min.js"></script>

    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'kmolab'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>