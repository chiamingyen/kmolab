var Obj2D,LinearGradient,RadialGradient,Group2D,Tweener,initZoomPan,svgToCgo2D,shapeDefs,Cango2D=function(){"use strict"
function t(t,s,i){return t.attachEvent?t.attachEvent("on"+s,i):t.addEventListener(s,i)}function s(t){var i,r=I(t)?[]:{}
for(i in t)t[i]&&"object"==typeof t[i]?r[i]=s(t[i]):r[i]=t[i]
return r}function i(t,s,i){var r,e,n=this
this.cgo=null,this.layer=null,this.target=null,this.parent=null,this.grabCallback=t||null,this.dragCallback=s||null,this.dropCallback=i||null,this.grabCsrPos={x:0,y:0},this.dwgOrg={x:0,y:0},this.dwgOrgOfs={x:0,y:0},this.grabOfs={x:0,y:0},this.grab=function(t,s){var i,a=t||window.event
return null===s.dragNdrop?!0:(this.parent=s,r=this.cgo.bkgCanvas.layers.length,e=this.cgo.bkgCanvas.layers[r-1].cElem,e.onmouseup=function(t){n.drop(t)},e.onmouseout=function(t){n.drop(t)},i=this.cgo.getCursorPosWC(a),this.grabCsrPos.x=i.x,this.grabCsrPos.y=i.y,this.dwgOrg.x=this.target.dwgOrg.x,this.dwgOrg.y=this.target.dwgOrg.y,this.target.parent?this.dwgOrgOfs={x:this.target.dwgOrg.x-this.target.parent.dwgOrg.x,y:this.target.dwgOrg.y-this.target.parent.dwgOrg.y}:this.dwgOrgOfs={x:this.target.dwgOrg.x,y:this.target.dwgOrg.y},this.grabOfs={x:i.x-this.dwgOrgOfs.x,y:i.y-this.dwgOrgOfs.y},this.grabCallback&&this.grabCallback(i),e.onmousemove=function(t){n.drag(t)},a.preventDefault?a.preventDefault():window.event.returnValue=!1,!1)},this.drag=function(t){var s=this.cgo.getCursorPosWC(t)
this.dragCallback&&this.dragCallback(s)},this.drop=function(t){var s=this.cgo.getCursorPosWC(t)
e.onmouseup=null,e.onmouseout=null,e.onmousemove=null,this.dropCallback&&this.dropCallback(s)},this.cancelDrag=function(t){e.onmouseup=null,e.onmouseout=null,e.onmousemove=null,this.dropCallback&&this.dropCallback(t)}}function r(t,s){var i
for(this.drawFn=t,this.parms=[],this.parmsPx=[],this.parmsOrg=[],i=0;i<s.length;i+=2)this.parms.push(s.slice(i,i+2)),this.parmsOrg.push(s.slice(i,i+2))}function e(){return[[1,0,0],[0,1,0],[0,0,1]]}function n(t,s){var i=t||0,r=s||0
return[[1,0,0],[0,1,0],[i,r,1]]}function a(t){var s=t||0,i=Math.PI/180,r=Math.sin(-s*i),e=Math.cos(-s*i)
return[[e,-r,0],[r,e,0],[0,0,1]]}function o(t,s){var i=t||0,r=s||0,e=Math.PI/180,n=Math.tan(-i*e),a=Math.tan(r*e)
return[[1,a,0],[n,1,0],[0,0,1]]}function h(t,s){var i=t||1,r=s||i
return[[i,0,0],[0,r,0],[0,0,1]]}function l(){this.matrix=e()}function f(t,s){var i=t[0][0],r=t[0][1],e=t[0][2],n=t[1][0],a=t[1][1],o=t[1][2],h=t[2][0],l=t[2][1],f=t[2][2],p=s[0][0],c=s[0][1],d=s[0][2],u=s[1][0],m=s[1][1],g=s[1][2],y=s[2][0],x=s[2][1],v=s[2][2]
return[[i*p+r*u+e*y,i*c+r*m+e*x,i*d+r*g+e*v],[n*p+a*u+o*y,n*c+a*m+o*x,n*d+a*g+o*v],[h*p+l*u+f*y,h*c+l*m+f*x,h*d+l*g+f*v]]}function p(t,s,i){var r=t,e=s,n=1,a=i[0][0],o=i[0][1],h=i[1][0],l=i[1][1],f=i[2][0],p=i[2][1]
return{x:r*a+e*h+n*f,y:r*o+e*l+n*p}}function c(t){var s=this,i=t[0]||0,r=t[1]||0,e=[[1,0,0],[0,1,0],[i,r,1]]
return this instanceof Obj2D?(this.ofsTfm.applyTransform(e),void(("PATH"===this.type||"SHAPE"===this.type||"CLIP"===this.type)&&this.drawCmds.forEach(function(t){t.parms=t.parms.map(function(t){return[t[0]+i,t[1]+r]})}))):{x:s.x+i,y:s.y+r}}function d(t){var s,i,r,e=this,n=t[0],a=n*Math.PI/180
return this instanceof Obj2D?(r=this.drawCmds.reduce(function(t,s){return s.parms.forEach(function(s){var i=Math.sqrt(s[0]*s[0]+s[1]*s[1])
i>t&&(t=i)}),t},0),void this.drawCmds.forEach(function(t){t.parms=t.parms.map(function(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]),n=a*e/r
return s=Math.sin(-n),i=Math.cos(-n),[t[0]*i+t[1]*s,-t[0]*s+t[1]*i]})})):(s=Math.sin(-n*Math.PI/180),i=Math.cos(-n*Math.PI/180),{x:e.x*i+e.y*s,y:-e.x*s+e.y*i})}function u(t){var s=this,i=t[0]||0,r=t[1]||0,e=Math.PI/180,n=Math.tan(-i*e),a=Math.tan(r*e),o=[[1,a,0],[n,1,0],[0,0,1]]
return this instanceof Obj2D?(this.ofsTfm.applyTransform(o),void(("PATH"===this.type||"SHAPE"===this.type||"CLIP"===this.type)&&this.drawCmds.forEach(function(t){t.parms=t.parms.map(function(t){return[t[0]+t[1]*n,t[0]*a+t[1]]})}))):{x:s.x+s.y*n,y:s.x*a+s.y}}function m(t){var s=this,i=t[0]||1,r=t[1]||i,e=[[i,0,0],[0,r,0],[0,0,1]]
return this instanceof Obj2D?(this.ofsTfm.applyTransform(e),("PATH"===this.type||"SHAPE"===this.type||"CLIP"===this.type)&&this.drawCmds.forEach(function(t){t.parms=t.parms.map(function(t){return[t[0]*i,t[1]*r]})}),this.savScale*=i,void 0):{x:s.x*i,y:s.y*r}}function g(t){var s=this,i=t[0]||0,r=Math.PI/180,e=Math.sin(-i*r),n=Math.cos(-i*r),a=[[n,-e,0],[e,n,0],[0,0,1]]
return this instanceof Obj2D?(this.ofsTfm.applyTransform(a),void(("PATH"===this.type||"SHAPE"===this.type||"CLIP"===this.type)&&this.drawCmds.forEach(function(t){t.parms=t.parms.map(function(t){return[t[0]*n+t[1]*e,-t[0]*e+t[1]*n]})}))):{x:s.x*n+s.y*e,y:-s.x*e+s.y*n}}function y(t){var s=this,i=t[0]||0,r=Math.PI/180,e=Math.sin(-i*r),n=Math.cos(-i*r),a=[[n,-e,0],[e,n,0],[0,0,1]]
return this instanceof Obj2D?(this.ofsTfm.applyTransform(a),void(("PATH"===this.type||"SHAPE"===this.type||"CLIP"===this.type)&&this.drawCmds.forEach(function(t){t.parms=t.parms.map(function(t){return[t[0]*n+t[1]*e,-t[0]*e+t[1]*n]})}))):{x:s.x*n+s.y*e,y:-s.x*e+s.y*n}}function x(t,s){var i=Array.prototype.slice.call(arguments).slice(2)
this.type=t,this.distortFn=s,this.args=i}function v(t){var s=this
this.parent=t,this.translate=function(t,i){var r=new x("TRN",c,t,i)
s.parent.ofsTfmAry.push(r)},this.scale=function(t,i){var r=new x("SCL",m,t,i)
s.parent.ofsTfmAry.unshift(r)},this.rotate=function(t){var i=new x("ROT",g,t)
s.parent.ofsTfmAry.unshift(i)},this.skew=function(t,i){var r=new x("SKW",u,t,i)
s.parent.ofsTfmAry.unshift(r)},this.revolve=function(t){var i=new x("REV",y,t)
s.parent.ofsTfmAry.push(i)},this.bend=function(t){var i=new x("BND",d,t)
s.parent.ofsTfmAry.unshift(i)},this.reset=function(){s.parent.ofsTfmAry=[],s.parent.ofsTfm.reset()}}function C(t){this.type="CLIP",this.drawCmds=N(t),this.hardOfsTfm=new l,this.lineWidthWC=null,this.savScale=1}function w(t){C.call(this,t),this.type="PATH",this.dragNdrop=null,this.border=!1,this.strokeCol=null,this.lineWidth=null,this.lineCap=null,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#000000",this.dashed=null,this.dashOffset=0}function b(t){w.call(this,t),this.type="SHAPE",this.fillCol=null}function T(t){this.type="IMG","string"==typeof t?(this.drawCmds=t,this.imgBuf=new Image,this.imgBuf.src=t):t instanceof Image&&(this.imgBuf=t,this.drawCmds=t.src),this.parent=null,this.bBoxCmds=[],this.dwgOrg={x:0,y:0},this.width=0,this.height=0,this.imgLorgX=0,this.imgLorgY=0,this.lorg=1,this.dragNdrop=null,this.hardOfsTfm=new l,this.border=!1,this.strokeCol=null,this.lineWidthWC=null,this.lineWidth=null,this.lineCap=null,this.savScale=1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#000000"}function O(t){this.type="TEXT",this.parent=null,this.drawCmds=t,this.bBoxCmds=[],this.dwgOrg={x:0,y:0},this.width=0,this.height=0,this.imgLorgX=0,this.imgLorgY=0,this.lorg=1,this.dragNdrop=null,this.hardOfsTfm=new l,this.border=!1,this.fillCol=null,this.strokeCol=null,this.fontSize=null,this.fontSizeZC=null,this.fontWeight=null,this.fontFamily=null,this.lineWidthWC=null,this.lineWidth=null,this.lineCap=null,this.savScale=1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#000000"}function P(t,s){void 0===s?t.setTransform(1,0,0,0,1,0):t.setTransform(s.matrix[0][0],s.matrix[0][1],s.matrix[1][0],s.matrix[1][1],s.matrix[2][0],s.matrix[2][1])}function k(t,s,i,r,e,n){var a
this.id=t,this.gc=s,this.obj=i,this.pathFn=e,this.options=n,this.currState={time:0},this.nextState={time:0},this.gc.ctx.save(),"function"==typeof r&&r.call(this,n),this.gc.render(this.obj),this.gc.resetClip(),this.gc.ctx.restore(),this.obj.ofsTfmAry=[]
for(a in this.nextState)this.nextState.hasOwnProperty(a)&&(this.currState[a]=this.nextState[a])}function A(t){var s,i,r=null,e=!1,n=Date.now()
t.prevAnimMode===t.modes.STOPPED&&(t.startTime=n-t.startOfs),s=n-t.startTime,t.animTasks.forEach(function(n){n.gc.cId!==r&&(e=!0,r=n.gc.cId),n.gc.ctx.save(),t.prevAnimMode===t.modes.STOPPED&&(n.currState.time=0),e&&n.gc.clearCanvas(),"function"==typeof n.pathFn&&n.pathFn.call(n,s,n.options),n.gc.render(n.obj),e=!1,n.gc.resetClip(),n.gc.ctx.restore(),i=n.currState,n.currState=n.nextState,n.nextState=i,n.currState.time=s}),t.currTime=s}function L(){this.animTasks=[],this.timer=null,this.modes={PAUSED:1,STOPPED:2,PLAYING:3,STEPPING:4},this.animMode=this.modes.STOPPED,this.prevAnimMode=this.modes.STOPPED,this.startTime=0,this.startOfs=0,this.currTime=0,this.stepTime=50}function S(t,s){this.id=t,this.cElem=s,this.dragObjects=[]}function W(t){var s,i=t.bkgCanvas.layers[0]
for(s=1;s<t.bkgCanvas.layers.length;s++)if(t.bkgCanvas.layers[s].id===t.cId){i=t.bkgCanvas.layers[s]
break}return i}function M(t){function s(s){function i(s){var i=t.cnvs.getBoundingClientRect()
return{x:s.clientX-i.left,y:s.clientY-i.top}}function r(s,i,r){return t.ctx.beginPath(),"TEXT"===s.type||"IMG"===s.type?s.bBoxCmds.forEach(function(s){t.ctx[s.drawFn].apply(t.ctx,s.parmsPx)}):s.drawCmds.forEach(function(s){t.ctx[s.drawFn].apply(t.ctx,s.parmsPx)}),t.ctx.isPointInPath(i,r)}var e,n,a,o,h,l,f=s||window.event
e=i(f),a=t.bkgCanvas.layers.length
t:for(h=a-1;h>=0;h--)for(o=t.bkgCanvas.layers[h],l=o.dragObjects.length-1;l>=0;l--)if(n=o.dragObjects[l],r(n,e.x,e.y)&&n.dragNdrop){n.dragNdrop.grab(f,n)
break t}}t.cnvs.onmousedown=s}function D(s){function i(){var t,s,i=n.bkgCanvas.offsetTop+n.bkgCanvas.clientTop,r=n.bkgCanvas.offsetLeft+n.bkgCanvas.clientLeft,e=n.bkgCanvas.offsetWidth,a=n.bkgCanvas.offsetHeight
if(n.bkgCanvas.timeline&&n.bkgCanvas.timeline.animTasks.length&&n.deleteAllAnimations(),n.rawWidth=e,n.rawHeight=a,n.aRatio=e/a,n.bkgCanvas===n.cnvs)for(n.cnvs.setAttribute("width",e),n.cnvs.setAttribute("height",a),t=1;t<n.bkgCanvas.layers.length;t++)s=n.bkgCanvas.layers[t].cElem,s&&(s.style.top=i+"px",s.style.left=r+"px",s.style.width=e+"px",s.style.height=a+"px",s.setAttribute("width",e),s.setAttribute("height",a))}var r,e,n=this
return this.cId=s,this.cnvs=document.getElementById(s),null===this.cnvs?void alert("can't find canvas "+s):(this.bkgCanvas=this.cnvs,-1!==s.indexOf("_ovl_")&&(r=s.slice(0,s.indexOf("_ovl_")),this.bkgCanvas=document.getElementById(r)),this.rawWidth=this.cnvs.offsetWidth,this.rawHeight=this.cnvs.offsetHeight,this.aRatio=this.rawWidth/this.rawHeight,this.bkgCanvas.hasOwnProperty("layers")||(this.bkgCanvas.layers=[],e=new S(this.cId,this.cnvs),this.bkgCanvas.layers[0]=e,t(this.bkgCanvas,"resize",i)),void 0===L||this.bkgCanvas.hasOwnProperty("timeline")||(this.bkgCanvas.timeline=new L),this.cnvs.hasOwnProperty("resized")||(this.cnvs.setAttribute("width",this.rawWidth),this.cnvs.setAttribute("height",this.rawHeight),this.cnvs.resized=!0),this.ctx=this.cnvs.getContext("2d"),this.vpW=this.rawWidth,this.vpH=this.rawHeight,this.vpLLx=0,this.vpLLy=this.rawHeight,this.xscl=1,this.yscl=-1,this.xoffset=0,this.yoffset=0,this.savWC={xscl:this.xscl,yscl:this.yscl,xoffset:this.xoffset,yoffset:this.yoffset},this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",this.penCol="rgba(0, 0, 0, 1.0)",this.penWid=1,this.lineCap="butt",this.paintCol="rgba(128, 128, 128, 1.0)",this.fontSize=12,this.fontWeight=400,this.fontFamily="Consolas, Monaco, 'Andale Mono', monospace",this.clipCount=0,this.worldToPixel=new l,this.getUnique=function(){return j+=1},void M(this))}var E,N,j=0
Date.now||(Date.now=function(){return(new Date).getTime()})
var I=function(t){return"[object Array]"===Object.prototype.toString.call(t)}
return Array.prototype.contains||(Array.prototype.contains=function(t){return this.indexOf(t)>-1}),E=function(){function t(t,s,i){return 0===i&&"string"!=typeof s&&t.push("M"),"string"==typeof s&&(d.hasOwnProperty(s.toUpperCase())||(console.log("unknown command string '"+s+"'"),t.badCmdFound=!0,t.length=0)),t.badCmdFound||t.push(s),t}function s(t,s,i,r){var e
if(0===i&&(t.nextCmdPos=0),"string"==typeof s){if(i<t.nextCmdPos)return console.log("bad number of parameters for '"+s+"' at index "+i),t.badParameter=!0,t.push(0),t
t.currCmd=s.toUpperCase(),t.uc=s.toUpperCase()===s,t.nextCmdPos=i+d[t.currCmd].parmCount+1,t.push(s)}else i<t.nextCmdPos?t.push(s):(t.currCmd=d[t.currCmd].extCmd,e=t.uc?t.currCmd:t.currCmd.toLowerCase(),t.push(e,s),t.nextCmdPos=i+d[t.currCmd].parmCount)
return i===r.length-1&&t.badParameter&&(t.length=0),t}function i(t,s){return"string"==typeof s&&t.push([]),t[t.length-1].push(s),t}function e(t,s,i){var r,e
return void 0===t.px&&(t.px=0,t.py=0),r=d[s[0].toUpperCase()],e=r.toAbs(t,s,i),t.push(e),t}function n(t,s,i){var r=s[0],e=d[r]
return e.toCangoVersion(t,s,i),t}function a(t){var s=t[0],i=t.slice(1)
return new r(d[s].canvasMethod,i)}function o(t,s){var i,r,e=s[0]
return t.push(e),i=s.slice(1),r=i.match(/\S+/g),r&&r.forEach(function(s){var i=parseFloat(s)
isNaN(i)||t.push(i)}),t}function h(t){var s=t[0],i=d[s]
return i.invertCoords(t)}function l(t){var s=t[0],i=d[s],r=this.xOfs||0,e=this.yOfs||0
return i.addXYoffset(t,r,e)}function f(t,s){return t.concat(s)}var p=function(t,s,i,r,e,n,a,o){var h=o*e,l=-a*n,f=a*e,p=o*n,c=.5*(r-i),d=8/3*Math.sin(.5*c)*Math.sin(.5*c)/Math.sin(c),u=t+Math.cos(i)-d*Math.sin(i),m=s+Math.sin(i)+d*Math.cos(i),g=t+Math.cos(r),y=s+Math.sin(r),x=g+d*Math.sin(r),v=y-d*Math.cos(r)
return[h*u+l*m,f*u+p*m,h*x+l*v,f*x+p*v,h*g+l*y,f*g+p*y]},c=function(t,s,i,r,e,n,a,o,h){function l(t){return Math.abs(t)<1e-5?0:t}var f,c,d,u,m,g,y,x,v,C,w,b,T,O,P,k,A,L,S,W,M,D,E=e*(Math.PI/180),N=Math.sin(E),j=Math.cos(E),I=Math.abs(i),H=Math.abs(r),B=j*(t-o)*.5+N*(s-h)*.5,G=j*(s-h)*.5-N*(t-o)*.5,X=B*B/(I*I)+G*G/(H*H),Y=[]
for(X>1&&(X=Math.sqrt(X),I*=X,H*=X),f=j/I,c=N/I,d=-N/H,u=j/H,m=f*t+c*s,g=d*t+u*s,y=f*o+c*h,x=d*o+u*h,v=(y-m)*(y-m)+(x-g)*(x-g),C=1/v-.25,0>C&&(C=0),w=Math.sqrt(C),a===n&&(w=-w),b=.5*(m+y)-w*(x-g),T=.5*(g+x)+w*(y-m),O=Math.atan2(g-T,m-b),P=Math.atan2(x-T,y-b),k=P-O,0>k&&1===a?k+=2*Math.PI:k>0&&0===a&&(k-=2*Math.PI),A=Math.ceil(Math.abs(k/(.5*Math.PI+.001))),W=0;A>W;W++)M=O+W*k/A,D=O+(W+1)*k/A,L=p(b,T,M,D,I,H,N,j),S=L.map(l),Y.push(S)
return Y},d={M:{canvasMethod:"moveTo",parmCount:2,extCmd:"L",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2]
return r!==s[0]&&(e+=t.px,n+=t.py),i=[r,e,n],t.px=e,t.py=n,i},toCangoVersion:function(t,s){var i=s[1],r=s[2]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2]
return r+=s,e+=i,["M",r,e]},invertCoords:function(t){var s=t[1],i=t[2]
return["M",s,-i]}},L:{canvasMethod:"lineTo",parmCount:2,extCmd:"L",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2]
return r!==s[0]&&(e+=t.px,n+=t.py),i=[r,e,n],t.px=e,t.py=n,i},toCangoVersion:function(t,s){var i=s[1],r=s[2]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2]
return r+=s,e+=i,["L",r,e]},invertCoords:function(t){var s=t[1],i=t[2]
return["L",s,-i]}},H:{parmCount:1,extCmd:"H",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1]
return r!==s[0]&&(e+=t.px),i=[r,e],t.px=e,i},toCangoVersion:function(t,s){var i=s[1],r=t.py,e=["L",i,r]
t.px=i,t.push(e)},addXYoffset:function(t,s,i){var r=t[1]
return r+=s,["H",r]},invertCoords:function(t){var s=t[1]
return["H",s]}},V:{parmCount:1,extCmd:"V",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1]
return r!==s[0]&&(e+=t.py),i=[r,e],t.py=e,i},toCangoVersion:function(t,s){var i=t.px,r=s[1],e=["L",i,r]
t.py=r,t.push(e)},addXYoffset:function(t,s,i){var r=t[1]
return r+=i,["V",r]},invertCoords:function(t){var s=t[1]
return["V",-s]}},C:{canvasMethod:"bezierCurveTo",parmCount:6,extCmd:"C",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2],a=s[3],o=s[4],h=s[5],l=s[6]
return r!==s[0]&&(e+=t.px,n+=t.py,a+=t.px,o+=t.py,h+=t.px,l+=t.py),i=[r,e,n,a,o,h,l],t.px=h,t.py=l,i},toCangoVersion:function(t,s){var i=s[5],r=s[6]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2],n=t[3],a=t[4],o=t[5],h=t[6]
return r+=s,e+=i,n+=s,a+=i,o+=s,h+=i,["C",r,e,n,a,o,h]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4],n=t[5],a=t[6]
return["C",s,-i,r,-e,n,-a]}},S:{parmCount:4,extCmd:"S",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2],a=s[3],o=s[4]
return r!==s[0]&&(e+=t.px,n+=t.py,a+=t.px,o+=t.py),i=[r,e,n,a,o],t.px=a,t.py=o,i},toCangoVersion:function(t,s,i){var r,e=0,n=0,a=s[1],o=s[2],h=s[3],l=s[4],f=t[i-1]
"C"===f[0]&&(e=t.px-f[f.length-4],n=t.py-f[f.length-3]),e+=t.px,n+=t.py,r=["C",e,n,a,o,h,l],t.px=h,t.py=l,t.push(r)},addXYoffset:function(t,s,i){var r=t[1],e=t[2],n=t[3],a=t[4]
return r+=s,e+=i,n+=s,a+=i,["S",r,e,n,a]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4]
return["S",s,-i,r,-e]}},Q:{canvasMethod:"quadraticCurveTo",parmCount:4,extCmd:"Q",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2],a=s[3],o=s[4]
return r!==s[0]&&(e+=t.px,n+=t.py,a+=t.px,o+=t.py),i=[r,e,n,a,o],t.px=a,t.py=o,i},toCangoVersion:function(t,s){var i=s[3],r=s[4]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2],n=t[3],a=t[4]
return r+=s,e+=i,n+=s,a+=i,["Q",r,e,n,a]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4]
return["Q",s,-i,r,-e]}},T:{parmCount:2,extCmd:"T",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2]
return r!==s[0]&&(e+=t.px,n+=t.py),i=[r,e,n],t.px=e,t.py=n,i},toCangoVersion:function(t,s,i){var r,e=0,n=0,a=s[1],o=s[2],h=t[i-1]
"Q"===h[0]&&(e=t.px-h[h.length-4],n=t.py-h[h.length-3]),e+=t.px,n+=t.py,r=["Q",e,n,a,o],t.px=a,t.py=o,t.push(r)},addXYoffset:function(t,s,i){var r=t[1],e=t[2]
return r+=s,e+=i,["T",r,e]},invertCoords:function(t){var s=t[1],i=t[2]
return["T",s,-i]}},A:{parmCount:7,extCmd:"A",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],n=s[2],a=s[3],o=s[4],h=s[5],l=s[6],f=s[7]
return r!==s[0]&&(l+=t.px,f+=t.py),i=[r,e,n,a,o,h,l,f],t.px=l,t.py=f,i},toCangoVersion:function(t,s){var i,r=s[1],e=s[2],n=s[3],a=s[4],o=s[5],h=s[6],l=s[7]
i=c(t.px,t.py,r,e,n,a,o,h,l),i.forEach(function(s){t.push(["C"].concat(s))}),t.px=h,t.py=l},addXYoffset:function(t,s,i){var r=t[1],e=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7]
return h+=s,l+=i,["A",r,e,n,a,o,h,l]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4],n=t[5],a=t[6],o=t[7]
return["A",s,i,-r,e,1-n,a,-o]}},Z:{canvasMethod:"closePath",parmCount:0,toAbs:function(t,s){var i=s[0].toUpperCase(),r=[i]
return r},toCangoVersion:function(t,s){t.push(s)},addXYoffset:function(t,s,i){return["Z"]},invertCoords:function(t){return["Z"]}}}
return{svg2cartesian:function(r,n,a){var p,c,d=n||0,u=a||0
return"string"!=typeof r||0===r.length?[]:(p=r.replace(RegExp(",","g")," "),c=p.split(/(?=[a-df-z])/i),c.reduce(o,[]).reduce(t,[]).reduce(s,[]).reduce(i,[]).reduce(e,[]).map(l,{xOfs:d,yOfs:u}).map(h).reduce(f,[]))},cgo2drawcmds:function(r){return I(r)&&0!==r.length?r.reduce(t,[]).reduce(s,[]).reduce(i,[]).reduce(e,[]).reduce(n,[]).map(a):[]}}}(),N=E.cgo2drawcmds,void 0===shapeDefs&&(shapeDefs={circle:function(t){var s=t||1
return["m",-.5*s,0,"c",0,-.27614*s,.22386*s,-.5*s,.5*s,-.5*s,"c",.27614*s,0,.5*s,.22386*s,.5*s,.5*s,"c",0,.27614*s,-.22386*s,.5*s,-.5*s,.5*s,"c",-.27614*s,0,-.5*s,-.22386*s,-.5*s,-.5*s]},ellipse:function(t,s){var i=t||1,r=i
return"number"==typeof s&&s>0&&(r=s),["m",-.5*i,0,"c",0,-.27614*r,.22386*i,-.5*r,.5*i,-.5*r,"c",.27614*i,0,.5*i,.22386*r,.5*i,.5*r,"c",0,.27614*r,-.22386*i,.5*r,-.5*i,.5*r,"c",-.27614*i,0,-.5*i,-.22386*r,-.5*i,-.5*r]},square:function(t){var s=t||1
return["m",.5*s,-.5*s,"l",0,s,-s,0,0,-s,"z"]},rectangle:function(t,s,i){var r
return void 0===i||0>=i?["m",-t/2,-s/2,"l",t,0,0,s,-t,0,"z"]:(r=Math.min(t/2,s/2,i),["m",-t/2+r,-s/2,"l",t-2*r,0,"a",r,r,0,0,1,r,r,"l",0,s-2*r,"a",r,r,0,0,1,-r,r,"l",-t+2*r,0,"a",r,r,0,0,1,-r,-r,"l",0,-s+2*r,"a",r,r,0,0,1,r,-r])},triangle:function(t){var s=t||1
return["m",.5*s,-.289*s,"l",-.5*s,.866*s,-.5*s,-.866*s,"z"]},cross:function(t){var s=t||1
return["m",-.5*s,0,"l",s,0,"m",-.5*s,-.5*s,"l",0,s]},ex:function(t){var s=t||1
return["m",-.3535*s,-.3535*s,"l",.707*s,.707*s,"m",-.707*s,0,"l",.707*s,-.707*s]}}),LinearGradient=function(t,s,i,r){this.grad=[t,s,i,r],this.colorStops=[],this.addColorStop=function(){this.colorStops.push(arguments)}},RadialGradient=function(t,s,i,r,e,n){this.grad=[t,s,i,r,e,n],this.colorStops=[],this.addColorStop=function(){this.colorStops.push(arguments)}},Tweener=function(t,s,i){this.delay=t||0,this.dur=s||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1
var r=this,e="noloop"
"string"==typeof i&&(e=i.toLowerCase()),"loop"===e?this.loop=!0:"loopall"===e&&(this.loopAll=!0),this.getVal=function(t,s,i){var e,n,a,o,h,l,f,p,c,d=0
if(0===t&&(r.reStartOfs=0),f=t-r.reStartOfs,f>r.dur+r.delay&&r.dur>0&&(r.loop||r.loopAll)&&(r.reStartOfs=r.loop?t-r.delay:t,f=0),d=0,f>r.delay&&(d=f-r.delay),!I(s))return s
if(!s.length)return 0
if(1===s.length)return s[0]
if(0===d)return s[0]
if(d>=r.dur)return s[s.length-1]
if(e=s.length-1,!I(i)||s.length!==i.length)return n=r.dur/e,a=Math.floor(d/n),o=(d-a*n)/n,s[a]+o*(s[a+1]-s[a])
for(p=[].concat(s),c=[].concat(i),0!==c[0]&&(p.unshift(p[0]),c.unshift(0)),100!==c[c.length-1]&&(p.push(p[p.length-1]),c.push(100)),h=0,l=d/r.dur;h<c.length-1&&c[h+1]/100<l;)h++
return n=(c[h+1]-c[h])/100,o=(l-c[h]/100)/n,p[h]+o*(p[h+1]-p[h])}},l.prototype.reset=function(){this.matrix[0][0]=1,this.matrix[0][1]=0,this.matrix[0][2]=0,this.matrix[1][0]=0,this.matrix[1][1]=1,this.matrix[1][2]=0,this.matrix[2][0]=0,this.matrix[2][1]=0,this.matrix[2][2]=1},l.prototype.applyTransform=function(t){var s=this.matrix[0][0],i=this.matrix[0][1],r=this.matrix[0][2],e=this.matrix[1][0],n=this.matrix[1][1],a=this.matrix[1][2],o=this.matrix[2][0],h=this.matrix[2][1],l=this.matrix[2][2],f=t[0][0],p=t[0][1],c=t[0][2],d=t[1][0],u=t[1][1],m=t[1][2],g=t[2][0],y=t[2][1],x=t[2][2]
this.matrix[0][0]=s*f+i*d+r*g,this.matrix[0][1]=s*p+i*u+r*y,this.matrix[0][2]=s*c+i*m+r*x,this.matrix[1][0]=e*f+n*d+a*g,this.matrix[1][1]=e*p+n*u+a*y,this.matrix[1][2]=e*c+n*m+a*x,this.matrix[2][0]=o*f+h*d+l*g,this.matrix[2][1]=o*p+h*u+l*y,this.matrix[2][2]=o*c+h*m+l*x},Group2D=function(){this.type="GRP",this.parent=null,this.children=[],this.dwgOrg={x:0,y:0},this.ofsTfmAry=[],this.netTfmAry=[],this.ofsTfm=new l,this.netTfm=new l,this.transform=new v(this),this.addObj.apply(this,arguments)},Group2D.prototype.deleteObj=function(t){var s=this.children.indexOf(t)
s>=0&&this.children.splice(s,1)},Group2D.prototype.addObj=function(){var t,s,i=Array.prototype.slice.call(arguments)
for(t=0;t<i.length;t++)if(I(i[t]))for(s=0;s<i[t].length;s++)i[t][s].type&&(null!==i[t][s].parent&&i[t][s].parent.deleteObj(i[t][s]),i[t][s].parent=this,this.children.push(i[t][s]),!i[t][s].dragNdrop&&this.dragNdrop&&(i[t][s].dragNdrop=this.dragNdrop))
else i[t].type&&(null!==i[t].parent&&i[t].parent.deleteObj(i[t]),i[t].parent=this,this.children.push(i[t]),!i[t].dragNdrop&&this.dragNdrop&&(i[t].dragNdrop=this.dragNdrop))},Group2D.prototype.translate=function(t,s){function i(r){r.children.forEach(function(r){"GRP"===r.type?i(r):r.translate(t,s)})}i(this)},Group2D.prototype.rotate=function(t){function s(i){i.children.forEach(function(i){"GRP"===i.type?s(i):i.rotate(t)})}s(this)},Group2D.prototype.skew=function(t,s){function i(r){r.children.forEach(function(r){"GRP"===r.type?i(r):r.skew(t,s)})}i(this)},Group2D.prototype.scale=function(t,s){function i(t){t.children.forEach(function(t){"GRP"===t.type?i(t):t.scale(r,e)})}var r=t,e=s||r
i(this)},Group2D.prototype.enableDrag=function(t,s,i){function r(n){n.children.forEach(function(n){"GRP"===n.type?r(n):null===n.dragNdrop&&(n.enableDrag(t,s,i),n.dragNdrop.target=e)})}var e=this
r(this)},Group2D.prototype.disableDrag=function(){function t(s){s.children.forEach(function(s){"GRP"===s.type?t(s):s.disableDrag()})}t(this)},C.prototype.applyHardOfsTfm=function(){var t=this
this.drawCmds.forEach(function(i){i.parms=i.parms.map(function(s){var i=p(s[0],s[1],t.hardOfsTfm.matrix)
return[i.x,i.y]}),i.parmsOrg=s(i.parms)}),this.hardOfsTfm.reset()},C.prototype.translate=function(t,s){this.hardOfsTfm.applyTransform(n(t,s)),this.applyHardOfsTfm()},C.prototype.rotate=function(t){this.hardOfsTfm.applyTransform(a(t)),this.applyHardOfsTfm()},C.prototype.skew=function(t,s){this.hardOfsTfm.applyTransform(o(t,s)),this.applyHardOfsTfm()},C.prototype.scale=function(t,s){this.hardOfsTfm.applyTransform(h(t,s)),this.applyHardOfsTfm(),this.lineWidthWC&&(this.lineWidthWC*=t)},C.prototype.appendPath=function(t,i){var r=s(t.drawCmds)
i?this.drawCmds=this.drawCmds.concat(r.slice(1)):this.drawCmds=this.drawCmds.concat(r)},w.prototype=new C,w.prototype.revWinding=function(){function t(t){return t.reduceRight(function(t,s){return t.push(s[0],s[1]),t},[])}var s,i,e,n,a,o=null,h=[]
for("closePath"===this.drawCmds[this.drawCmds.length-1].drawFn?(s=this.drawCmds.slice(0,-1),o=this.drawCmds.slice(-1)):s=this.drawCmds.slice(0),i=s.length-1,e=s[i].parms.length,a=new r("moveTo",s[i].parms[e-1]),h.push(a),s[i].parms=s[i].parms.slice(0,-1);i>0;)n=t(s[i].parms),e=s[i-1].parms.length,n=n.concat(s[i-1].parms[e-1]),a=new r(s[i].drawFn,n),h.push(a),s[i-1].parms=s[i-1].parms.slice(0,-1),i--
o&&h.push(o),this.drawCmds=h},b.prototype=new w,T.prototype.translate=function(t,s){this.hardOfsTfm.applyTransform(n(t,s))},T.prototype.rotate=function(t){this.hardOfsTfm.applyTransform(a(t))},T.prototype.skew=function(t,s){this.hardOfsTfm.applyTransform(o(t,s))},T.prototype.scale=function(t,s){this.hardOfsTfm.applyTransform(h(t,s)),this.lineWidthWC&&(this.lineWidthWC*=t),this.savScale*=t},T.prototype.formatImg=function(){var t,s,i,e,n,a,o,h,l,f,p,c,d,u=0,m=0
this.imgBuf.width||console.log("in image onload handler yet image NOT loaded!"),this.width&&this.height?(t=this.width,s=this.height):this.width&&!this.height?(t=this.width,s=this.height||t*this.imgBuf.height/this.imgBuf.width):this.height&&!this.width?(s=this.height,t=this.width||s*this.imgBuf.width/this.imgBuf.height):(t=this.imgBuf.width,s=this.imgBuf.height),i=t/2,e=s/2,d=[0,[0,0],[i,0],[t,0],[0,e],[i,e],[t,e],[0,s],[i,s],[t,s]],void 0!==d[this.lorg]&&(u=-d[this.lorg][0],m=-d[this.lorg][1]),this.imgLorgX=u,this.imgLorgY=m,this.width=t,this.height=s,n=u,a=m,o=u,h=m+s,l=u+t,f=m+s,p=u+t,c=m,this.bBoxCmds[0]=new r("moveTo",[n,-a]),this.bBoxCmds[1]=new r("lineTo",[o,-h]),this.bBoxCmds[2]=new r("lineTo",[l,-f]),this.bBoxCmds[3]=new r("lineTo",[p,-c]),this.bBoxCmds[4]=new r("closePath",[])},O.prototype.translate=function(t,s){this.hardOfsTfm.applyTransform(n(t,s))},O.prototype.rotate=function(t){this.hardOfsTfm.applyTransform(a(t))},O.prototype.skew=function(t,s){this.hardOfsTfm.applyTransform(o(t,s))},O.prototype.scale=function(t,s){this.hardOfsTfm.applyTransform(h(t,s)),this.lineWidth&&(this.lineWidth/=t)},O.prototype.formatText=function(t){var s,i,e,n,a,o,h,l,f,p,c,d,u,m,g=this.fontSize||t.fontSize,y=this.fontFamily||t.fontFamily,x=this.fontWeight||t.fontWeight,v=this.lorg||1,C=0,w=0
this.orgXscl||(this.orgXscl=t.xscl),m=t.xscl/this.orgXscl,this.fontSizeZC=g*m,t.ctx.save(),t.ctx.font=x+" "+g+"px "+y,s=1.05*t.ctx.measureText(this.drawCmds).width,t.ctx.restore(),s*=m,i=g*m,e=s/2,n=i/2,a=[0,[0,i],[e,i],[s,i],[0,n],[e,n],[s,n],[0,0],[e,0],[s,0]],void 0!==a[v]&&(C=-a[v][0],w=a[v][1]),this.imgLorgX=C,this.imgLorgY=w-.25*i,this.width=s,this.height=i,o=C,h=w,l=C,f=w-i,p=C+s,c=w-i,d=C+s,u=w,this.bBoxCmds[0]=new r("moveTo",[o,-h]),this.bBoxCmds[1]=new r("lineTo",[l,-f]),this.bBoxCmds[2]=new r("lineTo",[p,-c]),this.bBoxCmds[3]=new r("lineTo",[d,-u]),this.bBoxCmds[4]=new r("closePath",[])},Obj2D=function(t,s,i){var r,e,n,a
switch(s){default:case"PATH":r=w
break
case"SHAPE":r=b
break
case"IMG":r=T
break
case"TEXT":r=O
break
case"CLIP":r=C}r.call(this,t),e=new r
for(a in e)"function"==typeof e[a]&&(this[a]=e[a])
this.parent=null,this.dwgOrg={x:0,y:0},this.ofsTfmAry=[],this.netTfmAry=[],this.ofsTfm=new l,this.netTfm=new l,this.zIndex=0,this.transform=new v(this),n="object"==typeof i?i:{}
for(a in n)n.hasOwnProperty(a)&&this.setProperty(a,n[a])},Obj2D.prototype.enableDrag=function(t,s,r){this.dragNdrop=new i(t,s,r),this.dragNdrop.target=this},Obj2D.prototype.disableDrag=function(){var t
this.dragNdrop&&(t=this.dragNdrop.layer.dragObjects.indexOf(this),this.dragNdrop.layers.dragObjects.splice(t,1),this.dragNdrop=null)},Obj2D.prototype.setProperty=function(t,s){var i=[1,2,3,4,5,6,7,8,9]
if("string"==typeof t&&void 0!==s&&null!==s&&"CLIP"!==this.type)switch(t.toLowerCase()){case"fillcolor":this.fillCol=s
break
case"strokecolor":this.strokeCol=s
break
case"linewidth":case"strokewidth":"number"==typeof s&&s>0&&(this.lineWidth=s)
break
case"linewidthwc":"number"==typeof s&&s>0&&(this.lineWidthWC=s)
break
case"linecap":if("string"!=typeof s)return;("butt"===s||"round"===s||"square"===s)&&(this.lineCap=s)
break
case"dashed":Array.isArray(s)&&s[0]?this.dashed=s:this.dashed=null
break
case"dashoffset":this.dashOffset=s||0
break
case"border":s===!0&&(this.border=!0),s===!1&&(this.border=!1)
break
case"fontsize":"number"==typeof s&&s>0&&(this.fontSize=s)
break
case"fontweight":("string"==typeof s||"number"==typeof s&&s>=100&&900>=s)&&(this.fontWeight=s)
break
case"fontfamily":"string"==typeof s&&(this.fontFamily=s)
break
case"imgwidth":this.width=Math.abs(s)
break
case"imgheight":this.height=Math.abs(s)
break
case"lorg":-1!==i.indexOf(s)&&(this.lorg=s)
break
case"zindex":this.zIndex=1*s
break
case"shadowoffsetx":this.shadowOffsetX=s||0
break
case"shadowoffsety":this.shadowOffsetY=s||0
break
case"shadowblur":this.shadowBlur=s||0
break
case"shadowcolor":this.shadowColor=s
break
default:return}},Obj2D.prototype.dup=function(){var t=new Obj2D
return t.type=this.type,t.drawCmds=s(this.drawCmds),t.imgBuf=this.imgBuf,t.bBoxCmds=s(this.bBoxCmds),t.dwgOrg=s(this.dwgOrg),t.hardOfsTfm=s(this.hardOfsTfm),t.ofsTfmAry=s(this.ofsTfmAry),t.border=this.border,t.strokeCol=this.strokeCol,t.fillCol=this.fillCol,t.lineWidth=this.lineWidth,t.lineWidthWC=this.lineWidthWC,t.lineCap=this.lineCap,t.savScale=this.savScale,t.dashed=this.dashed,t.dashOffset=this.dashOffset,t.width=this.width,t.height=this.height,t.imgLorgX=this.imgLorgX,t.imgLorgY=this.imgLorgY,t.lorg=this.lorg,t.fontSize=this.fontSize,t.fontWeight=this.fontWeight,t.fontFamily=this.fontFamily,t.zIndex=this.zIndex,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur,t.shadowColor=this.shadowColor,t},L.prototype.stopAnimation=function(){window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.STOPPED,this.currTime=0,this.startOfs=0},L.prototype.pauseAnimation=function(){window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.PAUSED},L.prototype.stepAnimation=function(){function t(){A(s),s.prevAnimMode=s.modes.PAUSED,s.animMode=s.modes.PAUSED}var s=this
this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.STEPPING,setTimeout(t,this.stepTime))},L.prototype.redrawAnimation=function(){this.animMode!==this.modes.PLAYING&&(this.startTime=Date.now()-this.currTime,A(this))},L.prototype.playAnimation=function(t,s){function i(){A(r),r.prevAnimMode=r.modes.PLAYING,s?r.currTime<s?r.timer=window.requestAnimationFrame(i):r.stopAnimation():r.timer=window.requestAnimationFrame(i)}var r=this
this.startOfs=t||0,this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.PLAYING,this.timer=window.requestAnimationFrame(i))},D.prototype.animate=function(t,s,i,r){var e,n
return n=this.cId+"_"+this.getUnique(),e=new k(n,this,t,s,i,r),this.stopAnimation(),this.bkgCanvas.timeline.animTasks.push(e),e.id},D.prototype.pauseAnimation=function(){this.bkgCanvas.timeline.pauseAnimation()},D.prototype.playAnimation=function(t,s){this.bkgCanvas.timeline.playAnimation(t,s)},D.prototype.stopAnimation=function(){this.bkgCanvas.timeline.stopAnimation()},D.prototype.stepAnimation=function(){this.bkgCanvas.timeline.stepAnimation()},D.prototype.deleteAnimation=function(t){var s,i=-1
for(this.pauseAnimation(),s=0;s<this.bkgCanvas.timeline.animTasks.length;s++)if(this.bkgCanvas.timeline.animTasks[s].id===t){i=s
break}-1!==i&&this.bkgCanvas.timeline.animTasks.splice(i,1)},D.prototype.deleteAllAnimations=function(){this.stopAnimation(),this.bkgCanvas.timeline.animTasks=[]},D.prototype.toPixelCoords=function(t,s){var i=this.vpLLx+this.xoffset+t*this.xscl,r=this.vpLLy+this.yoffset+s*this.yscl
return{x:i,y:r}},D.prototype.toWorldCoords=function(t,s){var i=(t-this.vpLLx-this.xoffset)/this.xscl,r=(s-this.vpLLy-this.yoffset)/this.yscl
return{x:i,y:r}},D.prototype.getCursorPosWC=function(t){var s=t||window.event,i=this.cnvs.getBoundingClientRect(),r=(s.clientX-i.left-this.vpLLx-this.xoffset)/this.xscl,e=(s.clientY-i.top-this.vpLLy-this.yoffset)/this.yscl
return{x:r,y:e}},D.prototype.clearCanvas=function(t){function s(t){var s=e.toPixelCoords(t.grad[0],t.grad[1]),i=e.toPixelCoords(t.grad[2],t.grad[3]),r=e.ctx.createLinearGradient(s.x,s.y,i.x,i.y)
return t.colorStops.forEach(function(t){r.addColorStop(t[0],t[1])}),r}function i(t){var s=e.toPixelCoords(t.grad[0],t.grad[1]),i=t.grad[2]*e.xscl,r=e.toPixelCoords(t.grad[3],t.grad[4]),n=t.grad[5]*e.xscl,a=e.ctx.createRadialGradient(s.x,s.y,i,r.x,r.y,n)
return t.colorStops.forEach(function(t){a.addColorStop(t[0],t[1])}),a}var r,e=this
t?(this.ctx.save(),t instanceof LinearGradient?this.ctx.fillStyle=s(t):t instanceof RadialGradient?this.ctx.fillStyle=i(t):this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.rawWidth,this.rawHeight),this.ctx.restore()):this.ctx.clearRect(0,0,this.rawWidth,this.rawHeight),r=W(this),r.dragObjects.length=0},D.prototype.setWorldCoords=function(t,s,i){var r=t||0,e=s||0
void 0===i||0>=i?this.xscl=1:this.xscl=this.vpW/i,this.yscl=-this.xscl,this.xoffset=-r*this.xscl,this.yoffset=-e*this.yscl,this.savWC={xscl:this.xscl,yscl:this.yscl,xoffset:this.xoffset,yoffset:this.yoffset}},D.prototype.setPropertyDefault=function(t,s){if("string"==typeof t&&void 0!==s&&null!==s)switch(t.toLowerCase()){case"fillcolor":("string"==typeof s||"object"==typeof s)&&(this.paintCol=s)
break
case"strokecolor":("string"==typeof s||"object"==typeof s)&&(this.penCol=s)
break
case"linewidth":case"strokewidth":this.penWid=s
break
case"linecap":"string"!=typeof s||"butt"!==s&&"round"!==s&&"square"!==s||(this.lineCap=s)
break
case"fontfamily":"string"==typeof s&&(this.fontFamily=s)
break
case"fontsize":this.fontSize=s
break
case"fontweight":("string"==typeof s||s>=100&&900>=s)&&(this.fontWeight=s)
break
case"steptime":s>=15&&500>=s&&(this.stepTime=s)
break
default:return}},D.prototype.createGroup2D=function(){var t=new Group2D
return t.addObj.apply(t,arguments),t},D.prototype.dropShadow=function(t,s){var i=t.shadowOffsetX||0,r=t.shadowOffsetY||0,e=t.shadowBlur||0,n=t.shadowColor||"#000000",a=s||1,o=s||1
void 0!==this.ctx.shadowOffsetX&&(a*=this.xscl,o*=-this.xscl,this.ctx.shadowOffsetX=i*a,this.ctx.shadowOffsetY=r*o,this.ctx.shadowBlur=e*a,this.ctx.shadowColor=n)},D.prototype.render=function(i,r){function e(t){var i,r
t.parent?(i=t.parent.netTfmAry,r=t.parent.netTfm):(i=[],r=new l),t.ofsTfm.reset(),t.netTfmAry=t.ofsTfmAry.concat(i),t.dwgOrg={x:0,y:0},t.netTfmAry.forEach(function(s){t.dwgOrg=s.distortFn.call(t.dwgOrg,s.args)}),"GRP"!==t.type&&(("PATH"===t.type||"SHAPE"===t.type||"CLIP"===t.type)&&t.drawCmds.forEach(function(t){t.parms=s(t.parmsOrg)}),t.netTfmAry.forEach(function(s){s.distortFn.call(t,s.args)}),t.netTfm.matrix=f(t.hardOfsTfm.matrix,t.ofsTfm.matrix),t.netTfm.applyTransform(r.matrix))}function n(){function t(i,r){i(r),"GRP"===r.type?r.children.forEach(function(s){t(i,s)}):s.push(r)}var s=[]
return t(e,i),s}function a(t,s){return t.zIndex-s.zIndex}function o(s){function i(){s.formatImg(),c.paintImg(s)}"IMG"===s.type?s.imgBuf.complete?i():t(s.imgBuf,"load",i):"TEXT"===s.type?(s.formatText(c),c.paintText(s)):"CLIP"===s.type?c.applyClipMask(s):c.paintPath(s)}function h(t){t.transform.reset(),t.savScale=1,"GRP"===t.type&&t.children.forEach(function(t){h(t)})}var p,c=this
r===!0&&this.clearCanvas(),"GRP"===i.type?(p=n(),p.sort(a),p.forEach(o)):(e(i),o(i)),h(i)},D.prototype.paintImg=function(t){var s,i,r,e=this,a=t.imgBuf
this.ctx.save(),this.dropShadow(t,1),this.worldToPixel.reset(),this.worldToPixel.applyTransform(h(1,-1)),this.worldToPixel.applyTransform(t.netTfm.matrix),this.worldToPixel.applyTransform(h(this.xscl,this.yscl)),this.worldToPixel.applyTransform(n(this.vpLLx+this.xoffset,this.vpLLy+this.yoffset)),P(this.ctx,this.worldToPixel),this.ctx.drawImage(a,t.imgLorgX,t.imgLorgY,t.width,t.height),this.ctx.restore(),t.bBoxCmds.forEach(function(i){i.parms.length&&(s=p(i.parms[0][0],i.parms[0][1],t.netTfm.matrix),i.parmsPx[0]=e.vpLLx+e.xoffset+s.x*e.xscl,i.parmsPx[1]=e.vpLLy+e.yoffset+s.y*e.yscl)}),t.border&&(this.ctx.beginPath(),t.bBoxCmds.forEach(function(t){e.ctx[t.drawFn].apply(e.ctx,t.parmsPx)}),t.lineWidthWC?this.ctx.lineWidth=t.lineWidthWC*this.xscl:this.ctx.lineWidth=t.lineWidth||this.penWid,this.ctx.strokeStyle=t.strokeCol||this.penCol,this.ctx.lineCap=t.lineCap||this.lineCap,this.ctx.stroke()),null!==t.dragNdrop&&(i=W(this),i!==t.dragNdrop.layer&&t.dragNdrop.layer&&(r=t.dragNdrop.layer.dragObjects.indexOf(this),-1!==r&&t.dragNdrop.layer.dragObjects.splice(r,1)),t.dragNdrop.cgo=this,t.dragNdrop.layer=i,t.dragNdrop.layer.dragObjects.contains(t)||t.dragNdrop.layer.dragObjects.push(t))},D.prototype.paintPath=function(t){function s(t){var s=t.grad[0],i=t.grad[1],r=t.grad[2],e=t.grad[3],n=f.ctx.createLinearGradient(s,i,r,e)
return t.colorStops.forEach(function(t){n.addColorStop(t[0],t[1])}),n}function i(t){var s=t.grad[0],i=t.grad[1],r=t.grad[2],e=t.grad[3],n=t.grad[4],a=t.grad[5],o=f.ctx.createRadialGradient(s,i,r,e,n,a)
return t.colorStops.forEach(function(t){o.addColorStop(t[0],t[1])}),o}var r,e,a,o,l,f=this,p=[],c=this.xscl
this.ctx.save(),this.dropShadow(t,1),this.worldToPixel.reset(),this.worldToPixel.applyTransform(h(this.xscl,this.yscl)),this.worldToPixel.applyTransform(n(this.vpLLx+this.xoffset,this.vpLLy+this.yoffset)),P(this.ctx,this.worldToPixel),this.ctx.beginPath(),t.drawCmds.forEach(function(t){var s=[]
t.parms.forEach(function(t){s.push(t[0],t[1])}),f.ctx[t.drawFn].apply(f.ctx,s)}),this.ctx.save(),this.worldToPixel.reset(),this.worldToPixel.applyTransform(t.netTfm.matrix),this.worldToPixel.applyTransform(h(this.xscl,this.yscl)),this.worldToPixel.applyTransform(n(this.vpLLx+this.xoffset,this.vpLLy+this.yoffset)),P(this.ctx,this.worldToPixel),"SHAPE"===t.type&&(e=t.fillCol||this.paintCol,e instanceof LinearGradient?(a=s(e),this.ctx.fillStyle=a):e instanceof RadialGradient?(a=i(e),this.ctx.fillStyle=a):this.ctx.fillStyle=e,this.ctx.fill(),this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0),("PATH"===t.type||t.border)&&(t.dashed&&(t.dashed.forEach(function(t,s){p[s]=t/c}),this.ctx.setLineDash(p),this.ctx.lineDashOffset=t.dashOffset/c),r=t.lineWidthWC?t.lineWidthWC*c:t.lineWidth/t.savScale||this.penWid/t.savScale,this.ctx.lineWidth=r/c,this.ctx.strokeStyle=t.strokeCol||this.penCol,this.ctx.lineCap=t.lineCap||this.lineCap,this.ctx.stroke()),this.ctx.restore(),this.ctx.restore(),null!==t.dragNdrop&&(t.drawCmds.forEach(function(t){t.parmsPx=[],t.parms.forEach(function(s){t.parmsPx.push(f.vpLLx+f.xoffset+s[0]*f.xscl),t.parmsPx.push(f.vpLLy+f.yoffset+s[1]*f.yscl)})}),o=W(this),o!==t.dragNdrop.layer&&t.dragNdrop.layer&&(l=t.dragNdrop.layer.dragObjects.indexOf(this),-1!==l&&t.dragNdrop.layer.dragObjects.splice(l,1)),t.dragNdrop.cgo=this,t.dragNdrop.layer=o,t.dragNdrop.layer.dragObjects.contains(t)||t.dragNdrop.layer.dragObjects.push(t))},D.prototype.applyClipMask=function(t){var s=this
this.ctx.save(),this.worldToPixel.reset(),this.worldToPixel.applyTransform(h(this.xscl,this.yscl)),this.worldToPixel.applyTransform(n(this.vpLLx+this.xoffset,this.vpLLy+this.yoffset)),P(this.ctx,this.worldToPixel),this.ctx.beginPath(),t.drawCmds.forEach(function(t){var i=[]
t.parms.forEach(function(t){i.push(t[0],t[1])}),s.ctx[t.drawFn].apply(s.ctx,i)}),this.worldToPixel.reset(),this.worldToPixel.applyTransform(t.netTfm.matrix),this.worldToPixel.applyTransform(h(this.xscl,this.yscl)),this.worldToPixel.applyTransform(n(this.vpLLx+this.xoffset,this.vpLLy+this.yoffset)),P(this.ctx,this.worldToPixel),this.ctx.clip(),this.clipCount++},D.prototype.paintText=function(t){var s,i,r,e,a,o,l,f=this
this.ctx.save(),this.dropShadow(t,1),this.worldToPixel.reset(),this.worldToPixel.applyTransform(h(1/this.xscl,1/this.yscl)),this.worldToPixel.applyTransform(t.netTfm.matrix),this.worldToPixel.applyTransform(h(this.xscl,this.yscl)),this.worldToPixel.applyTransform(n(this.vpLLx+this.xoffset,this.vpLLy+this.yoffset)),P(this.ctx,this.worldToPixel),r=t.fontWeight||this.fontWeight,e=t.fontSizeZC,a=t.fontFamily||this.fontFamily,this.ctx.font=r+" "+e+"px "+a,this.ctx.fillStyle=t.fillCol||this.paintCol,this.ctx.fillText(t.drawCmds,t.imgLorgX,t.imgLorgY),t.border&&(this.ctx.shadowOffsetX=0,this.ctx.shadowOffsetY=0,this.ctx.shadowBlur=0,i=t.lineWidthWC?t.lineWidthWC*this.xscl:t.lineWidth||this.penWid,this.ctx.lineWidth=i,this.ctx.strokeStyle=t.strokeCol||this.penCol,this.ctx.lineCap=t.lineCap||this.lineCap,this.ctx.strokeText(t.drawCmds,t.imgLorgX,t.imgLorgY)),this.ctx.restore(),t.bBoxCmds.forEach(function(i){i.parms.length&&(s=p(i.parms[0][0]/f.xscl,i.parms[0][1]/f.xscl,t.netTfm.matrix),i.parmsPx[0]=f.vpLLx+f.xoffset+s.x*f.xscl,i.parmsPx[1]=f.vpLLy+f.yoffset+s.y*f.yscl)}),null!==t.dragNdrop&&(o=W(this),o!==t.dragNdrop.layer&&t.dragNdrop.layer&&(l=t.dragNdrop.layer.dragObjects.indexOf(this),-1!==l&&t.dragNdrop.layer.dragObjects.splice(l,1)),t.dragNdrop.cgo=this,t.dragNdrop.layer=o,t.dragNdrop.layer.dragObjects.contains(t)||t.dragNdrop.layer.dragObjects.push(t))},D.prototype.drawPath=function(t,s,i,r){var e=new Obj2D(t,"PATH",r)
"number"==typeof s&&"number"==typeof i&&e.transform.translate(s,i),this.render(e)},D.prototype.drawShape=function(t,s,i,r){var e=new Obj2D(t,"SHAPE",r)
"number"==typeof s&&"number"==typeof i&&e.transform.translate(s,i),this.render(e)},D.prototype.drawText=function(t,s,i,r){var e=new Obj2D(t,"TEXT",r)
"number"==typeof s&&"number"==typeof i&&e.transform.translate(s,i),this.render(e)},D.prototype.drawImg=function(t,s,i,r){var e=new Obj2D(t,"IMG",r)
"number"==typeof s&&"number"==typeof i&&e.transform.translate(s,i),this.render(e)},D.prototype.resetClip=function(){for(;this.clipCount>0;)this.ctx.restore(),this.clipCount--},D.prototype.createLayer=function(){var t,s,i,r,e,n,a=this.rawWidth,o=this.rawHeight,h=this.bkgCanvas.layers.length
return-1!==this.cId.indexOf("_ovl_")?(console.log("canvas layers can't create layers"),""):(i=this.getUnique(),r=this.cId+"_ovl_"+i,t="<canvas id='"+r+"' style='position:absolute' width='"+a+"' height='"+o+"'></canvas>",n=this.bkgCanvas.layers[h-1].cElem,n.insertAdjacentHTML("afterend",t),s=document.getElementById(r),s.style.backgroundColor="transparent",s.style.left=this.bkgCanvas.offsetLeft+this.bkgCanvas.clientLeft+"px",s.style.top=this.bkgCanvas.offsetTop+this.bkgCanvas.clientTop+"px",s.style.width=this.bkgCanvas.offsetWidth+"px",s.style.height=this.bkgCanvas.offsetHeight+"px",e=new S(r,s),this.bkgCanvas.layers.push(e),r)},D.prototype.deleteLayer=function(t){var s,i
for(i=1;i<this.bkgCanvas.layers.length;i++)this.bkgCanvas.layers[i].id===t&&(s=this.bkgCanvas.layers[i].cElem,s&&(s.alphaOvl&&s.alphaOvl.parentNode&&s.alphaOvl.parentNode.removeChild(s.alphaOvl),s.parentNode.removeChild(s)),this.bkgCanvas.layers.splice(i,1))},D.prototype.deleteAllLayers=function(){var t,s
for(t=this.bkgCanvas.layers.length-1;t>0;t--)s=this.bkgCanvas.layers[t].cElem,s&&(s.alphaOvl&&s.alphaOvl.parentNode&&s.alphaOvl.parentNode.removeChild(s.alphaOvl),s.parentNode.removeChild(s)),this.bkgCanvas.layers.splice(t,1)},D.prototype.dupCtx=function(t){this.vpW=t.vpW,this.vpH=t.vpH,this.vpLLx=t.vpLLx,this.vpLLy=t.vpLLy,this.xscl=t.xscl,this.yscl=t.yscl,this.xoffset=t.xoffset,this.yoffset=t.yoffset,this.savWC=s(t.savWC),this.penCol=t.penCol.slice(0),this.penWid=t.penWid,this.lineCap=t.lineCap.slice(0),this.paintCol=t.paintCol.slice(0),this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this.fontFamily=t.fontFamily.slice(0)},initZoomPan=function(t,s,i){function r(t){function s(s){var i=s.toPixelCoords(0,0),r=s.rawWidth/2-i.x,e=s.rawHeight/2-i.y
s.xoffset+=r-r/t,s.yoffset+=e-e/t,s.xscl/=t,s.yscl/=t}m.forEach(s),i()}function e(t,s){function r(i){i.xoffset-=t,i.yoffset-=s}m.forEach(r),i()}function n(){function t(t){t.xscl=t.savWC.xscl,t.yscl=t.savWC.yscl,t.xoffset=t.savWC.xoffset,t.yoffset=t.savWC.yoffset}m.forEach(t),i()}var a,o,h,l,f,p,c,d,u,m,g=["m",-7,-2,"l",7,5,7,-5],y=["m",-6,-6,"l",12,12,"m",0,-12,"l",-12,12],x=["m",-7,0,"l",14,0,"m",-7,-7,"l",0,14],v=["m",-7,0,"l",14,0]
d=new D(t),d.clearCanvas(),d.setWorldCoords(-d.rawWidth+44,-d.rawHeight+44),u=new Obj2D(shapeDefs.rectangle(114,80),"SHAPE",{fillColor:"rgba(0, 50, 0, 0.12)"}),u.translate(-17,0),d.render(u),h=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),h.enableDrag(null,null,n),d.render(h),c=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),c.enableDrag(null,null,function(){e(50,0)}),c.translate(22,0),d.render(c),l=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),l.enableDrag(null,null,function(){e(0,-50)}),l.translate(0,22),d.render(l),p=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),p.enableDrag(null,null,function(){e(-50,0)}),p.translate(-22,0),d.render(p),f=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),f.enableDrag(null,null,function(){e(0,50)}),f.translate(0,-22),d.render(f),a=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),a.enableDrag(null,null,function(){r(1/1.2)}),a.translate(-56,11),d.render(a),o=new Obj2D(shapeDefs.rectangle(20,20,2),"SHAPE",{fillColor:"rgba(0,0,0,0.2)"}),o.enableDrag(null,null,function(){r(1.2)}),o.translate(-56,-11),d.render(o),d.setPropertyDefault("strokeColor","white"),d.setPropertyDefault("lineWidth",2),g=new Obj2D(["m",-7,-2,"l",7,5,7,-5],"PATH"),g.transform.translate(0,22),d.render(g),g.transform.translate(22,0),g.transform.rotate(-90),d.render(g),g.transform.translate(-22,0),g.transform.rotate(90),d.render(g),g.transform.translate(0,-22),g.transform.rotate(180),d.render(g),d.drawPath(x,-56,11),d.drawPath(v,-56,-11),d.drawPath(y),Array.isArray(s)?m=s:(m=[],m[0]=s)},svgToCgo2D=E.svg2cartesian,D}()