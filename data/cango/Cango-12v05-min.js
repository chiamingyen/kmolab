var Cango,Path,Shape,Img,Text,ClipMask,Group,DrawCmd,LinearGradient,RadialGradient,Tweener,initZoomPan,cgo2DToDrawCmds,drawCmdsToCgo2D,svgToCgo2D,shapeDefs
!function(){"use strict"
function t(t,s,i){return t.attachEvent?t.attachEvent("on"+s,i):t.addEventListener(s,i)}function s(t){var i,r
if(void 0!==t){if(null===t)return null
i=Array.isArray(t)?[]:{}
for(r in t)t[r]&&"object"==typeof t[r]?i[r]=s(t[r]):i[r]=t[r]
return i}}function i(t,s,i){var r,e,o=this
this.cgo=null,this.layer=null,this.target=null,this.grabCallback=t||null,this.dragCallback=s||null,this.dropCallback=i||null,this.grabCsrPos={x:0,y:0},this.dwgOrg={x:0,y:0},this.grabOfs={x:0,y:0},this.grab=function(t){var s,i=t||window.event
return r=this.cgo.bkgCanvas.layers.length,e=this.cgo.bkgCanvas.layers[r-1].cElem,e.onmouseup=function(t){o.drop(t)},e.onmouseout=function(t){o.drop(t)},s=this.cgo.getCursorPosWC(i),this.grabCsrPos.x=s.x,this.grabCsrPos.y=s.y,this.dwgOrg.x=this.target.dwgOrg.x,this.dwgOrg.y=this.target.dwgOrg.y,this.target.parent?this.grabOfs={x:s.x-this.dwgOrg.x+this.target.parent.dwgOrg.x,y:s.y-this.dwgOrg.y+this.target.parent.dwgOrg.y}:this.grabOfs={x:s.x-this.dwgOrg.x,y:s.y-this.dwgOrg.y},this.grabCallback&&this.grabCallback(s),e.onmousemove=function(t){o.drag(t)},i.preventDefault?i.preventDefault():window.event.returnValue=!1,!1},this.drag=function(t){var s
this.dragCallback&&(s=this.cgo.getCursorPosWC(t),window.requestAnimationFrame(function(){o.dragCallback(s)}))},this.drop=function(t){var s=this.cgo.getCursorPosWC(t)
e.onmouseup=null,e.onmouseout=null,e.onmousemove=null,this.dropCallback&&this.dropCallback(s)},this.cancelDrag=function(t){e.onmouseup=null,e.onmouseout=null,e.onmousemove=null,this.dropCallback&&this.dropCallback(t)}}function r(t,s,i){return{x:t*i.a+s*i.c+i.e,y:t*i.b+s*i.d+i.f}}function e(t){t.a=1,t.b=0,t.c=0,t.d=1,t.e=0,t.f=0}function o(t){var s=t[0]||0,i=t[1]||0
return this.hasOwnProperty("type")?void(this.ofsTfm=this.ofsTfm.translate(s,i)):{x:this.x+s,y:this.y+i}}function a(t){var s=t[0]||0,i=t[1]||0,r=Math.PI/180,e=Math.tan(-s*r),o=Math.tan(i*r)
return this.hasOwnProperty("type")?(this.ofsTfm=this.ofsTfm.skewX(s*r),void(this.ofsTfm=this.ofsTfm.skewY(i*r))):{x:this.x+this.y*e,y:this.x*o+this.y}}function n(t){var s=t[0]||1,i=t[1]||s
return this.hasOwnProperty("type")?void(this.ofsTfm=this.ofsTfm.scaleNonUniform(s,i)):{x:this.x*s,y:this.y*i}}function h(t){var s=t[0]||0,i=Math.PI/180,r=Math.sin(-s*i),e=Math.cos(-s*i)
return this.hasOwnProperty("type")?void(this.ofsTfm=this.ofsTfm.rotate(s)):{x:this.x*e+this.y*r,y:-this.x*r+this.y*e}}function l(t){var s=t[0]||0,i=Math.PI/180,r=Math.sin(-s*i),e=Math.cos(-s*i)
return this.hasOwnProperty("type")?void(this.ofsTfm=this.ofsTfm.rotate(s*i)):{x:this.x*e+this.y*r,y:-this.x*r+this.y*e}}function c(t,s){var i=Array.prototype.slice.call(arguments).slice(2)
this.type=t,this.distortFn=s,this.args=i}function d(t){var s=this
this.parent=t,this.translate=function(t,i){var r=new c("TRN",o,t,i)
s.parent.ofsTfmAry.unshift(r)},this.scale=function(t,i){var r=new c("SCL",n,t,i)
s.parent.ofsTfmAry.push(r)},this.rotate=function(t){var i=new c("ROT",h,t)
s.parent.ofsTfmAry.push(i)},this.skew=function(t,i){var r=new c("SKW",a,t,i)
s.parent.ofsTfmAry.push(r)},this.revolve=function(t){var i=new c("REV",l,t)
s.parent.ofsTfmAry.unshift(i)},this.reset=function(){s.parent.ofsTfmAry=[],e(s.parent.ofsTfm)}}function f(t){var s=this
s.parent=t,this.translate=function(t,i){var r=new c("TRN",o,t,i)
s.parent.hardTfmAry.unshift(r)},this.scale=function(t,i){var r=new c("SCL",n,t,i)
s.parent.hardTfmAry.unshift(r)},this.rotate=function(t){var i=new c("ROT",h,t)
s.parent.hardTfmAry.unshift(i)},this.skew=function(t,i){var r=new c("SKW",a,t,i)
s.parent.hardTfmAry.unshift(r)},this.reset=function(){s.parent.hardTfmAry=[]}}function p(t,s){var i=[1,2,3,4,5,6,7,8,9]
if("string"==typeof t&&void 0!==s)switch(t.toLowerCase()){case"fillcolor":this.fillCol=s
break
case"strokecolor":this.strokeCol=s
break
case"linewidth":case"strokewidth":"number"==typeof s&&s>0&&(this.lineWidth=s)
break
case"linewidthwc":"number"==typeof s&&s>0&&(this.lineWidthWC=s)
break
case"linecap":if("string"!=typeof s)return;("butt"===s||"round"===s||"square"===s)&&(this.lineCap=s)
break
case"iso":case"isotropic":1==s||"iso"===s||"isotropic"===s?this.iso=!0:this.iso=!1
break
case"dashed":Array.isArray(s)&&s[0]?this.dashed=s:this.dashed=[]
break
case"dashoffset":this.dashOffset=s||0
break
case"border":s===!0&&(this.border=!0),s===!1&&(this.border=!1)
break
case"fontsize":"number"==typeof s&&s>0&&(this.fontSize=s)
break
case"fontweight":("string"==typeof s||"number"==typeof s&&s>=100&&900>=s)&&(this.fontWeight=s)
break
case"fontfamily":"string"==typeof s&&(this.fontFamily=s)
break
case"bgfillcolor":this.bgFillColor=s
break
case"imgwidth":this.width=Math.abs(s)
break
case"imgheight":this.height=Math.abs(s)
break
case"lorg":-1!==i.indexOf(s)&&(this.lorg=s)
break
case"shadowoffsetx":this.shadowOffsetX=s||0
break
case"shadowoffsety":this.shadowOffsetY=s||0
break
case"shadowblur":this.shadowBlur=s||0
break
case"shadowcolor":this.shadowColor=s
break
default:return}}function u(t,s){void 0===s?t.setTransform(1,0,0,0,1,0):t.setTransform(s.matrix[0][0],s.matrix[0][1],s.matrix[1][0],s.matrix[1][1],s.matrix[2][0],s.matrix[2][1])}function g(t,s,i,r,e,o){var a
this.id=t,this.gc=s,this.drawFn=r,this.pathFn=e,this.options=o,this.currState={time:0},this.nextState={time:0},this.gc.ctx.save(),"function"==typeof i&&i.call(this,this.options),"function"==typeof this.drawFn?this.drawFn.call(this,this.options):console.log("invalid animation draw function"),this.gc.ctx.restore()
for(a in this.nextState)this.nextState.hasOwnProperty(a)&&(this.currState[a]=this.nextState[a])}function y(t){var s,i,r=null,e=!1,o=Date.now()
t.prevAnimMode===t.modes.STOPPED&&(t.startTime=o-t.startOfs),s=o-t.startTime,t.animTasks.forEach(function(o){o.gc.cId!==r&&(e=!0,r=o.gc.cId),o.gc.ctx.save(),t.prevAnimMode===t.modes.STOPPED&&(o.currState.time=0),e&&o.gc.clearCanvas(),"function"==typeof o.pathFn&&o.pathFn.call(o,s,o.options),"function"==typeof o.drawFn&&o.drawFn.call(o,o.options),e=!1,o.gc.ctx.restore(),i=o.currState,o.currState=o.nextState,o.nextState=i,o.currState.time=s}),t.currTime=s}function m(){this.animTasks=[],this.timer=null,this.modes={PAUSED:1,STOPPED:2,PLAYING:3,STEPPING:4},this.animMode=this.modes.STOPPED,this.prevAnimMode=this.modes.STOPPED,this.startTime=0,this.startOfs=0,this.currTime=0,this.stepTime=50}function C(t,s){this.id=t,this.cElem=s,this.dragObjects=[]}function v(t){var s,i=t.bkgCanvas.layers[0]
for(s=1;s<t.bkgCanvas.layers.length;s++)if(t.bkgCanvas.layers[s].id===t.cId){i=t.bkgCanvas.layers[s]
break}return i}function x(t){function s(s){function i(s){var i=t.cnvs.getBoundingClientRect()
return{x:s.clientX-i.left,y:s.clientY-i.top}}function r(t,s,i){var r,e=t.dragNdrop.cgo,o=e.yDown?e.xscl:-e.xscl,a=A.translate(e.vpOrgX+e.xoffset,e.vpOrgY+e.yoffset).scaleNonUniform(e.xscl,o).multiply(t.netTfm)
return"IMG"!==t.type||e.yDown?"TEXT"===t.type&&(a=a.scaleNonUniform(1/e.xscl,1/o)):a=a.flipY(),e.ctx.save(),e.ctx.setTransform(a.a,a.b,a.c,a.d,a.e,a.f),e.ctx.beginPath(),t.drawCmds.forEach(function(t){var s=[]
t.parmsWC.forEach(function(t){s.push(t[0],t[1])}),e.ctx[t.drawFn].apply(e.ctx,s)}),r=e.ctx.isPointInPath(s,i),e.ctx.restore(),r}var e,o,a,n,h,l,c=s||window.event
e=i(c),a=t.bkgCanvas.layers.length
t:for(h=a-1;h>=0;h--)for(n=t.bkgCanvas.layers[h],l=n.dragObjects.length-1;l>=0;l--)if(o=n.dragObjects[l],r(o,e.x,e.y)&&o.dragNdrop){o.dragNdrop.grab(c)
break t}}t.cnvs.onmousedown=s}var w,b,T,O=0,A=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()
return Date.now||(Date.now=function(){return(new Date).getTime()}),Array.prototype.contains||(Array.prototype.contains=function(t){return this.indexOf(t)>-1}),DrawCmd=function(t,s){var i
for(this.drawFn=t,this.parmsWC=[],i=0;i<s.length;i+=2)this.parmsWC.push(s.slice(i,i+2))},b=function(){function t(t,s,i){return 0===i&&"string"!=typeof s&&t.push("M"),"string"==typeof s&&(p.hasOwnProperty(s.toUpperCase())||(console.log("unknown command string '"+s+"'"),t.badCmdFound=!0,t.length=0)),t.badCmdFound||t.push(s),t}function s(t,s,i,r){var e
if(0===i&&(t.nextCmdPos=0),"string"==typeof s){if(i<t.nextCmdPos)return console.log("bad number of parameters for '"+s+"' at index "+i),t.badParameter=!0,t.push(0),t
t.currCmd=s.toUpperCase(),t.uc=s.toUpperCase()===s,t.nextCmdPos=i+p[t.currCmd].parmCount+1,t.push(s)}else i<t.nextCmdPos?t.push(s):(t.currCmd=p[t.currCmd].extCmd,e=t.uc?t.currCmd:t.currCmd.toLowerCase(),t.push(e,s),t.nextCmdPos=i+p[t.currCmd].parmCount)
return i===r.length-1&&t.badParameter&&(t.length=0),t}function i(t,s){return"string"==typeof s&&t.push([]),t[t.length-1].push(s),t}function r(t,s,i){var r,e
return void 0===t.px&&(t.px=0,t.py=0),r=p[s[0].toUpperCase()],e=r.toAbs(t,s,i),t.push(e),t}function e(t,s,i){var r=s[0],e=p[r]
return e.toCangoVersion(t,s,i),t}function o(t){var s=t[0],i=t.slice(1)
return new DrawCmd(p[s].canvasMethod,i)}function a(t,s){var i,r
return i=s.match(/([a-z]+|-?[.\d]*\d)/gi),t.push(i[0]),r=i.slice(1),r&&r.forEach(function(s){var i=parseFloat(s)
isNaN(i)||t.push(i)}),t}function n(t){var s=t[0],i=p[s]
return i.invertCoords(t)}function h(t){var s=t[0],i=p[s],r=this.xOfs||0,e=this.yOfs||0
return i.addXYoffset(t,r,e)}function l(t,s){return t.concat(s)}function c(t,s){var i={moveTo:"M",lineTo:"L",bezierCurveTo:"C",quadraticCurveTo:"Q",closePath:"Z"}
return t.push(i[s.drawFn]),s.parmsWC.forEach(function(s){s.forEach(function(s){t.push(s)})}),t}var d=function(t,s,i,r,e,o,a,n){var h=n*e,l=-a*o,c=a*e,d=n*o,f=.5*(r-i),p=8/3*Math.sin(.5*f)*Math.sin(.5*f)/Math.sin(f),u=t+Math.cos(i)-p*Math.sin(i),g=s+Math.sin(i)+p*Math.cos(i),y=t+Math.cos(r),m=s+Math.sin(r),C=y+p*Math.sin(r),v=m-p*Math.cos(r)
return[h*u+l*g,c*u+d*g,h*C+l*v,c*C+d*v,h*y+l*m,c*y+d*m]},f=function(t,s,i,r,e,o,a,n,h){function l(t){return Math.abs(t)<1e-5?0:t}var c,f,p,u,g,y,m,C,v,x,w,b,T,O,A,k,W,P,S,M,D,N,E=e*(Math.PI/180),L=Math.sin(E),G=Math.cos(E),Y=Math.abs(i),X=Math.abs(r),I=G*(t-n)*.5+L*(s-h)*.5,F=G*(s-h)*.5-L*(t-n)*.5,H=I*I/(Y*Y)+F*F/(X*X),R=[]
for(H>1&&(H=Math.sqrt(H),Y*=H,X*=H),c=G/Y,f=L/Y,p=-L/X,u=G/X,g=c*t+f*s,y=p*t+u*s,m=c*n+f*h,C=p*n+u*h,v=(m-g)*(m-g)+(C-y)*(C-y),x=1/v-.25,0>x&&(x=0),w=Math.sqrt(x),a===o&&(w=-w),b=.5*(g+m)-w*(C-y),T=.5*(y+C)+w*(m-g),O=Math.atan2(y-T,g-b),A=Math.atan2(C-T,m-b),k=A-O,0>k&&1===a?k+=2*Math.PI:k>0&&0===a&&(k-=2*Math.PI),W=Math.ceil(Math.abs(k/(.5*Math.PI+.001))),M=0;W>M;M++)D=O+M*k/W,N=O+(M+1)*k/W,P=d(b,T,D,N,Y,X,L,G),S=P.map(l),R.push(S)
return R},p={M:{canvasMethod:"moveTo",parmCount:2,extCmd:"L",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2]
return r!==s[0]&&(e+=t.px,o+=t.py),i=[r,e,o],t.px=e,t.py=o,i},toCangoVersion:function(t,s){var i=s[1],r=s[2]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2]
return r+=s,e+=i,["M",r,e]},invertCoords:function(t){var s=t[1],i=t[2]
return["M",s,-i]}},L:{canvasMethod:"lineTo",parmCount:2,extCmd:"L",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2]
return r!==s[0]&&(e+=t.px,o+=t.py),i=[r,e,o],t.px=e,t.py=o,i},toCangoVersion:function(t,s){var i=s[1],r=s[2]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2]
return r+=s,e+=i,["L",r,e]},invertCoords:function(t){var s=t[1],i=t[2]
return["L",s,-i]}},H:{parmCount:1,extCmd:"H",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1]
return r!==s[0]&&(e+=t.px),i=[r,e],t.px=e,i},toCangoVersion:function(t,s){var i=s[1],r=t.py,e=["L",i,r]
t.px=i,t.push(e)},addXYoffset:function(t,s,i){var r=t[1]
return r+=s,["H",r]},invertCoords:function(t){var s=t[1]
return["H",s]}},V:{parmCount:1,extCmd:"V",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1]
return r!==s[0]&&(e+=t.py),i=[r,e],t.py=e,i},toCangoVersion:function(t,s){var i=t.px,r=s[1],e=["L",i,r]
t.py=r,t.push(e)},addXYoffset:function(t,s,i){var r=t[1]
return r+=i,["V",r]},invertCoords:function(t){var s=t[1]
return["V",-s]}},C:{canvasMethod:"bezierCurveTo",parmCount:6,extCmd:"C",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2],a=s[3],n=s[4],h=s[5],l=s[6]
return r!==s[0]&&(e+=t.px,o+=t.py,a+=t.px,n+=t.py,h+=t.px,l+=t.py),i=[r,e,o,a,n,h,l],t.px=h,t.py=l,i},toCangoVersion:function(t,s){var i=s[5],r=s[6]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2],o=t[3],a=t[4],n=t[5],h=t[6]
return r+=s,e+=i,o+=s,a+=i,n+=s,h+=i,["C",r,e,o,a,n,h]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4],o=t[5],a=t[6]
return["C",s,-i,r,-e,o,-a]}},S:{parmCount:4,extCmd:"S",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2],a=s[3],n=s[4]
return r!==s[0]&&(e+=t.px,o+=t.py,a+=t.px,n+=t.py),i=[r,e,o,a,n],t.px=a,t.py=n,i},toCangoVersion:function(t,s,i){var r,e=0,o=0,a=s[1],n=s[2],h=s[3],l=s[4],c=t[i-1]
"C"===c[0]&&(e=t.px-c[c.length-4],o=t.py-c[c.length-3]),e+=t.px,o+=t.py,r=["C",e,o,a,n,h,l],t.px=h,t.py=l,t.push(r)},addXYoffset:function(t,s,i){var r=t[1],e=t[2],o=t[3],a=t[4]
return r+=s,e+=i,o+=s,a+=i,["S",r,e,o,a]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4]
return["S",s,-i,r,-e]}},Q:{canvasMethod:"quadraticCurveTo",parmCount:4,extCmd:"Q",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2],a=s[3],n=s[4]
return r!==s[0]&&(e+=t.px,o+=t.py,a+=t.px,n+=t.py),i=[r,e,o,a,n],t.px=a,t.py=n,i},toCangoVersion:function(t,s){var i=s[3],r=s[4]
t.px=i,t.py=r,t.push(s)},addXYoffset:function(t,s,i){var r=t[1],e=t[2],o=t[3],a=t[4]
return r+=s,e+=i,o+=s,a+=i,["Q",r,e,o,a]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4]
return["Q",s,-i,r,-e]}},T:{parmCount:2,extCmd:"T",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2]
return r!==s[0]&&(e+=t.px,o+=t.py),i=[r,e,o],t.px=e,t.py=o,i},toCangoVersion:function(t,s,i){var r,e=0,o=0,a=s[1],n=s[2],h=t[i-1]
"Q"===h[0]&&(e=t.px-h[h.length-4],o=t.py-h[h.length-3]),e+=t.px,o+=t.py,r=["Q",e,o,a,n],t.px=a,t.py=n,t.push(r)},addXYoffset:function(t,s,i){var r=t[1],e=t[2]
return r+=s,e+=i,["T",r,e]},invertCoords:function(t){var s=t[1],i=t[2]
return["T",s,-i]}},A:{parmCount:7,extCmd:"A",toAbs:function(t,s){var i,r=s[0].toUpperCase(),e=s[1],o=s[2],a=s[3],n=s[4],h=s[5],l=s[6],c=s[7]
return r!==s[0]&&(l+=t.px,c+=t.py),i=[r,e,o,a,n,h,l,c],t.px=l,t.py=c,i},toCangoVersion:function(t,s){var i,r=s[1],e=s[2],o=s[3],a=s[4],n=s[5],h=s[6],l=s[7]
i=f(t.px,t.py,r,e,o,a,n,h,l),i.forEach(function(s){t.push(["C"].concat(s))}),t.px=h,t.py=l},addXYoffset:function(t,s,i){var r=t[1],e=t[2],o=t[3],a=t[4],n=t[5],h=t[6],l=t[7]
return h+=s,l+=i,["A",r,e,o,a,n,h,l]},invertCoords:function(t){var s=t[1],i=t[2],r=t[3],e=t[4],o=t[5],a=t[6],n=t[7]
return["A",s,i,-r,e,1-o,a,-n]}},Z:{canvasMethod:"closePath",parmCount:0,toAbs:function(t,s){var i=s[0].toUpperCase(),r=[i]
return r},toCangoVersion:function(t,s){t.push(s)},addXYoffset:function(t,s,i){return["Z"]},invertCoords:function(t){return["Z"]}}}
return{svg2cgo2D:function(e,o,c){var d,f,p=o||0,u=c||0
return"string"!=typeof e||0===e.length?[]:(d=e.replace(/([zZ])(?=.)/g,"$1 "),f=d.match(/([a-df-z]+[-.,\d ]*)/gi),f.reduce(a,[]).reduce(t,[]).reduce(s,[]).reduce(i,[]).reduce(r,[]).map(h,{xOfs:p,yOfs:u}).map(n).reduce(l,[]))},drawcmds2cgo:function(t){return t.reduce(c,[])},cgo2drawcmds:function(a){return Array.isArray(a)&&0!==a.length?a.reduce(t,[]).reduce(s,[]).reduce(i,[]).reduce(r,[]).reduce(e,[]).map(o):[]},svg2drawcmds:function(n){var h,l,c
return"string"!=typeof n||0===n.length?"":(h=n.replace(RegExp(",","g")," "),l=h.split(/(?=[a-df-z])/i),c=l.reduce(a,[]).reduce(t,[]).reduce(s,[]).reduce(i,[]).reduce(r,[]).reduce(e,[]).map(o))}}}(),T=b.svg2drawcmds,cgo2DToDrawCmds=b.cgo2drawcmds,drawCmdsToCgo2D=b.drawcmds2cgo,svgToCgo2D=b.svg2cgo2D,void 0===shapeDefs&&(shapeDefs={circle:function(t){var s=t||1
return["m",-.5*s,0,"c",0,-.27614*s,.22386*s,-.5*s,.5*s,-.5*s,"c",.27614*s,0,.5*s,.22386*s,.5*s,.5*s,"c",0,.27614*s,-.22386*s,.5*s,-.5*s,.5*s,"c",-.27614*s,0,-.5*s,-.22386*s,-.5*s,-.5*s,"z"]},ellipse:function(t,s){var i=t||1,r=i
return"number"==typeof s&&s>0&&(r=s),["m",-.5*i,0,"c",0,-.27614*r,.22386*i,-.5*r,.5*i,-.5*r,"c",.27614*i,0,.5*i,.22386*r,.5*i,.5*r,"c",0,.27614*r,-.22386*i,.5*r,-.5*i,.5*r,"c",-.27614*i,0,-.5*i,-.22386*r,-.5*i,-.5*r,"z"]},square:function(t){var s=t||1
return["m",.5*s,-.5*s,"l",0,s,-s,0,0,-s,"z"]},rectangle:function(t,s,i){var r,e=t||1,o=s||e
return void 0===i||0>=i?["m",-e/2,-o/2,"l",e,0,0,o,-e,0,"z"]:(r=Math.min(e/2,o/2,i),["m",-e/2+r,-o/2,"l",e-2*r,0,"a",r,r,0,0,1,r,r,"l",0,o-2*r,"a",r,r,0,0,1,-r,r,"l",-e+2*r,0,"a",r,r,0,0,1,-r,-r,"l",0,-o+2*r,"a",r,r,0,0,1,r,-r,"z"])},triangle:function(t){var s=t||1
return["m",.5*s,-.289*s,"l",-.5*s,.866*s,-.5*s,-.866*s,"z"]},cross:function(t){var s=t||1
return["m",-.5*s,0,"l",s,0,"m",-.5*s,-.5*s,"l",0,s]},ex:function(t){var s=t||1
return["m",-.3535*s,-.3535*s,"l",.707*s,.707*s,"m",-.707*s,0,"l",.707*s,-.707*s]}}),LinearGradient=function(t,s,i,r){this.grad=[t,s,i,r],this.colorStops=[],this.addColorStop=function(){this.colorStops.push(arguments)}},RadialGradient=function(t,s,i,r,e,o){this.grad=[t,s,i,r,e,o],this.colorStops=[],this.addColorStop=function(){this.colorStops.push(arguments)}},Tweener=function(t,s,i){this.delay=t||0,this.dur=s||5e3,this.reStartOfs=0,this.loop=!1,this.loopAll=!1
var r=this,e="noloop"
"string"==typeof i&&(e=i.toLowerCase()),"loop"===e?this.loop=!0:"loopall"===e&&(this.loopAll=!0),this.getVal=function(t,s,i){var e,o,a,n,h,l,c,d,f,p=0
if(0===t&&(r.reStartOfs=0),c=t-r.reStartOfs,c>r.dur+r.delay&&r.dur>0&&(r.loop||r.loopAll)&&(r.reStartOfs=r.loop?t-r.delay:t,c=0),p=0,c>r.delay&&(p=c-r.delay),!Array.isArray(s))return s
if(!s.length)return 0
if(1===s.length)return s[0]
if(0===p)return s[0]
if(p>=r.dur)return s[s.length-1]
if(e=s.length-1,!Array.isArray(i)||s.length!==i.length)return o=r.dur/e,a=Math.floor(p/o),n=(p-a*o)/o,s[a]+n*(s[a+1]-s[a])
for(d=[].concat(s),f=[].concat(i),0!==f[0]&&(d.unshift(d[0]),f.unshift(0)),100!==f[f.length-1]&&(d.push(d[d.length-1]),f.push(100)),h=0,l=p/r.dur;h<f.length-1&&f[h+1]/100<l;)h++
return o=(f[h+1]-f[h])/100,n=(l-f[h]/100)/o,d[h]+n*(d[h+1]-d[h])}},Group=function(){this.type="GRP",this.parent=null,this.children=[],this.ofsTfmAry=[],this.netTfmAry=[],this.ofsTfm=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),this.netTfm=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),this.transform=new d(this),this.dragNdropHandlers=null,this.addObj.apply(this,arguments)},Group.prototype.deleteObj=function(t){var s=this.children.indexOf(t)
s>=0&&(this.children.splice(s,1),t.parent=null)},Group.prototype.addObj=function(){var t,s,i=Array.prototype.slice.call(arguments)
for(t=0;t<i.length;t++)if(Array.isArray(i[t]))for(s=0;s<i[t].length;s++)i[t][s].type&&(i[t][s].parent=this,this.children.push(i[t][s]),!i[t][s].dragNdrop&&this.dragNdropHandlers&&(i[t][s].enableDrag.apply(i[t][s],this.dragNdropHandlers),i[t][s].dragNdrop.target=this))
else i[t]&&i[t].type&&(i[t].parent=this,this.children.push(i[t]),!i[t].dragNdrop&&this.dragNdropHandlers&&(i[t].enableDrag.apply(i[t],this.dragNdropHandlers),i[t].dragNdrop.target=this))},Group.prototype.translate=function(t,s){function i(r){r.children.forEach(function(r){"GRP"===r.type?i(r):r.translate(t,s)})}i(this)},Group.prototype.rotate=function(t){function s(i){i.children.forEach(function(i){"GRP"===i.type?s(i):i.rotate(t)})}s(this)},Group.prototype.skew=function(t,s){function i(r){r.children.forEach(function(r){"GRP"===r.type?i(r):r.skew(t,s)})}i(this)},Group.prototype.scale=function(t,s){function i(t){t.children.forEach(function(t){"GRP"===t.type?i(t):t.scale(r,e)})}var r=t,e=s||r
i(this)},Group.prototype.enableDrag=function(t,s,i){function r(o){o.children.forEach(function(o){"GRP"===o.type?r(o):null===o.dragNdrop&&(o.enableDrag(t,s,i),o.dragNdrop.target=e)})}var e=this
this.dragNdropHandlers=arguments,r(this)},Group.prototype.disableDrag=function(){function t(s){s.children.forEach(function(s){"GRP"===s.type?t(s):s.disableDrag()})}this.dragNdropHandlers=void 0,t(this)},w=function(){this.type="OBJ2D",this.cmdsAry=null,this.drawCmds=null,this.lineWidthWC=null,this.lineWidth=null,this.savScale=1,this.iso=!0,this.parent=null,this.dwgOrg={x:0,y:0},this.hardTfmAry=[],this.ofsTfmAry=[],this.netTfmAry=[],this.ofsTfm=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),this.netTfm=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix(),this.hardTransform=new f(this),this.transform=new d(this),this.dragNdrop=null},w.prototype.enableDrag=function(t,s,r){this.dragNdrop=new i(t,s,r),this.dragNdrop.target=this},w.prototype.disableDrag=function(){var t
this.dragNdrop&&(t=this.dragNdrop.layer.dragObjects.indexOf(this),this.dragNdrop.layer.dragObjects.splice(t,1),this.dragNdrop=null)},ClipMask=function(t,s){var i=s||{}
w.call(this),this.type="CLIP",this.iso=!1,t?("string"==typeof t?this.cmdsAry=svgToCgo2D(t):Array.isArray(t)&&(this.cmdsAry=t),"number"==typeof this.cmdsAry[0]&&this.cmdsAry.splice(0,0,"M"),this.drawCmds=cgo2DToDrawCmds(this.cmdsAry)):(this.cmdsAry=[],this.drawCmds=[]),i.hasOwnProperty("iso")?this.setProperty("iso",i.iso):i.hasOwnProperty("isotropic")?this.setProperty("isotropic",i.isotropic):this.iso=!1},ClipMask.prototype=Object.create(w.prototype),ClipMask.prototype.constructor=ClipMask,ClipMask.prototype.setProperty=p,ClipMask.prototype.appendPath=function(t,i){var o,a,n=this,h=!0
o=this.drawCmds?s(this.drawCmds):cgo2DToDrawCmds(this.cmdsAry),a=t.drawCmds?s(t.drawCmds):cgo2DToDrawCmds(t.cmdsAry),this.hardTfmAry.length&&(this.hardTfmAry.forEach(function(t){t.distortFn.call(n,t.args)}),o.forEach(function(t){t.parmsWC.length&&(t.parmsWC=t.parmsWC.map(function(t){var s=r(t[0],t[1],n.ofsTfm)
return[s.x,s.y]}))}),e(this.ofsTfm),this.hardTfmAry.length=0),t.hardTfmAry.length&&(t.hardTfmAry.forEach(function(s){s.distortFn.call(t,s.args)}),a.forEach(function(s){s.parmsWC.length&&(s.parmsWC=s.parmsWC.map(function(s){var i=r(s[0],s[1],t.ofsTfm)
return[i.x,i.y]}))}),e(t.ofsTfm)),h=o.length&&"closePath"!==o[o.length-1].drawFn,i&&h?this.drawCmds=o.concat(a.slice(1)):i&&!h?(o.splice(-1,1),this.drawCmds=o.concat(a.slice(1))):this.drawCmds=o.concat(a)},ClipMask.prototype.translate=function(t,s){this.hardTransform.translate(t,s)},ClipMask.prototype.rotate=function(t){this.hardTransform.rotate(t)},ClipMask.prototype.skew=function(t,s){this.hardTransform.skew(t,s)},ClipMask.prototype.scale=function(t,s){this.hardTransform.scale(t,s)},ClipMask.prototype.dup=function(){var t=new ClipMask
return t.type=this.type,t.cmdsAry=s(this.cmdsAry),t.drawCmds=s(this.drawCmds),t.parent=null,t.dwgOrg=s(this.dwgOrg),t.hardTfmAry=s(this.hardTfmAry),t.ofsTfmAry=s(this.ofsTfmAry),t.border=this.border,t.strokeCol=this.strokeCol,t.lineWidth=this.lineWidth,t.lineWidthWC=this.lineWidthWC,t.lineCap=this.lineCap,t.iso=this.iso,t},Path=function(t,s){var i,r
ClipMask.call(this,t),this.type="PATH",this.border=!1,this.strokeCol=null,this.fillCol=null,this.lineCap=null,this.iso=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#000000",this.dashed=[],this.dashOffset=0,i="object"==typeof s?s:{}
for(r in i)i.hasOwnProperty(r)&&this.setProperty(r,i[r])},Path.prototype=Object.create(ClipMask.prototype),Path.prototype.constructor=Path,Path.prototype.setProperty=p,Path.prototype.revWinding=function(){function t(t){return t.reduceRight(function(t,s){return t.push(s[0],s[1]),t},[])}var s,i,r,e,o,a,n=null,h=[]
for(s=this.drawCmds?this.drawCmds:cgo2DToDrawCmds(this.cmdsAry),"closePath"===s[s.length-1].drawFn?(i=s.slice(0,-1),n=s[s.length-1]):i=s.slice(0),r=i.length-1,e=i[r].parmsWC.length,a=new DrawCmd("moveTo",i[r].parmsWC[e-1]),h.push(a),i[r].parmsWC=i[r].parmsWC.slice(0,-1);r>0;)o=t(i[r].parmsWC),e=i[r-1].parmsWC.length,o=o.concat(i[r-1].parmsWC[e-1]),a=new DrawCmd(i[r].drawFn,o),h.push(a),i[r-1].parmsWC=i[r-1].parmsWC.slice(0,-1),r--
n&&h.push(n),this.drawCmds=h},Path.prototype.dup=function(){var t=new Path
return t.type=this.type,t.cmdsAry=s(this.cmdsAry),t.drawCmds=s(this.drawCmds),t.parent=null,t.dwgOrg=s(this.dwgOrg),t.hardTfmAry=s(this.hardTfmAry),t.ofsTfmAry=s(this.ofsTfmAry),t.border=this.border,t.strokeCol=this.strokeCol,t.fillCol=this.fillCol,t.lineWidth=this.lineWidth,t.lineWidthWC=this.lineWidthWC,t.lineCap=this.lineCap,t.savScale=1,t.iso=this.iso,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur,t.shadowColor=this.shadowColor,t.dashed=s(this.dashed),t.dashOffset=this.dashOffset,t},Shape=function(t,s){var i=s||{}
Path.call(this,t,s),this.type="SHAPE",i.hasOwnProperty("iso")?this.setProperty("iso",i.iso):i.hasOwnProperty("isotropic")?this.setProperty("isotropic",i.isotropic):this.iso=!0},Shape.prototype=Object.create(Path.prototype),Shape.prototype.constructor=Shape,Img=function(t,s){var i,r
w.call(this),this.type="IMG","string"==typeof t?(this.imgBuf=new Image,this.imgBuf.src=t):t instanceof Image&&(this.imgBuf=t),this.cmdsAry=null,this.drawCmds=null,this.width=0,this.height=0,this.imgLorgX=0,this.imgLorgY=0,this.lorg=1,this.border=!1,this.strokeCol=null,this.lineWidthWC=null,this.lineWidth=null,this.lineCap=null,this.savScale=1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#000000",i="object"==typeof s?s:{}
for(r in i)i.hasOwnProperty(r)&&this.setProperty(r,i[r])},Img.prototype=Object.create(w.prototype),Img.prototype.constructor=Img,Img.prototype.setProperty=p,Img.prototype.translate=function(t,s){this.hardTransform.translate(t,s)},Img.prototype.rotate=function(t){this.hardTransform.rotate(t)},Img.prototype.skew=function(t,s){this.hardTransform.skew(t,s)},Img.prototype.scale=function(t,s){this.hardTransform.scale(t,s)},Img.prototype.dup=function(){var t=new Img
return t.type=this.type,t.cmdsAry=s(this.cmdsAry),t.drawCmds=s(this.drawCmds),t.imgBuf=this.imgBuf,t.dwgOrg=s(this.dwgOrg),t.dragNdrop=null,t.hardTfmAry=s(this.hardTfmAry),t.ofsTfmAry=s(this.ofsTfmAry),t.border=this.border,t.strokeCol=this.strokeCol,t.lineWidth=this.lineWidth,t.lineWidthWC=this.lineWidthWC,t.lineCap=this.lineCap,t.savScale=1,t.iso=this.iso,t.dashed=s(this.dashed),t.dashOffset=this.dashOffset,t.width=this.width,t.height=this.height,t.imgLorgX=this.imgLorgX,t.imgLorgY=this.imgLorgY,t.lorg=this.lorg,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur,t.shadowColor=this.shadowColor,t},Img.prototype.formatImg=function(){var t,s,i,r,e,o,a,n,h,l,c,d,f,p=0,u=0
this.imgBuf.width||console.log("in image onload handler yet image NOT loaded!"),this.width&&this.height?(t=this.width,s=this.height):this.width&&!this.height?(t=this.width,s=t*this.imgBuf.height/this.imgBuf.width):this.height&&!this.width?(s=this.height,t=s*this.imgBuf.width/this.imgBuf.height):(t=this.imgBuf.width,s=this.iso?t*this.imgBuf.height/this.imgBuf.width:this.imgBuf.height),i=t/2,r=s/2,f=[0,[0,0],[i,0],[t,0],[0,r],[i,r],[t,r],[0,s],[i,s],[t,s]],void 0!==f[this.lorg]&&(p=-f[this.lorg][0],u=-f[this.lorg][1]),this.imgLorgX=p,this.imgLorgY=u,this.width=t,this.height=s,e=p,o=u,a=p,n=u+s,h=p+t,l=u+s,c=p+t,d=u,this.cmdsAry=["M",e,o,"L",a,n,"L",h,l,"L",c,d,"Z"],this.drawCmds=cgo2DToDrawCmds(this.cmdsAry)},Text=function(t,s){var i,r
w.call(this),this.type="TEXT",this.txtStr=t,this.cmdsAry=null,this.drawCmds=null,this.width=0,this.height=0,this.imgLorgX=0,this.imgLorgY=0,this.lorg=1,this.border=!1,this.fillCol=null,this.bgFillColor=null,this.strokeCol=null,this.fontSize=null,this.fontSizeZC=null,this.fontWeight=null,this.fontFamily=null,this.lineWidthWC=null,this.lineWidth=null,this.lineCap=null,this.savScale=1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0,this.shadowColor="#000000",i="object"==typeof s?s:{}
for(r in i)i.hasOwnProperty(r)&&this.setProperty(r,i[r])},Text.prototype=Object.create(w.prototype),Text.prototype.constructor=Text,Text.prototype.setProperty=p,Text.prototype.translate=function(t,s){this.hardTransform.translate(t,s)},Text.prototype.rotate=function(t){this.hardTransform.rotate(t)},Text.prototype.skew=function(t,s){this.hardTransform.skew(t,s)},Text.prototype.scale=function(t,s){this.hardTransform.scale(t,s)},Text.prototype.dup=function(){var t=new Text
return t.type=this.type,t.txtStr=this.txtStr.slice(0),t.cmdsAry=s(this.cmdsAry),t.drawCmds=s(this.drawCmds),t.imgBuf=this.imgBuf,t.dwgOrg=s(this.dwgOrg),t.hardTfmAry=s(this.hardTfmAry),t.ofsTfmAry=s(this.ofsTfmAry),t.border=this.border,t.strokeCol=this.strokeCol,t.fillCol=this.fillCol,t.bgFillColor=this.bgFillColor,t.lineWidth=this.lineWidth,t.lineWidthWC=this.lineWidthWC,t.lineCap=this.lineCap,t.savScale=1,t.dashed=s(this.dashed),t.dashOffset=this.dashOffset,t.width=this.width,t.height=this.height,t.imgLorgX=this.imgLorgX,t.imgLorgY=this.imgLorgY,t.lorg=this.lorg,t.fontSize=this.fontSize,t.fontWeight=this.fontWeight,t.fontFamily=this.fontFamily,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur,t.shadowColor=this.shadowColor,t},Text.prototype.formatText=function(t){var s,i,r,e,o,a,n,h,l,c,d,f,p,g,y=this.fontSize||t.fontSize,m=this.fontFamily||t.fontFamily,C=this.fontWeight||t.fontWeight,v=this.lorg||1,x=0,w=0
this.orgXscl||(this.orgXscl=t.xscl),g=t.xscl/this.orgXscl,this.fontSizeZC=y*g,t.ctx.save(),u(t.ctx),t.ctx.font=C+" "+y+"px "+m,s=t.ctx.measureText(this.txtStr).width,t.ctx.restore(),s*=g,i=y,i*=g,r=s/2,e=i/2,o=[0,[0,i],[r,i],[s,i],[0,e],[r,e],[s,e],[0,0],[r,0],[s,0]],void 0!==o[v]&&(x=-o[v][0],w=o[v][1]),this.imgLorgX=x,this.imgLorgY=w-.25*i,a=x,n=w,h=x,l=w-i,c=x+s,d=w-i,f=x+s,p=w,this.cmdsAry=["M",a,n,"L",h,l,"L",c,d,"L",f,p,"Z"],this.drawCmds=cgo2DToDrawCmds(this.cmdsAry)},m.prototype.stopAnimation=function(){window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.STOPPED,this.currTime=0,this.startOfs=0},m.prototype.pauseAnimation=function(){window.cancelAnimationFrame(this.timer),this.prevAnimMode=this.animMode,this.animMode=this.modes.PAUSED},m.prototype.stepAnimation=function(){function t(){y(s),s.prevAnimMode=s.modes.PAUSED,s.animMode=s.modes.PAUSED}var s=this
this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.STEPPING,setTimeout(t,this.stepTime))},m.prototype.redrawAnimation=function(){this.animMode!==this.modes.PLAYING&&(this.startTime=Date.now()-this.currTime,y(this))},m.prototype.playAnimation=function(t,s){function i(){y(r),r.prevAnimMode=r.modes.PLAYING,s?r.currTime<s?r.timer=window.requestAnimationFrame(i):r.stopAnimation():r.timer=window.requestAnimationFrame(i)}var r=this
this.startOfs=t||0,this.animMode!==this.modes.PLAYING&&(this.animMode===this.modes.PAUSED&&(this.startTime=Date.now()-this.currTime),this.prevAnimMode=this.animMode,this.animMode=this.modes.PLAYING,this.timer=window.requestAnimationFrame(i))},Cango=function(t){function s(t,s){var i=void 0
window.addEventListener("resize",function(){void 0!=i&&(clearTimeout(i),i=void 0),i=setTimeout(function(){i=void 0,t()},s)})}function i(){var t,s,i=o.bkgCanvas.offsetTop+o.bkgCanvas.clientTop,r=o.bkgCanvas.offsetLeft+o.bkgCanvas.clientLeft,e=o.bkgCanvas.offsetWidth,a=o.bkgCanvas.offsetHeight
if(!(Math.abs(e-o.rawWidth)/e<.01&&Math.abs(a-o.rawHeight)/a<.01)&&(o.bkgCanvas.timeline&&o.bkgCanvas.timeline.animTasks.length&&o.deleteAllAnimations(),o.rawWidth=e,o.rawHeight=a,o.aRatio=e/a,o.bkgCanvas===o.cnvs))for(o.cnvs.setAttribute("width",e),o.cnvs.setAttribute("height",a),t=1;t<o.bkgCanvas.layers.length;t++)s=o.bkgCanvas.layers[t].cElem,s&&(s.style.top=i+"px",s.style.left=r+"px",s.style.width=e+"px",s.style.height=a+"px",s.setAttribute("width",e),s.setAttribute("height",a))}var r,e,o=this
return this.cId=t,this.cnvs=document.getElementById(t),null===this.cnvs?void alert("can't find canvas "+t):(this.bkgCanvas=this.cnvs,-1!==t.indexOf("_ovl_")&&(r=t.slice(0,t.indexOf("_ovl_")),this.bkgCanvas=document.getElementById(r)),this.rawWidth=this.cnvs.offsetWidth,this.rawHeight=this.cnvs.offsetHeight,this.aRatio=this.rawWidth/this.rawHeight,this.widthPW=100,this.heightPW=100/this.aRatio,this.bkgCanvas.hasOwnProperty("layers")||(this.bkgCanvas.layers=[],e=new C(this.cId,this.cnvs),this.bkgCanvas.layers[0]=e,s(i,250)),void 0===m||this.bkgCanvas.hasOwnProperty("timeline")||(this.bkgCanvas.timeline=new m),this.cnvs.hasOwnProperty("resized")||(this.cnvs.setAttribute("width",this.rawWidth),this.cnvs.setAttribute("height",this.rawHeight),this.cnvs.resized=!0),this.ctx=this.cnvs.getContext("2d"),this.yDown=!0,this.vpW=this.rawWidth,this.vpH=this.rawHeight,this.vpOrgX=0,this.vpOrgY=0,this.xscl=1,this.yscl=1,this.xoffset=0,this.yoffset=0,this.savWC={xscl:this.xscl,yscl:this.yscl,xoffset:this.xoffset,yoffset:this.yoffset},this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",this.penCol="rgba(0, 0, 0, 1.0)",this.penWid=1,this.lineCap="butt",this.paintCol="rgba(128,128,128,1.0)",this.fontSize=12,this.fontWeight=400,this.fontFamily="Consolas, Monaco, 'Andale Mono', monospace",this.clipCount=0,this.getUnique=function(){return O+=1},void x(this))},Cango.prototype.animation=function(t,s,i,r){var e,o
return o=this.cId+"_"+this.getUnique(),e=new g(o,this,t,s,i,r),this.stopAnimation(),this.bkgCanvas.timeline.animTasks.push(e),e.id},Cango.prototype.pauseAnimation=function(){this.bkgCanvas.timeline.pauseAnimation()},Cango.prototype.playAnimation=function(t,s){this.bkgCanvas.timeline.playAnimation(t,s)},Cango.prototype.stopAnimation=function(){this.bkgCanvas.timeline.stopAnimation()},Cango.prototype.stepAnimation=function(){this.bkgCanvas.timeline.stepAnimation()},Cango.prototype.deleteAnimation=function(t){var s,i=-1
for(this.pauseAnimation(),s=0;s<this.bkgCanvas.timeline.animTasks.length;s++)if(this.bkgCanvas.timeline.animTasks[s].id===t){i=s
break}-1!==i&&this.bkgCanvas.timeline.animTasks.splice(i,1)},Cango.prototype.deleteAllAnimations=function(){this.stopAnimation(),this.bkgCanvas.timeline.animTasks=[]},Cango.prototype.toPixelCoords=function(t,s){var i=this.vpOrgX+this.xoffset+t*this.xscl,r=this.vpOrgY+this.yoffset+s*this.yscl
return{x:i,y:r}},Cango.prototype.toWorldCoords=function(t,s){var i=(t-this.vpOrgX-this.xoffset)/this.xscl,r=(s-this.vpOrgY-this.yoffset)/this.yscl
return{x:i,y:r}},Cango.prototype.getCursorPosWC=function(t){var s=t||window.event,i=this.cnvs.getBoundingClientRect(),r=(s.clientX-i.left-this.vpOrgX-this.xoffset)/this.xscl,e=(s.clientY-i.top-this.vpOrgY-this.yoffset)/this.yscl
return{x:r,y:e}},Cango.prototype.clearCanvas=function(t){function s(t){var s=e.toPixelCoords(t.grad[0],t.grad[1]),i=e.toPixelCoords(t.grad[2],t.grad[3]),r=e.ctx.createLinearGradient(s.x,s.y,i.x,i.y)
return t.colorStops.forEach(function(t){r.addColorStop(t[0],t[1])}),r}function i(t){var s=e.toPixelCoords(t.grad[0],t.grad[1]),i=t.grad[2]*e.xscl,r=e.toPixelCoords(t.grad[3],t.grad[4]),o=t.grad[5]*e.xscl,a=e.ctx.createRadialGradient(s.x,s.y,i,r.x,r.y,o)
return t.colorStops.forEach(function(t){a.addColorStop(t[0],t[1])}),a}var r,e=this
t?(this.ctx.save(),t instanceof LinearGradient?this.ctx.fillStyle=s(t):t instanceof RadialGradient?this.ctx.fillStyle=i(t):this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.rawWidth,this.rawHeight),this.ctx.restore()):this.ctx.clearRect(0,0,this.rawWidth,this.rawHeight),r=v(this),r.dragObjects.length=0,this.cnvs.alphaOvl&&this.cnvs.alphaOvl.parentNode&&this.cnvs.alphaOvl.parentNode.removeChild(this.cnvs.alphaOvl)},Cango.prototype.gridboxPadding=function(t,s,i,r){function e(){n.vpW=n.rawWidth,n.vpH=n.rawHeight,n.vpOrgX=0,n.vpOrgY=0,n.setWorldCoordsSVG()}var o,a,n=this
if(void 0===t)return void e()
if(void 0===s){if(t>=50||0>t)return console.error("gridbox right must be greater than left"),void e()
s=t}return(0>t||t>99)&&(t=0),(0>s||s>99/this.aRatio)&&(s=0),void 0===i?i=t:0>i&&(i=0),void 0===r?r=s:0>r&&(r=0),o=100-t-i,a=100/this.aRatio-r-s,0>o||0>a?(console.error("invalid gridbox dimensions"),void e()):(this.vpW=o*this.rawWidth/100,this.vpH=a*this.rawWidth/100,this.vpOrgX=t*this.rawWidth/100,this.vpOrgY=r*this.rawWidth/100,this.yDown=!0,void this.setWorldCoordsSVG())},Cango.prototype.fillGridbox=function(t){function s(t){var s=r.toPixelCoords(t.grad[0],t.grad[1]),i=r.toPixelCoords(t.grad[2],t.grad[3]),e=r.ctx.createLinearGradient(s.x,s.y,i.x,i.y)
return t.colorStops.forEach(function(t){e.addColorStop(t[0],t[1])}),e}function i(t){var s=r.toPixelCoords(t.grad[0],t.grad[1]),i=t.grad[2]*r.xscl,e=r.toPixelCoords(t.grad[3],t.grad[4]),o=t.grad[5]*r.xscl,a=r.ctx.createRadialGradient(s.x,s.y,i,e.x,e.y,o)
return t.colorStops.forEach(function(t){a.addColorStop(t[0],t[1])}),a}var r=this,e=t||this.paintCol,o=this.yDown?this.vpOrgY:this.vpOrgY-this.vpH
this.ctx.save(),e instanceof LinearGradient?this.ctx.fillStyle=s(e):e instanceof RadialGradient?this.ctx.fillStyle=i(e):this.ctx.fillStyle=e,this.ctx.fillRect(this.vpOrgX,o,this.vpW,this.vpH),this.ctx.restore()},Cango.prototype.setWorldCoordsSVG=function(t,s,i,r){var e=t||0,o=s||0
this.yDown||(this.vpOrgY-=this.vpH,this.yDown=!0),i&&i>0?this.xscl=this.vpW/i:this.xscl=1,r&&r>0?this.yscl=this.vpH/r:this.yscl=this.xscl,this.xoffset=-e*this.xscl,this.yoffset=-o*this.yscl,this.savWC={xscl:this.xscl,yscl:this.yscl,xoffset:this.xoffset,yoffset:this.yoffset}},Cango.prototype.setWorldCoordsRHC=function(t,s,i,r){var e=t||0,o=s||0
this.yDown&&(this.vpOrgY+=this.vpH,this.yDown=!1),i&&i>0?this.xscl=this.vpW/i:this.xscl=1,r&&r>0?this.yscl=-this.vpH/r:this.yscl=-this.xscl,this.xoffset=-e*this.xscl,this.yoffset=-o*this.yscl,this.savWC={xscl:this.xscl,yscl:this.yscl,xoffset:this.xoffset,yoffset:this.yoffset}},Cango.prototype.setPropertyDefault=function(t,s){if("string"==typeof t&&void 0!==s&&null!==s)switch(t.toLowerCase()){case"fillcolor":("string"==typeof s||"object"==typeof s)&&(this.paintCol=s)
break
case"strokecolor":("string"==typeof s||"object"==typeof s)&&(this.penCol=s)
break
case"linewidth":case"strokewidth":this.penWid=s
break
case"linecap":"string"!=typeof s||"butt"!==s&&"round"!==s&&"square"!==s||(this.lineCap=s)
break
case"fontfamily":"string"==typeof s&&(this.fontFamily=s)
break
case"fontsize":this.fontSize=s
break
case"fontweight":("string"==typeof s||s>=100&&900>=s)&&(this.fontWeight=s)
break
case"steptime":s>=15&&500>=s&&(this.stepTime=s)
break
default:return}},Cango.prototype.dropShadow=function(t){var s=0,i=0,r=0,e="#000000",o=1,a=1
void 0!=t&&(s=t.shadowOffsetX||0,i=t.shadowOffsetY||0,r=t.shadowBlur||0,e=t.shadowColor||"#000000","SHAPE"===t.type||"PATH"===t.type&&!t.iso?(o*=this.xscl,a*=this.yscl):(o*=this.xscl,a*=-this.xscl)),this.ctx.shadowOffsetX=s*o,this.ctx.shadowOffsetY=i*a,this.ctx.shadowBlur=r*o,this.ctx.shadowColor=e},Cango.prototype.render=function(s,i){function r(t){var s
t.iso||(s=new c("SCL",n,1,p),t.netTfmAry.unshift(s)),e(t.ofsTfm),t.savScale=1,t.netTfmAry.forEach(function(s){"SCL"===s.type&&(t.savScale*=Math.abs(s.args[0])),"TRN"===s.type?t.iso?s.distortFn.call(t,[s.args[0],s.args[1]*p]):s.distortFn.call(t,[s.args[0],s.args[1]]):s.distortFn.call(t,s.args)}),t.netTfm=t.ofsTfm.multiply(t.grpTfm)}function o(t){var s,i,r
t.parent?(s=t.parent.netTfmAry,i=t.parent.netTfm):(s=[],i=document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGMatrix()),r=s.concat(t.ofsTfmAry),"GRP"===t.type?t.netTfmAry=r:(t.netTfmAry=r.concat(t.hardTfmAry),t.grpTfm=i),t.dwgOrg={x:0,y:0},r.forEach(function(s){t.dwgOrg=s.distortFn.call(t.dwgOrg,s.args)})}function a(){function t(s,r){s(r),"GRP"===r.type?r.children.forEach(function(i){t(s,i)}):i.push(r)}var i=[]
return t(o,s),i}function h(s){function i(){s.formatImg(),r(s),f.paintImg(s)}"IMG"===s.type?s.imgBuf.complete?i():t(s.imgBuf,"load",i):"TEXT"===s.type?(s.formatText(f),r(s),f.paintText(s)):"CLIP"===s.type?(r(s),f.applyClipMask(s)):(r(s),f.paintPath(s))}function l(t){t.transform.reset(),"GRP"===t.type&&t.children.forEach(function(t){l(t)})}var d,f=this,p=Math.abs(f.yscl/f.xscl)
return"string"!=typeof s.type?void console.log("render called on bad object type"):(i===!0&&this.clearCanvas(),"GRP"===s.type?(d=a(),d.forEach(h)):(o(s),h(s)),l(s),void this.resetClip())},Cango.prototype.genLinGrad=function(t,s){var i=t.grad[0],e=t.grad[1],o=t.grad[2],a=t.grad[3],n=r(i,e,s),h=r(o,a,s),l=this.ctx.createLinearGradient(n.x,n.y,h.x,h.y)
return t.colorStops.forEach(function(t){l.addColorStop(t[0],t[1])}),l},Cango.prototype.genRadGrad=function(t,s,i){var e=t.grad[0],o=t.grad[1],a=t.grad[2]*i,n=t.grad[3],h=t.grad[4],l=t.grad[5]*i,c=r(e,o,s),d=r(n,h,s),f=this.ctx.createRadialGradient(c.x,c.y,a,d.x,d.y,l)
return t.colorStops.forEach(function(t){f.addColorStop(t[0],t[1])}),f},Cango.prototype.paintImg=function(t){var s,i,e,o,a,n=this,h=t.imgBuf,l=this.yDown?this.xscl:-this.xscl,c=A.translate(this.vpOrgX+this.xoffset,this.vpOrgY+this.yoffset).scaleNonUniform(this.xscl,l).multiply(t.netTfm)
this.yDown||(c=c.flipY()),this.ctx.save(),this.ctx.setTransform(c.a,c.b,c.c,c.d,c.e,c.f),this.dropShadow(t),this.ctx.drawImage(h,t.imgLorgX,t.imgLorgY,t.width,t.height),this.ctx.restore(),t.border&&(this.ctx.beginPath(),t.drawCmds.forEach(function(t){var s=[]
t.parmsWC.forEach(function(t){a=r(t[0],t[1],c),s.push(a.x,a.y)}),n.ctx[t.drawFn].apply(n.ctx,s)}),this.ctx.save(),e=t.strokeCol||this.penCol,o=e instanceof LinearGradient?this.genLinGrad(e,c):e instanceof RadialGradient?this.genRadGrad(e,c,t.savScale*this.xscl):e,t.lineWidthWC?this.ctx.lineWidth=t.lineWidthWC*t.savScale*this.xscl:this.ctx.lineWidth=t.lineWidth||this.penWid,this.ctx.strokeStyle=o,this.ctx.lineCap=t.lineCap||this.lineCap,this.ctx.stroke(),this.ctx.restore()),null!==t.dragNdrop&&(s=v(this),s!==t.dragNdrop.layer&&t.dragNdrop.layer&&(i=t.dragNdrop.layer.dragObjects.indexOf(this),-1!==i&&t.dragNdrop.layer.dragObjects.splice(i,1)),t.dragNdrop.cgo=this,t.dragNdrop.layer=s,t.dragNdrop.layer.dragObjects.contains(t)||t.dragNdrop.layer.dragObjects.push(t))},Cango.prototype.paintPath=function(t){var s,i,e,o,a,n,h=this,l=this.yDown?this.xscl:-this.xscl,c=A.translate(this.vpOrgX+this.xoffset,this.vpOrgY+this.yoffset).scaleNonUniform(this.xscl,l).multiply(t.netTfm)
this.ctx.save(),this.ctx.beginPath(),t.drawCmds.forEach(function(t){var i=[]
t.parmsWC.forEach(function(t){s=r(t[0],t[1],c),i.push(s.x,s.y)}),h.ctx[t.drawFn].apply(h.ctx,i)}),i=t.fillCol||this.paintCol,e=i instanceof LinearGradient?this.genLinGrad(i,c):i instanceof RadialGradient?this.genRadGrad(i,c,t.savScale*this.xscl):i,i=t.strokeCol||this.penCol,o=i instanceof LinearGradient?this.genLinGrad(i,c):i instanceof RadialGradient?this.genRadGrad(i,c,t.savScale*this.xscl):i,this.dropShadow(t),"SHAPE"===t.type&&(this.ctx.fillStyle=e,this.ctx.fill()),("PATH"===t.type||t.border)&&(t.border&&this.dropShadow(),Array.isArray(t.dashed)&&t.dashed.length&&(this.ctx.setLineDash(t.dashed),this.ctx.lineDashOffset=t.dashOffset||0),t.lineWidthWC?this.ctx.lineWidth=t.lineWidthWC*t.savScale*this.xscl:this.ctx.lineWidth=t.lineWidth||this.penWid,this.ctx.strokeStyle=o,this.ctx.lineCap=t.lineCap||this.lineCap,this.ctx.stroke(),this.ctx.setLineDash([]),this.ctx.lineDashOffset=0),this.ctx.restore(),null!==t.dragNdrop&&(a=v(this),a!==t.dragNdrop.layer&&t.dragNdrop.layer&&(n=t.dragNdrop.layer.dragObjects.indexOf(this),-1!==n&&t.dragNdrop.layer.dragObjects.splice(n,1)),t.dragNdrop.cgo=this,t.dragNdrop.layer=a,t.dragNdrop.layer.dragObjects.contains(t)||t.dragNdrop.layer.dragObjects.push(t))},Cango.prototype.applyClipMask=function(t){if(!t.drawCmds.length)return void this.resetClip()
var s,i=this,e=this.yDown?this.xscl:-this.xscl,o=A.translate(this.vpOrgX+this.xoffset,this.vpOrgY+this.yoffset).scaleNonUniform(this.xscl,e).multiply(t.netTfm)
this.ctx.save(),this.clipCount+=1,this.ctx.beginPath(),t.drawCmds.forEach(function(t){var e=[]
t.parmsWC.forEach(function(t){s=r(t[0],t[1],o),e.push(s.x,s.y)}),i.ctx[t.drawFn].apply(i.ctx,e)}),this.ctx.closePath(),this.ctx.clip(),this.ctx.fillStyle="rgba(0, 0, 0, 0.0)",this.ctx.fillRect(0,0,1,1)},Cango.prototype.resetClip=function(){for(;this.clipCount>0;)this.ctx.restore(),this.clipCount--},Cango.prototype.paintText=function(t){var s,i,r,e,o,a=this,n=this.yDown?this.xscl:-this.xscl,h=A.translate(this.vpOrgX+this.xoffset,this.vpOrgY+this.yoffset).scaleNonUniform(this.xscl,n).multiply(t.netTfm).scaleNonUniform(1/this.xscl,1/n)
s=t.fontWeight||this.fontWeight,i=t.fontSizeZC,r=t.fontFamily||this.fontFamily,this.ctx.save(),this.ctx.setTransform(h.a,h.b,h.c,h.d,h.e,h.f),"string"==typeof t.bgFillColor&&(this.ctx.save(),this.ctx.fillStyle=t.bgFillColor,this.ctx.strokeStyle=t.bgFillColor,this.ctx.lineWidth=.1*i,this.ctx.beginPath(),t.drawCmds.forEach(function(t){var s=[]
t.parmsWC.forEach(function(t){s.push(t[0],t[1])}),a.ctx[t.drawFn].apply(a.ctx,s)}),this.ctx.fill(),this.ctx.stroke(),this.ctx.restore()),this.ctx.font=s+" "+i+"px "+r,this.ctx.fillStyle=t.fillCol||this.paintCol,this.ctx.fillText(t.txtStr,t.imgLorgX,t.imgLorgY),t.border&&(this.dropShadow(),t.lineWidthWC?this.ctx.lineWidth=t.lineWidthWC*this.xscl:this.ctx.lineWidth=t.lineWidth||this.penWid,this.ctx.strokeStyle=t.strokeCol||this.penCol,this.ctx.lineCap=t.lineCap||this.lineCap,this.ctx.strokeText(t.txtStr,t.imgLorgX,t.imgLorgY)),this.ctx.restore(),null!==t.dragNdrop&&(e=v(this),e!==t.dragNdrop.layer&&t.dragNdrop.layer&&(o=t.dragNdrop.layer.dragObjects.indexOf(this),-1!==o&&t.dragNdrop.layer.dragObjects.splice(o,1)),t.dragNdrop.cgo=this,t.dragNdrop.layer=e,t.dragNdrop.layer.dragObjects.contains(t)||t.dragNdrop.layer.dragObjects.push(t))},Cango.prototype.drawPath=function(t,s){var i=s||{},r=i.x||0,e=i.y||0,o=i.scl||1,a=i.degs||0,n=new Path(t,s)
a&&n.transform.rotate(a),1!==o&&n.transform.scale(o),(r||e)&&n.transform.translate(r,e),this.render(n)},Cango.prototype.drawShape=function(t,s){var i=s||{},r=i.x||0,e=i.y||0,o=i.scl||1,a=i.degs||0,n=new Shape(t,s)
a&&n.transform.rotate(a),1!==o&&n.transform.scale(o),(r||e)&&n.transform.translate(r,e),this.render(n)},Cango.prototype.drawText=function(t,s){var i=s||{},r=i.x||0,e=i.y||0,o=i.scl||1,a=i.degs||0,n=new Text(t,s)
a&&n.transform.rotate(a),1!==o&&n.transform.scale(o),(r||e)&&n.transform.translate(r,e),this.render(n)},Cango.prototype.drawImg=function(t,s){var i=s||{},r=i.x||0,e=i.y||0,o=i.scl||1,a=i.degs||0,n=new Img(t,s)
a&&n.transform.rotate(a),1!==o&&n.transform.scale(o),(r||e)&&n.transform.translate(r,e),this.render(n)},Cango.prototype.createLayer=function(){var t,s,i,r,e,o,a=this.rawWidth,n=this.rawHeight,h=this.bkgCanvas.layers.length
return-1!==this.cId.indexOf("_ovl_")?(console.log("canvas layers can't create layers"),""):(i=this.getUnique(),r=this.cId+"_ovl_"+i,t="<canvas id='"+r+"' style='position:absolute' width='"+a+"' height='"+n+"'></canvas>",o=this.bkgCanvas.layers[h-1].cElem,o.insertAdjacentHTML("afterend",t),s=document.getElementById(r),s.style.backgroundColor="transparent",s.style.left=this.bkgCanvas.offsetLeft+this.bkgCanvas.clientLeft+"px",s.style.top=this.bkgCanvas.offsetTop+this.bkgCanvas.clientTop+"px",s.style.width=this.bkgCanvas.offsetWidth+"px",s.style.height=this.bkgCanvas.offsetHeight+"px",e=new C(r,s),this.bkgCanvas.layers.push(e),r)},Cango.prototype.deleteLayer=function(t){var s,i
for(i=1;i<this.bkgCanvas.layers.length;i++)this.bkgCanvas.layers[i].id===t&&(s=this.bkgCanvas.layers[i].cElem,s&&(s.alphaOvl&&s.alphaOvl.parentNode&&s.alphaOvl.parentNode.removeChild(s.alphaOvl),s.parentNode.removeChild(s)),this.bkgCanvas.layers.splice(i,1))},Cango.prototype.deleteAllLayers=function(){var t,s
for(t=this.bkgCanvas.layers.length-1;t>0;t--)s=this.bkgCanvas.layers[t].cElem,s&&(s.alphaOvl&&s.alphaOvl.parentNode&&s.alphaOvl.parentNode.removeChild(s.alphaOvl),s.parentNode.removeChild(s)),this.bkgCanvas.layers.splice(t,1)},Cango.prototype.dupCtx=function(t){this.yDown=t.yDown,this.vpW=t.vpW,this.vpH=t.vpH,this.vpOrgX=t.vpOrgX,this.vpOrgY=t.vpOrgY,this.xscl=t.xscl,this.yscl=t.yscl,this.xoffset=t.xoffset,this.yoffset=t.yoffset,this.savWC=s(t.savWC),this.penCol=t.penCol.slice(0),this.penWid=t.penWid,this.lineCap=t.lineCap.slice(0),this.paintCol=t.paintCol.slice(0),this.fontSize=t.fontSize,this.fontWeight=t.fontWeight,this.fontFamily=t.fontFamily.slice(0)},initZoomPan=function(t,s,i){function r(t){function s(s){var i=s.toPixelCoords(0,0),r=s.rawWidth/2-i.x,e=s.rawHeight/2-i.y
s.xoffset+=r-r/t,s.yoffset+=e-e/t,s.xscl/=t,s.yscl/=t}u.forEach(s),i()}function e(t,s){function r(i){i.xoffset-=t,i.yoffset-=s}u.forEach(r),i()}function o(){function t(t){t.xscl=t.savWC.xscl,t.yscl=t.savWC.yscl,t.xoffset=t.savWC.xoffset,t.yoffset=t.savWC.yoffset}u.forEach(t),i()}var a,n,h,l,c,d,f,p,u,g=["m",-7,-2,"l",7,5,7,-5],y=["m",-6,-6,"l",12,12,"m",0,-12,"l",-12,12],m=["m",-7,0,"l",14,0,"m",-7,-7,"l",0,14],C=["m",-7,0,"l",14,0]
p=new Cango(t),p.clearCanvas(),p.setWorldCoordsRHC(-p.rawWidth+44,-p.rawHeight+44),p.drawShape(shapeDefs.rectangle(114,80),{x:-17,y:0,fillColor:"rgba(0, 50, 0, 0.12)"}),h=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),h.enableDrag(null,null,o),p.render(h),f=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),f.enableDrag(null,null,function(){e(50,0)}),f.translate(22,0),p.render(f),l=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),l.enableDrag(null,null,function(){e(0,-50)}),l.translate(0,22),p.render(l),d=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),d.enableDrag(null,null,function(){e(-50,0)}),d.translate(-22,0),p.render(d),c=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),c.enableDrag(null,null,function(){e(0,50)}),c.translate(0,-22),p.render(c),a=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),a.enableDrag(null,null,function(){r(1/1.2)}),a.translate(-56,11),p.render(a),n=new Shape(shapeDefs.rectangle(20,20,2),{fillColor:"rgba(0,0,0,0.2)"}),n.enableDrag(null,null,function(){r(1.2)}),n.translate(-56,-11),p.render(n),g=["m",-7,-2,"l",7,5,7,-5],p.drawPath(g,{x:0,y:22,strokeColor:"white",lineWidth:2}),p.drawPath(g,{x:22,y:0,strokeColor:"white",lineWidth:2,degs:-90}),p.drawPath(g,{x:-22,y:0,strokeColor:"white",lineWidth:2,degs:90}),p.drawPath(g,{x:0,y:-22,strokeColor:"white",lineWidth:2,degs:180}),p.drawPath(m,{x:-56,y:11,strokeColor:"white",lineWidth:2}),p.drawPath(C,{x:-56,y:-11,strokeColor:"white",lineWidth:2}),p.drawPath(y,{strokeColor:"white",lineWidth:2}),Array.isArray(s)?u=s:(u=[],u[0]=s)},Cango}()